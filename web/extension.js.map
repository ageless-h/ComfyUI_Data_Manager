{"version":3,"mappings":"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","names":["STORAGE_KEYS","FileManagerState","saveState","key","value","e","loadState","defaultValue","saveLastPath","path","getLastPath","saveViewMode","mode","getViewMode","fileManagerWindow","previewModal","previewFloatingWindows","REMOTE_STORAGE_KEY","LAST_CONN_STORAGE_KEY","remoteConnectionsStateValue","initRemoteConnections","saved","lastConn","remoteConnectionsState","themeListeners","addThemeListener","callback","notifyThemeChanged","theme","getComfyTheme","setupThemeWatcher","observer","mutations","shouldUpdate","mutation","applyComfyTheme","lastThemeValues","getThemeValues","checkInterval","currentThemeValues","rootStyle","themeWatcher","initThemeSystem","error","isLightColor","color","hex","r","g","b","bodyStyle","bgPrimary","bgSecondary","inputBg","isLight","textPrimary","textSecondary","root","applyThemeToHeader","header","createHeader","options","title","icon","onClose","onMinimize","onFullscreen","onRefresh","trafficLights","closeBtn","createTrafficButton","minimizeBtn","fullscreenBtn","titleArea","iconElement","titleText","actions","refreshBtn","createHeaderButton","currentTheme","onClick","button","createRemoteSelector","callbacks","onSshConnect","onSshDisconnect","container","select","updateRemoteOptions","state","updateConnectionStatus","connId","savedConn","c","opt","err","active","localOpt","conn","indicator","statusText","createSettingsButton","openSettingsPanel","__vitePreload","result","sshDisconnect","createToolbar","toolbar","leftSection","pathInput","loadDirectory","rightSection","API_ENDPOINTS","LIMITS","FILE_TYPES","getFileType","file","ext","type","config","getTypeByExt","formatSize","bytes","unit","formatDate","dateStr","escapeHtml","text","div","createBrowserPanel","viewMode","panel","createListHeader","content","createHeaderCell","sortKey","label","width","cell","toggleSort","createFileListItem","isParent","fileType","size","modified","createFileGridItem","FORMAT_TYPE_MAP","TYPE_FORMATS","getFormatsForType","typeKey","getTypeColor","getTypeIcon","createFormatSelector","detectedType","selectedFormat","onFormatChange","showTypeIndicator","compact","typeIndicator","formatSection","formats","defaultFormat","fmt","option","updateFormatDescription","buttonGroup","btn","btnEl","description","format","descriptionEl","DEFAULT_DETECTED_TYPE","checkNodeConnectionAndUpdateFormat","app","inputPathConfigNodes","n","fileInput","i","sourceNodeId","sourceNode","detectTypeFromSourceNode","updateFormatSelector","node","nodeType","typeMapping","output","createPreviewPanel","onOpenFloating","onCopyPath","onDelete","infoSection","floatingBtn","copyPathBtn","deleteBtn","currentFormat","selector","createStatusBar","bottomArea","dock","bar","setupWindowDrag","windowEl","rect","offsetX","offsetY","mouseMoveHandler","x","y","mouseUpHandler","keydownHandler","createFileManagerWindow","window","createMainContent","destroyFileManagerWindow","mainContent","browserPanel","previewPanel","listDirectory","response","errorData","errorMsg","getPreviewUrl","getFileInfo","deleteFile","useTrash","updateStatus","statusBar","showToast","severity","summary","detail","getParentPath","normalized","lastSlash","getFileName","getExt","remoteConn","loadRemoteDirectory","data","renderFileListUI","sshList","sortedFiles","a","aIsDir","bIsDir","comparison","html","item","selectFile","openFile","selectGridItem","previewFile","isDir","clearPreviewPanel","previewContent","column","sortSelect","updateHeaderSortIndicators","CODE_COLORS","highlightCode","code","highlightJSON","highlightPython","highlightJavaScript","highlightHTML","highlightCSS","highlightYAML","highlightXML","highlightGeneric","match","keywords","decorators","strings","comments","numbers","functions","templateStrings","arrowFunc","parseCSV","rows","currentRow","currentCell","inQuotes","char","nextChar","DEFAULT_OPTIONS","MODE_CONFIG","createTableHTML","mergedOptions","displayRows","isTruncated","tableId","heightStyle","containerStyle","tableHTML","row","rowIndex","isHeader","cellContent","createTableControls","maxRows","setupTableControls","controlsHTML","modeType","table","zoom","isFullscreen","tableEl","wrapper","zoomDisplay","zoomInBtn","zoomOutBtn","fitBtn","updateZoom","containerWidth","tableWidth","newZoom","createTableErrorHTML","parseSpreadsheet","loadScript","src","resolve","reject","script","loadPreviewContent","scale","previewHTML","audioUrl","audioId","videoUrl","extUpper","docUrl","isPDF","isMarkdown","isDocx","arrayBuffer","mammoth","contentId","fileName","updateDock","minimizedWindows","w","thumbnail","restoreFloatingPreview","DEFAULT_IMAGE_SCALE","createToolbarButton","openFloatingPreview","existingWindow","fileConfig","isImage","isVideo","isAudio","isDocument","isCode","isSpreadsheet","previewWindow","createPreviewHeader","createPreviewToolbar","windowData","textColor","createTrafficLightButton","closeFloatingPreview","minimizeFloatingPreview","toggleFullscreen","newTheme","newTextColor","openBtn","idx","MIN_NODE_VERSION","IS_NODE_V3","extensionConfig","openFileManager","style","fixPosition","dmBtn","queueBtn","queueParent","lastCall","now","m","el","nodeObj","outputNode","lastPath","selected","copySelectedPaths","deleteSelectedFiles","checkAndUpdateFormatSelector","paths","message","apiDeleteFile"],"ignoreList":[],"sources":["../frontend/src/core/state.ts","../frontend/src/utils/theme.ts","../frontend/src/ui/components/header.ts","../frontend/src/ui/components/toolbar.ts","../frontend/src/core/constants.ts","../frontend/src/utils/file-type.ts","../frontend/src/utils/format.ts","../frontend/src/ui/components/browser.ts","../frontend/src/ui/components/format-selector.ts","../frontend/src/ui/components/preview.ts","../frontend/src/utils/drag.ts","../frontend/src/ui/main-window.ts","../frontend/src/api/endpoints/file.ts","../frontend/src/utils/helpers.ts","../frontend/src/ui/components/actions.ts","../frontend/src/utils/syntax-highlight.ts","../frontend/src/utils/csv.ts","../frontend/src/utils/table.ts","../frontend/src/utils/script.ts","../frontend/src/ui/floating/preview-content.ts","../frontend/src/ui/floating/dock.ts","../frontend/src/ui/floating/window.ts","../frontend/src/extension.ts"],"sourcesContent":["/**\n * ComfyUI Data Manager - State Management\n */\n\n// ==================== Types ====================\n\nexport type ViewMode = 'list' | 'grid';\nexport type SortBy = 'name' | 'size' | 'modified';\nexport type SortOrder = 'asc' | 'desc';\n\nexport interface FileItem {\n  name: string;\n  path?: string;\n  size?: number;\n  modified?: number | string;\n  is_dir?: boolean;\n  isDir?: boolean;  // Alias for compatibility\n  type?: string;\n}\n\nexport interface FileManagerStateData {\n  currentPath: string;\n  selectedFiles: string[];  // Array of file paths (strings)\n  currentPreviewFile: string | null;\n  viewMode: ViewMode;\n  sortBy: SortBy;\n  sortOrder: SortOrder;\n  files: FileItem[];\n  history: string[];\n  historyIndex: number;\n}\n\nexport interface RemoteConnection {\n  id: string;\n  name: string;\n  host: string;\n  port: number;\n  username: string;\n  password?: string;\n  keyPath?: string;\n}\n\nexport interface RemoteConnectionsState {\n  active: RemoteConnection | null;\n  saved: RemoteConnection[];\n}\n\n// ==================== Storage Keys ====================\n\nexport const STORAGE_KEYS = {\n  LAST_PATH: 'comfyui_datamanager_last_path',\n  VIEW_MODE: 'comfyui_datamanager_view_mode',\n  SORT_BY: 'comfyui_datamanager_sort_by',\n  REMOTE_CONNECTIONS: 'comfyui_datamanager_remote_connections',\n  LAST_CONNECTION: 'comfyui_datamanager_last_connection'\n} as const;\n\n// ==================== File Manager State ====================\n\nexport const FileManagerState: FileManagerStateData = {\n  currentPath: '',\n  selectedFiles: [],\n  currentPreviewFile: null,\n  viewMode: 'list',\n  sortBy: 'name',\n  sortOrder: 'asc',\n  files: [],\n  history: [],\n  historyIndex: -1\n};\n\n// ==================== Storage Functions ====================\n\nexport function saveState(key: string, value: unknown): void {\n  try {\n    localStorage.setItem(key, JSON.stringify(value));\n  } catch (e) {\n    console.warn('[DataManager] Failed to save state:', e);\n  }\n}\n\nexport function loadState<T>(key: string, defaultValue: T): T {\n  try {\n    const value = localStorage.getItem(key);\n    return value ? (JSON.parse(value) as T) : defaultValue;\n  } catch (e) {\n    console.warn('[DataManager] Failed to load state:', e);\n    return defaultValue;\n  }\n}\n\nexport function saveLastPath(path: string): void {\n  saveState(STORAGE_KEYS.LAST_PATH, path);\n}\n\nexport function getLastPath(): string {\n  return loadState<string>(STORAGE_KEYS.LAST_PATH, '.');\n}\n\nexport function saveViewMode(mode: ViewMode): void {\n  saveState(STORAGE_KEYS.VIEW_MODE, mode);\n}\n\nexport function getViewMode(): ViewMode {\n  return loadState<ViewMode>(STORAGE_KEYS.VIEW_MODE, 'list');\n}\n\n// ==================== Global Variables ====================\n\nexport let fileManagerWindow: Window | null = null;\nexport let previewModal: HTMLElement | null = null;\nexport let previewFloatingWindows: unknown[] = [];  // Will contain FloatingWindowData objects\n\n// ==================== SSH Remote Connection State ====================\n\nconst REMOTE_STORAGE_KEY = STORAGE_KEYS.REMOTE_CONNECTIONS;\nconst LAST_CONN_STORAGE_KEY = STORAGE_KEYS.LAST_CONNECTION;\n\n// Initialize remote connections state\nlet remoteConnectionsStateValue: RemoteConnectionsState = {\n  active: null,\n  saved: []\n};\n\n// Initialize remote connections\nfunction initRemoteConnections(): void {\n  try {\n    const saved = localStorage.getItem(REMOTE_STORAGE_KEY);\n    if (saved) {\n      remoteConnectionsStateValue.saved = JSON.parse(saved);\n    }\n    const lastConn = localStorage.getItem(LAST_CONN_STORAGE_KEY);\n    if (lastConn) {\n      remoteConnectionsStateValue.active = JSON.parse(lastConn);\n    }\n    // Update window reference (for compatibility with existing code)\n    if (window._remoteConnectionsState) {\n      window._remoteConnectionsState.active = remoteConnectionsStateValue.active;\n      window._remoteConnectionsState.saved = remoteConnectionsStateValue.saved;\n    } else {\n      window._remoteConnectionsState = remoteConnectionsStateValue;\n    }\n  } catch (e) {\n    console.warn('[DataManager] Failed to init remote connections:', e);\n  }\n}\n\n// Initialize immediately\ninitRemoteConnections();\n\n// Export for external use\nexport const remoteConnectionsState = remoteConnectionsStateValue;\n","/**\n * ComfyUI Data Manager - Theme Utilities\n *\n * Get ComfyUI CSS variables and adapt to Data Manager interface\n */\n\n// Theme listener callback type\nexport type ThemeListener = (theme: ComfyTheme) => void;\n\n// Theme listeners\nconst themeListeners: ThemeListener[] = [];\n\n/**\n * ComfyUI theme colors interface\n */\nexport interface ComfyTheme {\n  bgPrimary: string;\n  bgSecondary: string;\n  bgTertiary: string;\n  inputBg: string;\n  inputText: string;\n  borderColor: string;\n  textPrimary: string;\n  textSecondary: string;\n  accentColor: string;\n  errorColor: string;\n  successColor: string;\n  isLight: boolean;\n}\n\n/**\n * Add theme change listener\n * @param callback - Callback function when theme changes\n */\nexport function addThemeListener(callback: ThemeListener): void {\n  themeListeners.push(callback);\n}\n\n/**\n * Notify all theme listeners\n */\nexport function notifyThemeChanged(): void {\n  const theme = getComfyTheme();\n  themeListeners.forEach(callback => {\n    try {\n      callback(theme);\n    } catch (e) {\n      console.error('[DataManager] Theme listener error:', e);\n    }\n  });\n}\n\n/**\n * Setup ComfyUI theme watcher\n */\nfunction setupThemeWatcher(): { observer: MutationObserver; checkInterval: number } {\n  // Listen for body attribute changes (some theme systems switch themes via attributes)\n  const observer = new MutationObserver((mutations) => {\n    let shouldUpdate = false;\n    for (const mutation of mutations) {\n      if (mutation.type === 'attributes') {\n        shouldUpdate = true;\n        break;\n      }\n    }\n    if (shouldUpdate) {\n      applyComfyTheme();\n      notifyThemeChanged();\n    }\n  });\n\n  observer.observe(document.documentElement, {\n    attributes: true,\n    attributeFilter: ['class', 'data-theme']\n  });\n\n  // Listen for CSS variable changes\n  let lastThemeValues = getThemeValues();\n  const checkInterval = window.setInterval(() => {\n    const currentThemeValues = getThemeValues();\n    if (JSON.stringify(lastThemeValues) !== JSON.stringify(currentThemeValues)) {\n      lastThemeValues = currentThemeValues;\n      applyComfyTheme();\n      notifyThemeChanged();\n    }\n  }, 2000);\n\n  return { observer, checkInterval };\n}\n\n/**\n * Get current theme values for comparison\n */\nfunction getThemeValues(): Record<string, string> {\n  const rootStyle = window.getComputedStyle(document.documentElement);\n  return {\n    bg: rootStyle.getPropertyValue('--comfy-menu-bg'),\n    bg2: rootStyle.getPropertyValue('--comfy-menu-bg-2'),\n    inputText: rootStyle.getPropertyValue('--input-text'),\n    borderColor: rootStyle.getPropertyValue('--border-color')\n  };\n}\n\n// Theme watcher instance\nlet themeWatcher: { observer: MutationObserver; checkInterval: number } | null = null;\n\n/**\n * Initialize theme system\n */\nexport function initThemeSystem(): void {\n  if (!themeWatcher) {\n    // Delay initialization to ensure DOM is fully loaded\n    setTimeout(() => {\n      try {\n        themeWatcher = setupThemeWatcher();\n      } catch (error) {\n        console.error('[DataManager] Theme watcher init failed:', error);\n      }\n    }, 1000);\n  }\n}\n\n/**\n * Check if a color is light\n * @param color - CSS color value\n * @returns True if color is light\n */\nfunction isLightColor(color: string): boolean {\n  const hex = color.replace('#', '');\n  if (hex.length === 3) {\n    const r = parseInt(hex[0] + hex[0], 16);\n    const g = parseInt(hex[1] + hex[1], 16);\n    const b = parseInt(hex[2] + hex[2], 16);\n    return (r * 299 + g * 587 + b * 114) / 1000 > 128;\n  }\n  if (hex.length === 6) {\n    const r = parseInt(hex.substring(0, 2), 16);\n    const g = parseInt(hex.substring(2, 4), 16);\n    const b = parseInt(hex.substring(4, 6), 16);\n    return (r * 299 + g * 587 + b * 114) / 1000 > 128;\n  }\n  return false;\n}\n\n/**\n * Get ComfyUI theme CSS variables\n * @returns Theme color object\n */\nexport function getComfyTheme(): ComfyTheme {\n  try {\n    const rootStyle = window.getComputedStyle(document.documentElement);\n    const bodyStyle = window.getComputedStyle(document.body);\n\n    // Get background colors\n    const bgPrimary = rootStyle.getPropertyValue('--comfy-menu-bg')?.trim() || '#1a1a1a';\n    const bgSecondary = rootStyle.getPropertyValue('--comfy-menu-bg-2')?.trim() ||\n                         rootStyle.getPropertyValue('--comfy-menu-secondary-bg')?.trim() || '#252525';\n    const inputBg = rootStyle.getPropertyValue('--comfy-input-bg')?.trim() || '#2a2a2a';\n\n    // Detect if light theme\n    const isLight = isLightColor(bgPrimary);\n\n    // Select text colors based on theme brightness\n    const textPrimary = rootStyle.getPropertyValue('--input-text')?.trim() ||\n                        rootStyle.getPropertyValue('--input-text-text')?.trim() ||\n                        (isLight ? '#222' : '#ddd');\n    const textSecondary = rootStyle.getPropertyValue('--descrip-text')?.trim() ||\n                          (isLight ? '#666' : '#999');\n\n    return {\n      // Background colors\n      bgPrimary: bgPrimary,\n      bgSecondary: bgSecondary,\n      bgTertiary: rootStyle.getPropertyValue('--comfy-menu-bg-3')?.trim() || '#2a2a2a',\n\n      // Input\n      inputBg: inputBg,\n      inputText: textPrimary,\n\n      // Border\n      borderColor: rootStyle.getPropertyValue('--border-color')?.trim() ||\n                    (isLight ? '#ddd' : '#3a3a3a'),\n\n      // Text\n      textPrimary: textPrimary,\n      textSecondary: textSecondary,\n\n      // Accent (some themes may define)\n      accentColor: rootStyle.getPropertyValue('--comfy-accent')?.trim() || '#9b59b6',\n\n      // Error/success\n      errorColor: '#e74c3c',\n      successColor: '#27ae60',\n      isLight\n    };\n  } catch (error) {\n    console.warn('[DataManager] Failed to get ComfyUI theme:', error);\n    // Return default dark theme\n    return {\n      bgPrimary: '#1a1a1a',\n      bgSecondary: '#252525',\n      bgTertiary: '#2a2a2a',\n      inputBg: '#2a2a2a',\n      inputText: '#ddd',\n      borderColor: '#3a3a3a',\n      textPrimary: '#ddd',\n      textSecondary: '#999',\n      accentColor: '#9b59b6',\n      errorColor: '#e74c3c',\n      successColor: '#27ae60',\n      isLight: false\n    };\n  }\n}\n\n/**\n * Apply ComfyUI theme to Data Manager elements\n */\nexport function applyComfyTheme(): void {\n  const theme = getComfyTheme();\n\n  // Apply CSS custom properties to root\n  const root = document.documentElement;\n  root.style.setProperty('--dm-bg-primary', theme.bgPrimary);\n  root.style.setProperty('--dm-bg-secondary', theme.bgSecondary);\n  root.style.setProperty('--dm-bg-tertiary', theme.bgTertiary);\n  root.style.setProperty('--dm-input-bg', theme.inputBg);\n  root.style.setProperty('--dm-input-text', theme.inputText);\n  root.style.setProperty('--dm-border-color', theme.borderColor);\n  root.style.setProperty('--dm-text-primary', theme.textPrimary);\n  root.style.setProperty('--dm-text-secondary', theme.textSecondary);\n  root.style.setProperty('--dm-accent-color', theme.accentColor);\n  root.style.setProperty('--dm-error-color', theme.errorColor);\n  root.style.setProperty('--dm-success-color', theme.successColor);\n}\n","/**\n * ComfyUI Data Manager - Header Component\n */\n\nimport type { ComfyTheme } from '../../utils/theme.js';\nimport { getComfyTheme, addThemeListener } from '../../utils/theme.js';\n\n/**\n * Header options\n */\nexport interface HeaderOptions {\n  title?: string;\n  icon?: string;\n  onClose?: () => void;\n  onMinimize?: () => void;\n  onFullscreen?: () => void;\n  onRefresh?: () => void;\n}\n\n// Theme change callback storage\nlet themeChangeCallback: ((theme: ComfyTheme) => void) | null = null;\n\n/**\n * Apply theme to header\n * @param header - Header element\n * @param theme - Theme object\n */\nfunction applyThemeToHeader(header: HTMLElement, theme: ComfyTheme): void {\n  if (!header) return;\n\n  header.style.background = `linear-gradient(135deg, ${theme.bgSecondary} 0%, ${theme.bgPrimary} 100%)`;\n  header.style.borderColor = theme.borderColor;\n}\n\n/**\n * Create window header (macOS style)\n * @param options - Configuration options\n * @returns Header element\n */\nexport function createHeader(options: HeaderOptions = {}): HTMLElement {\n  const {\n    title = 'Data Manager',\n    icon = 'pi-folder-open',\n    onClose = null,\n    onMinimize = null,\n    onFullscreen = null,\n    onRefresh = null\n  } = options;\n\n  const header = document.createElement(\"div\");\n  header.className = \"dm-header dm-preview-header\";\n  header.setAttribute('draggable', 'false');\n\n  const theme = getComfyTheme();\n\n  header.style.cssText = `\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 15px;\n    background: linear-gradient(135deg, ${theme.bgSecondary} 0%, ${theme.bgPrimary} 100%);\n    border-bottom: 1px solid ${theme.borderColor};\n    cursor: move;\n    user-select: none;\n  `;\n\n  // Traffic light buttons (macOS style)\n  const trafficLights = document.createElement(\"div\");\n  trafficLights.className = \"dm-traffic-lights\";\n  trafficLights.style.cssText = \"display: flex; gap: 8px;\";\n\n  const closeBtn = createTrafficButton(\"pi-times\", \"\", onClose);\n  const minimizeBtn = createTrafficButton(\"pi-minus\", \"\", onMinimize);\n  const fullscreenBtn = createTrafficButton(\"pi-window-maximize\", \"\", onFullscreen);\n\n  trafficLights.appendChild(closeBtn);\n  trafficLights.appendChild(minimizeBtn);\n  trafficLights.appendChild(fullscreenBtn);\n\n  // Title area\n  const titleArea = document.createElement(\"div\");\n  titleArea.className = \"dm-header-title-area\";\n  titleArea.style.cssText = `\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 14px;\n    font-weight: 600;\n    flex: 1 1 0%;\n    justify-content: center;\n  `;\n\n  const iconElement = document.createElement(\"i\");\n  iconElement.className = `pi ${icon}`;\n\n  const titleText = document.createElement(\"span\");\n  titleText.style.cssText = `\n    max-width: 300px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  `;\n  titleText.textContent = title;\n\n  titleArea.appendChild(iconElement);\n  titleArea.appendChild(titleText);\n\n  // Actions area (right side)\n  const actions = document.createElement(\"div\");\n  actions.style.cssText = \"display: flex; gap: 8px;\";\n\n  if (onRefresh) {\n    const refreshBtn = createHeaderButton(\"pi-refresh\", \"\", onRefresh);\n    refreshBtn.style.background = \"transparent\";\n    actions.appendChild(refreshBtn);\n  }\n\n  header.appendChild(trafficLights);\n  header.appendChild(titleArea);\n  header.appendChild(actions);\n\n  // Store theme update function\n  (header as unknown as { _updateTheme?: () => void })._updateTheme = () => {\n    const currentTheme = getComfyTheme();\n    applyThemeToHeader(header, currentTheme);\n    if (themeChangeCallback) {\n      themeChangeCallback(currentTheme);\n    }\n  };\n\n  // Register theme change listener\n  addThemeListener((theme) => {\n    applyThemeToHeader(header, theme);\n  });\n\n  return header;\n}\n\n/**\n * Create traffic light button (macOS style round button)\n * @param icon - Icon class name\n * @param title - Tooltip text\n * @param onClick - Click callback\n * @returns Button element\n */\nfunction createTrafficButton(icon: string, title: string, onClick: (() => void) | null): HTMLElement {\n  const button = document.createElement(\"button\");\n  button.className = \"comfy-btn dm-traffic-btn\";\n  button.innerHTML = `<i class=\"pi ${icon}\" style=\"font-size: 10px;\"></i>`;\n  button.style.cssText = `\n    width: 14px;\n    height: 14px;\n    padding: 0px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: 0.15s;\n  `;\n  button.title = title;\n\n  if (onClick) {\n    button.onclick = (e) => {\n      e.stopPropagation();\n      onClick();\n    };\n  }\n\n  return button;\n}\n\n/**\n * Create header button\n * @param icon - Icon class name\n * @param title - Title text\n * @param onClick - Click callback\n * @returns Button element\n */\nexport function createHeaderButton(icon: string, title: string, onClick: () => void): HTMLElement {\n  const button = document.createElement(\"button\");\n  button.className = \"comfy-btn dm-header-btn\";\n  button.innerHTML = `<i class=\"pi ${icon}\"></i>`;\n  button.style.cssText = `\n    padding: 6px 10px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    border-radius: 4px;\n  `;\n  button.title = title;\n  button.onmouseover = () => button.style.background = \"\";\n  button.onmouseout = () => button.style.background = \"transparent\";\n  button.onclick = onClick;\n  return button;\n}\n","/**\n * ComfyUI Data Manager - Toolbar Component\n */\n\n/**\n * Toolbar callbacks\n */\nexport interface ToolbarCallbacks {\n  onSshConnect?: (result: unknown) => void;\n  onSshDisconnect?: () => void;\n}\n\n/**\n * Remote connection state interface\n */\ninterface RemoteConnection {\n  id?: string;\n  name?: string;\n  host?: string;\n  port?: number;\n  username?: string;\n  password?: string;\n  connection_id?: string;\n}\n\ninterface RemoteConnectionsState {\n  active: RemoteConnection | null;\n  saved: RemoteConnection[];\n}\n\n/**\n * Create remote device selector\n * @param callbacks - Callback functions\n * @returns Selector container element\n */\nfunction createRemoteSelector(callbacks: ToolbarCallbacks): HTMLElement {\n  const { onSshConnect, onSshDisconnect } = callbacks;\n\n  const container = document.createElement(\"div\");\n  container.style.cssText = \"display: flex; align-items: center; gap: 5px;\";\n\n  // Device select dropdown\n  const select = document.createElement(\"select\");\n  select.id = \"dm-remote-select\";\n  select.style.cssText = `\n    padding: 8px 12px;\n    border: 1px solid #444;\n    border-radius: 6px;\n    font-size: 13px;\n    min-width: 150px;\n    cursor: pointer;\n  `;\n\n  // Initialize options\n  updateRemoteOptions(select, onSshConnect, onSshDisconnect);\n\n  select.onchange = async (e) => {\n    const value = (e.target as HTMLSelectElement).value;\n    const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })._remoteConnectionsState;\n\n    if (value === '__local__') {\n      // Switch to local\n      state.active = null;\n      try {\n        localStorage.removeItem('comfyui_datamanager_last_connection');\n      } catch (err) {}\n      updateRemoteOptions(select, onSshConnect, onSshDisconnect);\n      updateConnectionStatus();\n      if (onSshDisconnect) onSshDisconnect();\n    } else if (value.startsWith('conn_')) {\n      // Connect to saved device\n      const connId = value.substring(5);\n      const savedConn = state.saved.find(c => c.id === connId);\n      if (savedConn) {\n        try {\n          select.disabled = true;\n          const opt = document.createElement(\"option\");\n          opt.textContent = \"...\";\n          select.innerHTML = \"\";\n          select.appendChild(opt);\n\n          if (onSshConnect) onSshConnect({\n            connection_id: connId,\n            host: savedConn.host,\n            port: savedConn.port,\n            username: savedConn.username,\n            password: atob(savedConn.password || \"\")\n          });\n        } catch (err) {\n          alert(\": \" + (err as Error).message);\n          updateRemoteOptions(select, onSshConnect, onSshDisconnect);\n        }\n      }\n    }\n    (e.target as HTMLSelectElement).value = \"\";\n  };\n\n  container.appendChild(select);\n\n  return container;\n}\n\n/**\n * Update remote selector options\n */\nfunction updateRemoteOptions(select: HTMLSelectElement, onSshConnect?: (result: unknown) => void, onSshDisconnect?: () => void): void {\n  const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })._remoteConnectionsState;\n  const active = state.active;\n\n  select.innerHTML = \"\";\n\n  // Local option\n  const localOpt = document.createElement(\"option\");\n  localOpt.value = \"__local__\";\n  localOpt.textContent = \"\";\n  select.appendChild(localOpt);\n\n  // Saved connections\n  state.saved.forEach(conn => {\n    const opt = document.createElement(\"option\");\n    opt.value = `conn_${conn.id}`;\n    opt.textContent = conn.name || `${conn.username}@${conn.host}`;\n    if (active && active.connection_id === conn.id) {\n      (opt as HTMLOptionElement).style.color = \"#27ae60\";\n    }\n    select.appendChild(opt);\n  });\n}\n\n/**\n * Update connection status indicator\n */\nfunction updateConnectionStatus(): void {\n  const indicator = document.getElementById(\"dm-connection-indicator\");\n  const statusText = document.getElementById(\"dm-connection-status\");\n  const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })._remoteConnectionsState;\n  const active = state.active;\n\n  if (indicator) {\n    (indicator as HTMLElement).style.background = active ? '#27ae60' : '#666';\n  }\n  if (statusText) {\n    if (active) {\n      statusText.textContent = `SSH: ${active.username}@${active.host}`;\n    } else {\n      statusText.textContent = \"\";\n    }\n  }\n}\n\n/**\n * Create settings button\n * @param callbacks - Callback functions\n * @returns Button element\n */\nfunction createSettingsButton(callbacks: ToolbarCallbacks): HTMLElement {\n  const { onSshConnect, onSshDisconnect } = callbacks;\n\n  const button = document.createElement(\"button\");\n  button.className = \"comfy-btn\";\n  button.id = \"dm-settings-btn\";\n  button.innerHTML = '<i class=\"pi pi-cog\"></i>';\n  button.style.cssText = `\n    padding: 8px 12px;\n    border: 1px solid #444;\n    border-radius: 6px;\n    cursor: pointer;\n    background: transparent;\n    color: #ccc;\n  `;\n  button.title = \"\";\n\n  button.onclick = async () => {\n    const { openSettingsPanel } = await import('./settings.js');\n    openSettingsPanel({\n      onConnect: (result: unknown) => {\n        const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })._remoteConnectionsState;\n        state.active = result as RemoteConnection;\n        try {\n          localStorage.setItem('comfyui_datamanager_last_connection', JSON.stringify(result));\n        } catch (err) {}\n        updateConnectionStatus();\n        if (onSshConnect) onSshConnect(result);\n      },\n      onDisconnect: async () => {\n        const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })._remoteConnectionsState;\n        const conn = state.active;\n        if (conn && conn.connection_id) {\n          try {\n            const { sshDisconnect } = await import('../../api/ssh.js');\n            await sshDisconnect(conn.connection_id);\n          } catch (e) {\n            console.log('[DataManager] SSH disconnect error:', e);\n          }\n        }\n        state.active = null;\n        try {\n          localStorage.removeItem('comfyui_datamanager_last_connection');\n        } catch (err) {}\n        updateConnectionStatus();\n        if (onSshDisconnect) onSshDisconnect();\n      }\n    });\n  };\n\n  return button;\n}\n\n/**\n * Create toolbar\n * @param callbacks - Callback functions\n * @returns Toolbar element\n */\nexport function createToolbar(callbacks: ToolbarCallbacks = {}): HTMLElement {\n  const toolbar = document.createElement(\"div\");\n  toolbar.className = \"dm-toolbar\";\n  toolbar.style.cssText = `\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 15px;\n    border-bottom: 1px solid;\n    gap: 15px;\n  `;\n\n  const leftSection = document.createElement(\"div\");\n  leftSection.style.cssText = \"display: flex; align-items: center; gap: 10px;\";\n\n  // Path input\n  const pathInput = document.createElement(\"input\");\n  pathInput.id = \"dm-path-input\";\n  pathInput.type = \"text\";\n  pathInput.className = \"dm-input\";\n  pathInput.style.cssText = `\n    flex: 1;\n    min-width: 300px;\n    padding: 8px 12px;\n    border: 1px solid #444;\n    border-radius: 6px;\n    font-size: 13px;\n    background: #2a2a2a;\n    color: #fff;\n  `;\n  pathInput.value = FileManagerState.currentPath || \".\";\n  pathInput.onkeypress = (e) => {\n    if (e.key === 'Enter') {\n      const { loadDirectory } = require('./actions.js');\n      loadDirectory((e.target as HTMLInputElement).value);\n    }\n  };\n\n  leftSection.appendChild(pathInput);\n  toolbar.appendChild(leftSection);\n\n  const rightSection = document.createElement(\"div\");\n  rightSection.style.cssText = \"display: flex; align-items: center; gap: 10px;\";\n\n  rightSection.appendChild(createRemoteSelector(callbacks));\n  rightSection.appendChild(createSettingsButton(callbacks));\n\n  toolbar.appendChild(rightSection);\n\n  // Initialize connection status\n  setTimeout(() => updateConnectionStatus(), 100);\n\n  return toolbar;\n}\n\n// Import FileManagerState for path input initialization\nimport { FileManagerState } from '../../core/state.js';\n","/**\n * ComfyUI Data Manager - Constants Configuration\n */\n\n// ==================== API Endpoints ====================\n\nexport const API_ENDPOINTS = {\n  LIST: \"/dm/list\",\n  PREVIEW: \"/dm/preview\",\n  INFO: \"/dm/info\",\n  CREATE_FILE: \"/dm/create/file\",\n  CREATE_DIRECTORY: \"/dm/create/directory\",\n  DELETE: \"/dm/delete\"\n} as const;\n\n// ==================== Limits ====================\n\nexport const LIMITS = {\n  // Table\n  MAX_PREVIEW_ROWS: 100,\n\n  // Code preview\n  MAX_CODE_LENGTH: 50000,\n\n  // Zoom\n  MIN_ZOOM: 0.1,\n  MAX_ZOOM: 5,\n  DEFAULT_ZOOM_STEP: 25,\n  MIN_ZOOM_DISPLAY: 25,\n  MAX_ZOOM_DISPLAY: 300,\n\n  // Font size\n  MIN_FONT_SIZE: 8,\n  MAX_FONT_SIZE: 32,\n\n  // Window\n  DEFAULT_WINDOW_WIDTH: 1200,\n  DEFAULT_WINDOW_HEIGHT: 700,\n  FLOATING_Z_INDEX: 10001\n} as const;\n\n// ==================== File Types ====================\n\nexport interface FileTypeConfig {\n  exts: string[];\n  icon: string;\n  color: string;\n}\n\nexport const FILE_TYPES: Record<string, FileTypeConfig> = {\n  image: {\n    exts: ['.jpg', '.jpeg', '.png', '.gif', '.bmp', '.webp', '.svg', '.ico', '.tiff', '.tif', '.avif', '.heic', '.heif', '.tga'],\n    icon: 'pi-image',\n    color: '#e74c3c'\n  },\n  video: {\n    exts: ['.mp4', '.webm', '.mov', '.mkv'],\n    icon: 'pi-video',\n    color: '#9b59b6'\n  },\n  videoExternal: {\n    exts: ['.avi'],\n    icon: 'pi-video',\n    color: '#8e44ad'\n  },\n  audio: {\n    exts: ['.mp3', '.wav', '.flac', '.aac', '.ogg', '.wma', '.m4a'],\n    icon: 'pi-volume-up',\n    color: '#3498db'\n  },\n  document: {\n    exts: ['.pdf', '.doc', '.docx', '.txt', '.rtf', '.md'],\n    icon: 'pi-file',\n    color: '#95a5a6'\n  },\n  spreadsheet: {\n    exts: ['.xls', '.xlsx', '.csv', '.ods'],\n    icon: 'pi-table',\n    color: '#27ae60'\n  },\n  archive: {\n    exts: ['.zip', '.rar', '.7z', '.tar', '.gz'],\n    icon: 'pi-box',\n    color: '#f39c12'\n  },\n  code: {\n    exts: ['.py', '.js', '.html', '.css', '.json', '.xml', '.yaml', '.yml', '.cpp', '.c', '.h'],\n    icon: 'pi-code',\n    color: '#1abc9c'\n  },\n  folder: {\n    exts: [], // Folders don't have extensions\n    icon: 'pi-folder',\n    color: '#f1c40f'\n  },\n  unknown: {\n    exts: [], // Unknown files don't have specific extensions\n    icon: 'pi-file',\n    color: '#7f8c8d'\n  }\n};\n","/**\n * ComfyUI Data Manager - File Type Detection Utilities\n */\n\nimport { FILE_TYPES } from '../core/constants.js';\n\n/**\n * Identify file type from file object\n * @param file - File object with name and is_dir properties\n * @returns File type key\n */\nexport function getFileType(file: { name?: string; path?: string; is_dir?: boolean }): string {\n  if (file.is_dir) return \"folder\";\n  const ext = \".\" + ((file.name || file.path || \"\").split(\".\").pop()?.toLowerCase() || \"\");\n  for (const [type, config] of Object.entries(FILE_TYPES)) {\n    if (config.exts && config.exts.includes(ext)) return type;\n  }\n  return \"unknown\";\n}\n\n/**\n * Get file type by extension\n * @param ext - File extension (with dot)\n * @returns File type key\n */\nexport function getTypeByExt(ext: string): string {\n  for (const [type, config] of Object.entries(FILE_TYPES)) {\n    if (config.exts && config.exts.includes(ext)) return type;\n  }\n  return \"unknown\";\n}\n","/**\n * ComfyUI Data Manager - Format Utilities\n */\n\n/**\n * Format file size to human readable string\n * @param bytes - Number of bytes\n * @returns Formatted size string\n */\nexport function formatSize(bytes: number): string {\n  if (!bytes) return \"\";\n  for (const unit of [\"B\", \"KB\", \"MB\", \"GB\"]) {\n    if (bytes < 1024) return bytes.toFixed(1) + \" \" + unit;\n    bytes /= 1024;\n  }\n  return bytes.toFixed(1) + \" TB\";\n}\n\n/**\n * Format date to localized string\n * @param dateStr - Date string\n * @returns Formatted date string\n */\nexport function formatDate(dateStr: string): string {\n  if (!dateStr) return \"\";\n  const date = new Date(dateStr);\n  return date.toLocaleString(\"zh-CN\", {\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n}\n\n/**\n * Escape HTML special characters\n * @param text - Raw text\n * @returns Escaped HTML string\n */\nexport function escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n","/**\n * ComfyUI Data Manager - Browser Panel Component\n */\n\nimport { FILE_TYPES } from '../../core/constants.js';\nimport { getFileType } from '../../utils/file-type.js';\nimport { formatDate, formatSize, escapeHtml } from '../../utils/format.js';\nimport type { FileItem } from '../../core/state.js';\n\n/**\n * Create file browser panel\n * @param viewMode - View mode ('list' or 'grid')\n * @returns Panel element\n */\nexport function createBrowserPanel(viewMode: 'list' | 'grid' = 'list'): HTMLElement {\n  const panel = document.createElement(\"div\");\n  panel.id = \"dm-browser-panel\";\n  panel.className = \"dm-browser-panel\";\n  panel.style.cssText = `\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    border-right: 1px solid;\n    overflow: hidden;\n  `;\n\n  if (viewMode === 'list') {\n    panel.appendChild(createListHeader());\n  }\n\n  const content = document.createElement(\"div\");\n  content.id = \"dm-file-list\";\n  if (viewMode === 'grid') {\n    content.style.cssText = `\n      flex: 1;\n      overflow-y: auto;\n      padding: 10px;\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\n      gap: 8px;\n      align-content: start;\n    `;\n  } else {\n    content.style.cssText = `\n      flex: 1;\n      overflow-y: auto;\n      padding: 5px 0;\n    `;\n  }\n  content.innerHTML = `\n    <div class=\"dm-browser-loading\" style=\"text-align: center; padding: 40px;\">\n      <i class=\"pi pi-spin pi-spinner\" style=\"font-size: 24px;\"></i>\n    </div>\n  `;\n  panel.appendChild(content);\n\n  return panel;\n}\n\n/**\n * Create list view header\n * @returns Header element\n */\nfunction createListHeader(): HTMLElement {\n  const header = document.createElement(\"div\");\n  header.className = \"dm-list-header\";\n  header.style.cssText = `\n    display: flex;\n    padding: 10px 15px;\n    border-bottom: 1px solid;\n    font-size: 12px;\n    font-weight: 600;\n  `;\n\n  const createHeaderCell = (sortKey: string, label: string, width: string) => {\n    const cell = document.createElement(\"div\");\n    cell.className = \"dm-header-cell\";\n    cell.dataset.sort = sortKey;\n    cell.style.cssText = `${width}; cursor: pointer; display: flex; align-items: center; gap: 5px; user-select: none;`;\n    cell.innerHTML = `<span>${label}</span><i class=\"pi pi-sort\" style=\"font-size: 10px; opacity: 0.5;\"></i>`;\n    cell.onclick = async () => {\n      const { toggleSort } = await import('../components/actions.js');\n      toggleSort(sortKey as 'name' | 'size' | 'modified');\n    };\n    return cell;\n  };\n\n  header.appendChild(createHeaderCell(\"name\", \"\", \"flex: 1;\"));\n  header.appendChild(createHeaderCell(\"size\", \"\", \"flex: 0 0 100px;\"));\n  header.appendChild(createHeaderCell(\"modified\", \"\", \"flex: 0 0 150px;\"));\n\n  return header;\n}\n\n/**\n * Create list item HTML\n * @param file - File object\n * @param isParent - Whether it's parent directory\n * @returns HTML string\n */\nexport function createFileListItem(file: FileItem, isParent: boolean): string {\n  const fileType = getFileType(file);\n  const icon = FILE_TYPES[fileType]?.icon || FILE_TYPES.unknown.icon;\n  const color = FILE_TYPES[fileType]?.color || FILE_TYPES.unknown.color;\n\n  const size = file.is_dir ? \"\" : formatSize(file.size ?? 0) || \"\";\n  const modified = file.modified ? formatDate(String(file.modified)) : \"\";\n\n  return `\n    <div class=\"dm-file-item\" data-path=\"${escapeHtml(file.path || file.name)}\" data-is-dir=\"${file.is_dir || false}\"\n         style=\"display: flex; align-items: center; padding: 10px 15px;\n                border-bottom: 1px solid; cursor: pointer;\n                transition: background 0.2s;\">\n      <div style=\"flex: 1; display: flex; align-items: center; gap: 10px; overflow: hidden;\">\n        <i class=\"pi ${icon} dm-file-icon\" style=\"color: ${color}; font-size: 16px;\"></i>\n        <span class=\"dm-file-name\" style=\"font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${escapeHtml(file.name)}</span>\n      </div>\n      <div class=\"dm-file-size\" style=\"flex: 0 0 100px; font-size: 12px;\">${size}</div>\n      <div class=\"dm-file-modified\" style=\"flex: 0 0 150px; font-size: 12px;\">${modified}</div>\n    </div>\n  `;\n}\n\n/**\n * Create grid item HTML\n * @param file - File object\n * @param isParent - Whether it's parent directory\n * @returns HTML string\n */\nexport function createFileGridItem(file: FileItem, isParent: boolean): string {\n  // Parent directory uses special style\n  if (isParent) {\n    return `\n      <div class=\"dm-grid-item dm-grid-item-parent\" data-path=\"${file.path}\" data-is-dir=\"true\"\n           data-name=\"..\"\n           style=\"display: flex; flex-direction: column; align-items: center; justify-content: center;\n                  padding: 12px 8px; height: 90px;\n                  border-radius: 8px; cursor: pointer;\n                  transition: all 0.2s; border: 2px dashed; box-sizing: border-box;\">\n        <i class=\"pi pi-folder-open dm-parent-icon\" style=\"font-size: 40px;\"></i>\n        <span class=\"dm-parent-text\" style=\"font-size: 11px; text-align: center;\n                      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\n                      width: 100%; margin-top: 8px;\"></span>\n      </div>\n    `;\n  }\n\n  const fileType = getFileType(file);\n  const icon = FILE_TYPES[fileType]?.icon || FILE_TYPES.unknown.icon;\n  const color = FILE_TYPES[fileType]?.color || FILE_TYPES.unknown.color;\n\n  return `\n    <div class=\"dm-grid-item\" data-path=\"${escapeHtml(file.path || file.name)}\" data-is-dir=\"${file.is_dir || false}\"\n         data-name=\"${escapeHtml(file.name)}\"\n         style=\"display: flex; flex-direction: column; align-items: center; justify-content: center;\n                padding: 12px 8px; height: 90px;\n                border-radius: 8px; cursor: pointer;\n                transition: all 0.2s; border: 2px solid; box-sizing: border-box;\">\n      <i class=\"pi ${icon} dm-grid-icon\" style=\"color: ${color}; font-size: 40px;\"></i>\n      <span class=\"dm-grid-filename\" style=\"font-size: 11px; text-align: center;\n                    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\n                    width: 100%; margin-top: 8px;\">${escapeHtml(file.name)}</span>\n    </div>\n  `;\n}\n","/**\n * ComfyUI Data Manager - Format Selector Component\n */\n\n/**\n * Format type map\n */\nexport const FORMAT_TYPE_MAP: Record<string, { type: string; label: string; description: string }> = {\n  \"png\": { type: \"IMAGE\", label: \"PNG \", description: \"\" },\n  \"jpg\": { type: \"IMAGE\", label: \"JPEG \", description: \"\" },\n  \"webp\": { type: \"IMAGE\", label: \"WebP \", description: \"\" },\n  \"mp4\": { type: \"VIDEO\", label: \"MP4 \", description: \"\" },\n  \"webm\": { type: \"VIDEO\", label: \"WebM \", description: \"\" },\n  \"avi\": { type: \"VIDEO\", label: \"AVI \", description: \"\" },\n  \"mp3\": { type: \"AUDIO\", label: \"MP3 \", description: \"\" },\n  \"wav\": { type: \"AUDIO\", label: \"WAV \", description: \"\" },\n  \"flac\": { type: \"AUDIO\", label: \"FLAC \", description: \"\" },\n  \"ogg\": { type: \"AUDIO\", label: \"OGG \", description: \"\" },\n  \"latent\": { type: \"LATENT\", label: \"Latent\", description: \"ComfyUI Latent \" },\n  \"json\": { type: \"DATA\", label: \"JSON\", description: \"\" },\n  \"txt\": { type: \"DATA\", label: \"\", description: \"\" },\n};\n\n/**\n * Type to formats mapping\n */\nexport const TYPE_FORMATS: Record<string, string[]> = {\n  \"IMAGE\": [\"png\", \"jpg\", \"webp\"],\n  \"VIDEO\": [\"mp4\", \"webm\", \"avi\"],\n  \"AUDIO\": [\"mp3\", \"wav\", \"flac\", \"ogg\"],\n  \"LATENT\": [\"latent\"],\n  \"MASK\": [\"png\"],\n  \"CONDITIONING\": [\"json\"],\n  \"STRING\": [\"txt\", \"json\"],\n};\n\n/**\n * Format selector options\n */\nexport interface FormatSelectorOptions {\n  detectedType?: string | null;\n  selectedFormat?: string | null;\n  onFormatChange?: ((format: string) => void) | null;\n  showTypeIndicator?: boolean;\n  compact?: boolean;\n}\n\n/**\n * Get formats for type (internal use)\n * @param type - Data type\n * @returns Array of format strings\n */\nfunction getFormatsForType(type: string): string[] {\n  const typeKey = type.toUpperCase();\n  return TYPE_FORMATS[typeKey] || [\"json\"];\n}\n\n/**\n * Get type color\n * @param type - Data type\n * @returns Color string\n */\nfunction getTypeColor(type: string): string {\n  const colors: Record<string, string> = {\n    \"IMAGE\": \"#e74c3c\",\n    \"VIDEO\": \"#9b59b6\",\n    \"AUDIO\": \"#3498db\",\n    \"LATENT\": \"#27ae60\",\n    \"MASK\": \"#f39c12\",\n    \"DATA\": \"#95a5a6\",\n  };\n  return colors[type] || \"#95a5a6\";\n}\n\n/**\n * Get type icon\n * @param type - Data type\n * @returns Icon class name\n */\nfunction getTypeIcon(type: string): string {\n  const icons: Record<string, string> = {\n    \"IMAGE\": \"pi-image\",\n    \"VIDEO\": \"pi-video\",\n    \"AUDIO\": \"pi-volume-up\",\n    \"LATENT\": \"pi-cube\",\n    \"MASK\": \"pi-mask\",\n    \"DATA\": \"pi-file\",\n  };\n  return icons[type] || \"pi-file\";\n}\n\n/**\n * Create format selector\n * @param options - Configuration options\n * @returns Format selector element\n */\nexport function createFormatSelector(options: FormatSelectorOptions = {}): HTMLElement {\n  const {\n    detectedType = null,\n    selectedFormat = null,\n    onFormatChange = null,\n    showTypeIndicator = true,\n    compact = false\n  } = options;\n\n  const container = document.createElement(\"div\");\n  container.className = \"dm-format-selector\";\n  container.style.cssText = `\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    padding: 15px;\n    background: #252525;\n    border-radius: 8px;\n    border: 1px solid #3a3a3a;\n  `;\n\n  // Type indicator\n  if (showTypeIndicator && detectedType) {\n    const typeIndicator = document.createElement(\"div\");\n    typeIndicator.className = \"dm-type-indicator\";\n    typeIndicator.style.cssText = `\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px 12px;\n      background: ${getTypeColor(detectedType)}20;\n      border-left: 3px solid ${getTypeColor(detectedType)};\n      border-radius: 4px;\n      font-size: 12px;\n      color: ${getTypeColor(detectedType)};\n    `;\n    typeIndicator.innerHTML = `\n      <i class=\"pi ${getTypeIcon(detectedType)}\"></i>\n      <span style=\"font-weight: 600;\">${detectedType}</span>\n      <span style=\"color: #888;\"></span>\n    `;\n    container.appendChild(typeIndicator);\n  }\n\n  // Format selection area\n  const formatSection = document.createElement(\"div\");\n  formatSection.style.cssText = `\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  `;\n\n  const label = document.createElement(\"label\");\n  label.style.cssText = `\n    font-size: 12px;\n    color: #aaa;\n    font-weight: 500;\n  `;\n  label.textContent = \":\";\n  formatSection.appendChild(label);\n\n  const formats = detectedType ? getFormatsForType(detectedType) : Object.keys(FORMAT_TYPE_MAP);\n  const defaultFormat = selectedFormat || (detectedType ? formats[0] : \"png\");\n\n  if (compact) {\n    // Compact mode: use dropdown\n    const select = document.createElement(\"select\");\n    select.id = \"dm-format-select\";\n    select.className = \"comfy-combo\";\n    select.style.cssText = `\n      width: 100%;\n      padding: 8px 12px;\n      background: #2a2a2a;\n      border: 1px solid #3a3a3a;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 13px;\n      cursor: pointer;\n    `;\n    formats.forEach(fmt => {\n      const option = document.createElement(\"option\");\n      option.value = fmt;\n      option.textContent = fmt.toUpperCase();\n      if (fmt === defaultFormat) option.selected = true;\n      select.appendChild(option);\n    });\n    select.onchange = (e) => {\n      if (onFormatChange) {\n        onFormatChange((e.target as HTMLSelectElement).value);\n      }\n      updateFormatDescription((e.target as HTMLSelectElement).value);\n    };\n    formatSection.appendChild(select);\n  } else {\n    // Full mode: use button group\n    const buttonGroup = document.createElement(\"div\");\n    buttonGroup.style.cssText = `\n      display: flex;\n      flex-wrap: wrap;\n      gap: 6px;\n    `;\n    buttonGroup.id = \"dm-format-buttons\";\n\n    formats.forEach(fmt => {\n      const btn = document.createElement(\"button\");\n      btn.className = \"comfy-btn dm-format-btn\";\n      btn.dataset.format = fmt;\n      btn.style.cssText = `\n        padding: 8px 16px;\n        background: ${fmt === defaultFormat ? \"#3a3a3a\" : \"#2a2a2a\"};\n        border: 1px solid ${fmt === defaultFormat ? \"#9b59b6\" : \"#3a3a3a\"};\n        border-radius: 6px;\n        color: ${fmt === defaultFormat ? \"#9b59b6\" : \"#fff\"};\n        font-size: 12px;\n        font-weight: ${fmt === defaultFormat ? \"600\" : \"400\"};\n        cursor: pointer;\n        transition: all 0.2s;\n      `;\n      btn.textContent = fmt.toUpperCase();\n      btn.onclick = () => {\n        // Update all button states\n        buttonGroup.querySelectorAll('.dm-format-btn').forEach(b => {\n          const btnEl = b as HTMLElement;\n          btnEl.style.background = \"#2a2a2a\";\n          btnEl.style.borderColor = \"#3a3a3a\";\n          btnEl.style.color = \"#fff\";\n          btnEl.style.fontWeight = \"400\";\n        });\n        // Activate current button\n        btn.style.background = \"#3a3a3a\";\n        btn.style.borderColor = \"#9b59b6\";\n        btn.style.color = \"#9b59b6\";\n        btn.style.fontWeight = \"600\";\n        if (onFormatChange) {\n          onFormatChange(fmt);\n        }\n        updateFormatDescription(fmt);\n      };\n      buttonGroup.appendChild(btn);\n    });\n    formatSection.appendChild(buttonGroup);\n  }\n\n  container.appendChild(formatSection);\n\n  // Format description\n  const description = document.createElement(\"div\");\n  description.id = \"dm-format-description\";\n  description.style.cssText = `\n    font-size: 11px;\n    color: #888;\n    padding: 8px 12px;\n    background: #1a1a1a;\n    border-radius: 4px;\n  `;\n  description.textContent = FORMAT_TYPE_MAP[defaultFormat]?.description || \"\";\n  container.appendChild(description);\n\n  // Initialize format description\n  updateFormatDescription(defaultFormat);\n\n  return container;\n}\n\n/**\n * Update format description\n * @param format - Format string\n */\nfunction updateFormatDescription(format: string): void {\n  const descriptionEl = document.getElementById(\"dm-format-description\");\n  if (descriptionEl) {\n    (descriptionEl as HTMLElement).textContent = FORMAT_TYPE_MAP[format]?.description || \"\";\n  }\n}\n","/**\n * ComfyUI Data Manager - Preview Panel Component\n */\n\nimport { createFormatSelector, type FormatSelectorOptions } from './format-selector.js';\n\n// ==================== Constants ====================\nconst DEFAULT_DETECTED_TYPE = \"IMAGE\";\n\n/**\n * Preview panel callbacks\n */\nexport interface PreviewCallbacks {\n  onOpenFloating?: () => void;\n  onCopyPath?: () => void;\n  onDelete?: () => void;\n}\n\n/**\n * Check node connection and update format selector\n */\nexport function checkNodeConnectionAndUpdateFormat(): void {\n  try {\n    const app = (window as unknown as { app?: { graph?: { _nodes?: unknown[]; getNodeById?: (id: number) => unknown } } }).app;\n    const nodes = app?.graph?._nodes || [];\n    const inputPathConfigNodes = nodes.filter((n: unknown) => (n as { comfyClass?: string }).comfyClass === \"InputPathConfig\");\n\n    if (inputPathConfigNodes.length === 0) {\n      return;\n    }\n\n    const node = inputPathConfigNodes[0] as { inputs?: Array<{ name?: string; link?: { origin_id?: number } }> };\n    const inputs = node.inputs || [];\n    const fileInput = inputs.find((i: { name?: string }) => i.name === 'file_input');\n\n    if (fileInput && fileInput.link) {\n      const sourceNodeId = fileInput.link.origin_id;\n      const sourceNode = sourceNodeId !== undefined ? app?.graph?.getNodeById?.(sourceNodeId) : undefined;\n      if (sourceNode) {\n        const detectedType = detectTypeFromSourceNode(sourceNode);\n        updateFormatSelector(detectedType, null, null);\n      }\n    }\n  } catch (e) {\n    console.log(\"[DataManager] Error checking node connection:\", e);\n  }\n}\n\n/**\n * Detect data type from node type\n * @param node - Source node\n * @returns Detected type string\n */\nfunction detectTypeFromSourceNode(node: { type?: string; comfyClass?: string; outputs?: Array<{ type?: string }> }): string {\n  const nodeType = node.type || node.comfyClass || \"\";\n\n  // Type mapping\n  const typeMapping: Record<string, string> = {\n    \"LoadImage\": \"IMAGE\",\n    \"LoadVideo\": \"VIDEO\",\n    \"LoadAudio\": \"AUDIO\",\n    \"EmptyLatentImage\": \"LATENT\",\n    \"VAEDecode\": \"IMAGE\",\n    \"CheckpointLoaderSimple\": \"MODEL\",\n  };\n\n  // Check output port types\n  if (node.outputs && node.outputs.length > 0) {\n    for (const output of node.outputs) {\n      if (output.type === \"IMAGE\") return \"IMAGE\";\n      if (output.type === \"LATENT\") return \"LATENT\";\n      if (output.type === \"MASK\") return \"MASK\";\n      if (output.type === \"VIDEO\") return \"VIDEO\";\n      if (output.type === \"AUDIO\") return \"AUDIO\";\n      if (output.type === \"MODEL\") return \"MODEL\";\n      if (output.type === \"VAE\") return \"VAE\";\n      if (output.type === \"CLIP\") return \"CLIP\";\n    }\n  }\n\n  // Use node type mapping\n  for (const [key, value] of Object.entries(typeMapping)) {\n    if (nodeType.includes(key)) {\n      return value;\n    }\n  }\n\n  return DEFAULT_DETECTED_TYPE;\n}\n\n/**\n * Create preview panel\n * @param callbacks - Callback functions\n * @returns Panel element\n */\nexport function createPreviewPanel(callbacks: PreviewCallbacks = {}): HTMLElement {\n  const { onOpenFloating, onCopyPath, onDelete } = callbacks;\n\n  const panel = document.createElement(\"div\");\n  panel.id = \"dm-preview-panel\";\n  panel.style.cssText = `\n    flex: 0 0 400px;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n  `;\n\n  const header = document.createElement(\"div\");\n  header.className = \"dm-preview-header\";\n  header.style.cssText = `\n    padding: 15px;\n    border-bottom: 1px solid;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: 10px;\n  `;\n  header.innerHTML = `\n    <h3 class=\"dm-title\" style=\"margin: 0; font-size: 14px;\">\n      <i class=\"pi pi-eye\"></i> \n    </h3>\n    <div style=\"display: flex; gap: 5px;\">\n      <button id=\"dm-copy-path-btn\" class=\"comfy-btn dm-icon-btn\" style=\"padding: 6px 12px; font-size: 12px;\">\n        <i class=\"pi pi-copy\"></i>\n      </button>\n      <button id=\"dm-delete-file-btn\" class=\"comfy-btn dm-icon-btn\" style=\"padding: 6px 12px; font-size: 12px;\">\n        <i class=\"pi pi-trash\"></i>\n      </button>\n      <button id=\"dm-open-floating-preview-btn\" class=\"comfy-btn dm-icon-btn\" style=\"display: none; padding: 6px 12px; font-size: 12px;\">\n        <i class=\"pi pi-window-maximize\"></i>\n      </button>\n    </div>\n  `;\n  panel.appendChild(header);\n\n  const content = document.createElement(\"div\");\n  content.id = \"dm-preview-content\";\n  content.style.cssText = `\n    flex: 1;\n    overflow-y: auto;\n    padding: 15px;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n  `;\n  content.innerHTML = `\n    <div style=\"text-align: center; padding: 40px; color: #666;\">\n      <i class=\"pi pi-file\" style=\"font-size: 48px; opacity: 0.5;\"></i>\n      <div style=\"margin-top: 15px; font-size: 13px;\"></div>\n    </div>\n  `;\n  panel.appendChild(content);\n\n  // Format selector area\n  const formatSection = document.createElement(\"div\");\n  formatSection.id = \"dm-format-section\";\n  formatSection.style.cssText = `\n    padding: 15px;\n    background: #1f1f1f;\n    border-top: 1px solid #2a2a2a;\n    display: none;\n  `;\n  formatSection.innerHTML = `\n    <div style=\"text-align: center; padding: 20px; color: #666;\">\n      <i class=\"pi pi-cog\" style=\"font-size: 32px; opacity: 0.5;\"></i>\n      <div style=\"margin-top: 10px; font-size: 12px;\"></div>\n    </div>\n  `;\n  panel.appendChild(formatSection);\n\n  // File info area\n  const infoSection = document.createElement(\"div\");\n  infoSection.id = \"dm-file-info\";\n  infoSection.style.cssText = `\n    padding: 15px;\n    background: #252525;\n    border-top: 1px solid #2a2a2a;\n    font-size: 12px;\n    color: #888;\n  `;\n  infoSection.innerHTML = '<div style=\"text-align: center;\">No file selected</div>';\n  panel.appendChild(infoSection);\n\n  // Bind button events\n  const floatingBtn = header.querySelector('#dm-open-floating-preview-btn') as HTMLButtonElement;\n  const copyPathBtn = header.querySelector('#dm-copy-path-btn') as HTMLButtonElement;\n  const deleteBtn = header.querySelector('#dm-delete-file-btn') as HTMLButtonElement;\n\n  if (floatingBtn && onOpenFloating) {\n    floatingBtn.onclick = onOpenFloating;\n  }\n  if (copyPathBtn && onCopyPath) {\n    copyPathBtn.onclick = onCopyPath;\n  }\n  if (deleteBtn && onDelete) {\n    deleteBtn.onclick = onDelete;\n  }\n\n  return panel;\n}\n\n/**\n * Update format selector\n * @param detectedType - Detected type\n * @param currentFormat - Current format\n * @param onFormatChange - Format change callback\n */\nexport function updateFormatSelector(detectedType: string | null, currentFormat: string | null = null, onFormatChange: ((format: string) => void) | null = null): void {\n  const formatSection = document.getElementById(\"dm-format-section\");\n  if (!formatSection) return;\n\n  formatSection.innerHTML = '';\n\n  if (!detectedType) {\n    formatSection.style.display = 'none';\n    return;\n  }\n\n  formatSection.style.display = 'block';\n\n  const selector = createFormatSelector({\n    detectedType: detectedType,\n    selectedFormat: currentFormat,\n    onFormatChange: onFormatChange,\n    compact: true\n  });\n\n  formatSection.appendChild(selector);\n}\n\n/**\n * Hide format selector\n */\nexport function hideFormatSelector(): void {\n  const formatSection = document.getElementById(\"dm-format-section\");\n  if (formatSection) {\n    formatSection.style.display = 'none';\n  }\n}\n\n/**\n * Create status bar\n * @returns Status bar element\n */\nexport function createStatusBar(): HTMLElement {\n  // Create bottom area container (contains Dock and status bar)\n  const bottomArea = document.createElement(\"div\");\n  bottomArea.className = \"dm-bottom-area\";\n  bottomArea.style.cssText = `\n    display: flex;\n    flex-direction: column;\n  `;\n\n  // Create Dock\n  const dock = document.createElement(\"div\");\n  dock.id = \"dm-preview-dock\";\n  dock.className = \"dm-preview-dock\";\n  dock.style.cssText = `\n    min-height: 0;\n    max-height: 0;\n    padding: 0 15px;\n    background: linear-gradient(to bottom, #252525, #1a1a1a);\n    border-top: 1px solid #2a2a2a;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    overflow-x: auto;\n    overflow-y: hidden;\n    transition: min-height 0.3s ease, max-height 0.3s ease, padding 0.3s ease;\n  `;\n\n  // Create status bar\n  const bar = document.createElement(\"div\");\n  bar.id = \"dm-status-bar\";\n  bar.innerHTML = `\n    <div id=\"dm-connection-status\" style=\"color: #27ae60;\"></div>\n    <div style=\"display: flex; align-items: center; gap: 10px;\">\n      <span id=\"dm-status-ready\"></span>\n      <div id=\"dm-connection-indicator\" style=\"width: 8px; height: 8px; border-radius: 50%; background: #666; transition: background 0.3s ease;\"></div>\n    </div>\n  `;\n\n  bottomArea.appendChild(dock);\n  bottomArea.appendChild(bar);\n\n  // Delay update connection status\n  setTimeout(() => {\n    const indicator = document.getElementById(\"dm-connection-indicator\");\n    const statusText = document.getElementById(\"dm-connection-status\");\n    const state = (window as unknown as { _remoteConnectionsState: { active: unknown } })._remoteConnectionsState;\n    const active = state?.active;\n    if (indicator) {\n      (indicator as HTMLElement).style.background = active ? '#27ae60' : '#666';\n    }\n    if (statusText && active) {\n      const conn = active as { username?: string; host?: string };\n      statusText.textContent = `SSH: ${conn.username}@${conn.host}`;\n    }\n  }, 100);\n\n  return bottomArea;\n}\n\n// Import FileManagerState for currentPath reference\nimport { FileManagerState } from '../../core/state.js';\n","/**\n * ComfyUI Data Manager - Drag Utilities\n */\n\n/**\n * Setup window drag functionality\n * Adds event listeners dynamically on drag start, removes on drag end\n * @param windowEl - Window element\n * @param header - Header element (drag handle area)\n */\nexport function setupWindowDrag(windowEl: HTMLElement, header: HTMLElement): void {\n  // Disable native drag to prevent ghost image\n  windowEl.draggable = false;\n  header.draggable = false;\n\n  // Prevent native drag events\n  windowEl.addEventListener(\"dragstart\", (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    return false;\n  });\n\n  header.addEventListener(\"mousedown\", (e) => {\n    // Exclude buttons and icons\n    if (e.target && (e.target as HTMLElement).tagName === \"BUTTON\" || (e.target as HTMLElement).tagName === \"I\") return;\n\n    // Don't allow dragging when fullscreen\n    if (windowEl.dataset.fullscreen === \"true\") return;\n\n    // Prevent default behavior (including native drag)\n    e.preventDefault();\n\n    const rect = windowEl.getBoundingClientRect();\n    const offsetX = e.clientX - rect.left;\n    const offsetY = e.clientY - rect.top;\n\n    // Remove transition for performance\n    windowEl.style.transition = \"none\";\n\n    // Clear transform, use left/top positioning\n    windowEl.style.transform = \"none\";\n    windowEl.style.left = rect.left + \"px\";\n    windowEl.style.top = rect.top + \"px\";\n\n    // Mark as dragging\n    (windowEl as unknown as { _isDragging: boolean })._isDragging = true;\n\n    // Define mousemove handler\n    const mouseMoveHandler = (e: MouseEvent) => {\n      if (!(windowEl as unknown as { _isDragging: boolean })._isDragging) return;\n      const x = e.clientX - offsetX;\n      const y = e.clientY - offsetY;\n      windowEl.style.left = Math.max(0, x) + \"px\";\n      windowEl.style.top = Math.max(0, y) + \"px\";\n    };\n\n    // Define mouseup handler\n    const mouseUpHandler = () => {\n      // Restore transition\n      windowEl.style.transition = \"\";\n\n      // Clear dragging flag\n      (windowEl as unknown as { _isDragging: boolean })._isDragging = false;\n\n      // Immediately remove listeners\n      document.removeEventListener(\"mousemove\", mouseMoveHandler);\n      document.removeEventListener(\"mouseup\", mouseUpHandler);\n    };\n\n    // Add listeners to document (ensure response even when mouse leaves window)\n    document.addEventListener(\"mousemove\", mouseMoveHandler);\n    document.addEventListener(\"mouseup\", mouseUpHandler);\n  });\n}\n\n/**\n * Cleanup window drag state\n * @param windowEl - Window element\n */\nexport function cleanupWindowDrag(windowEl: HTMLElement): void {\n  if ((windowEl as unknown as { _isDragging?: boolean })._isDragging) {\n    (windowEl as unknown as { _isDragging: boolean })._isDragging = false;\n    windowEl.style.transition = \"\";\n  }\n}\n","/**\n * ComfyUI Data Manager - Main File Manager Window\n */\n\nimport { createHeader } from './components/header.js';\nimport { createToolbar, type ToolbarCallbacks } from './components/toolbar.js';\nimport { createBrowserPanel } from './components/browser.js';\nimport { createPreviewPanel, createStatusBar, type PreviewCallbacks } from './components/preview.js';\nimport { loadDirectory } from './components/actions.js';\nimport { setupWindowDrag } from '../utils/drag.js';\nimport { FileManagerState } from '../core/state.js';\n\n// Keyboard event handler reference\nlet keydownHandler: ((e: KeyboardEvent) => void) | null = null;\n\n/**\n * Window callbacks\n */\nexport interface WindowManagerCallbacks extends ToolbarCallbacks, PreviewCallbacks {\n  onClose?: () => void;\n  onRefresh?: () => void;\n  onOpenFloating?: () => void;\n  onCopyPath?: () => void;\n  onDelete?: () => void;\n}\n\n/**\n * Create file manager window\n * @param callbacks - Callback functions object\n * @returns Window element\n */\nexport function createFileManagerWindow(callbacks: WindowManagerCallbacks = {}): HTMLElement {\n  const window = document.createElement(\"div\");\n  window.id = \"dm-file-manager\";\n  window.style.cssText = `\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 1200px;\n    height: 700px;\n    max-width: calc(100vw - 40px);\n    max-height: calc(100vh - 40px);\n    background: #1a1a1a;\n    border: 1px solid #3a3a3a;\n    border-radius: 12px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n    z-index: 10000;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n  `;\n\n  // Assemble window\n  window.appendChild(createHeader({\n    title: 'Data Manager',\n    icon: 'pi-folder-open',\n    onClose: callbacks.onClose,\n    onRefresh: callbacks.onRefresh\n  }));\n  window.appendChild(createToolbar(callbacks));\n  window.appendChild(createMainContent(callbacks));\n  window.appendChild(createStatusBar());\n\n  document.body.appendChild(window);\n\n  // Setup drag\n  const header = window.querySelector('.dm-header') as HTMLElement;\n  setupWindowDrag(window, header);\n\n  // Add keyboard event listener (ESC to close)\n  keydownHandler = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      e.preventDefault();\n      e.stopPropagation();\n      if (callbacks.onClose) callbacks.onClose();\n    }\n  };\n  document.addEventListener('keydown', keydownHandler, { capture: true });\n\n  return window;\n}\n\n/**\n * Destroy window (cleanup event listeners)\n */\nexport function destroyFileManagerWindow(): void {\n  // Remove keyboard event listener\n  if (keydownHandler) {\n    document.removeEventListener('keydown', keydownHandler, { capture: true });\n    keydownHandler = null;\n  }\n\n  // Remove window element\n  const window = document.getElementById('dm-file-manager');\n  if (window) {\n    window.remove();\n  }\n}\n\n/**\n * Create main content area\n * @param callbacks - Callback functions object\n * @returns Main content element\n */\nfunction createMainContent(callbacks: WindowManagerCallbacks): HTMLElement {\n  const mainContent = document.createElement(\"div\");\n  mainContent.style.cssText = \"flex: 1; display: flex; overflow: hidden;\";\n\n  const browserPanel = createBrowserPanel(FileManagerState.viewMode);\n  mainContent.appendChild(browserPanel);\n\n  const previewPanel = createPreviewPanel({\n    onOpenFloating: callbacks.onOpenFloating,\n    onCopyPath: callbacks.onCopyPath,\n    onDelete: callbacks.onDelete\n  });\n  mainContent.appendChild(previewPanel);\n\n  return mainContent;\n}\n","/**\n * ComfyUI Data Manager - File API Endpoints\n */\n\nimport { API_ENDPOINTS } from '../../core/constants.js';\n\n/**\n * Directory listing response\n */\nexport interface DirectoryListResponse {\n  files: unknown[];\n  path: string;\n}\n\n/**\n * File info response\n */\nexport interface FileInfo {\n  path: string;\n  name: string;\n  size: number;\n  modified: number;\n  isDir: boolean;\n  type?: string;\n}\n\n/**\n * Create file/directory response\n */\nexport interface CreateResponse {\n  success: boolean;\n  path?: string;\n  error?: string;\n  message?: string;\n}\n\n/**\n * List directory contents\n * @param path - Directory path\n * @returns Directory data\n */\nexport async function listDirectory(path: string): Promise<DirectoryListResponse> {\n  const response = await fetch(API_ENDPOINTS.LIST, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ path })\n  });\n\n  if (response?.ok) {\n    return await response.json() as DirectoryListResponse;\n  }\n\n  const errorData = await response.json().catch(() => ({})) as Record<string, unknown>;\n  const errorMsg = (errorData.error as string) || (errorData.message as string) || `HTTP ${response.status}`;\n  throw new Error(`Failed to list directory: ${errorMsg}`);\n}\n\n/**\n * Get file preview URL\n * @param path - File path\n * @returns Preview URL\n */\nexport function getPreviewUrl(path: string): string {\n  return `${API_ENDPOINTS.PREVIEW}?path=${encodeURIComponent(path)}`;\n}\n\n/**\n * Get file information\n * @param path - File path\n * @returns File info object\n */\nexport async function getFileInfo(path: string): Promise<FileInfo> {\n  const response = await fetch(API_ENDPOINTS.INFO, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ path })\n  });\n\n  if (response?.ok) {\n    const data = await response.json() as { info: FileInfo };\n    return data.info;\n  }\n\n  const errorData = await response.json().catch(() => ({})) as Record<string, unknown>;\n  const errorMsg = (errorData.error as string) || (errorData.message as string) || `HTTP ${response.status}`;\n  throw new Error(`Failed to get file info: ${errorMsg}`);\n}\n\n/**\n * Create new file\n * @param directory - Target directory\n * @param filename - File name\n * @param content - File content (default empty)\n * @returns Creation result\n */\nexport async function createFile(\n  directory: string,\n  filename: string,\n  content = \"\"\n): Promise<CreateResponse> {\n  const response = await fetch(API_ENDPOINTS.CREATE_FILE, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ directory, filename, content })\n  });\n\n  if (response?.ok) {\n    return await response.json() as CreateResponse;\n  }\n\n  const error = await response.json().catch(() => ({ error: \"Unknown error\" })) as CreateResponse;\n  throw new Error(error.error || error.message || 'Failed to create file');\n}\n\n/**\n * Create new directory\n * @param directory - Parent directory\n * @param dirname - Directory name\n * @returns Creation result\n */\nexport async function createDirectory(\n  directory: string,\n  dirname: string\n): Promise<CreateResponse> {\n  const response = await fetch(API_ENDPOINTS.CREATE_DIRECTORY, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ directory, dirname })\n  });\n\n  if (response?.ok) {\n    return await response.json() as CreateResponse;\n  }\n\n  const error = await response.json().catch(() => ({ error: \"Unknown error\" })) as CreateResponse;\n  throw new Error(error.error || error.message || 'Failed to create directory');\n}\n\n/**\n * Delete file or directory\n * @param path - File or directory path\n * @param useTrash - Move to trash (default true)\n * @returns Deletion result\n */\nexport async function deleteFile(\n  path: string,\n  useTrash = true\n): Promise<{ success: boolean; error?: string }> {\n  const response = await fetch(API_ENDPOINTS.DELETE, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ path, use_trash: useTrash })\n  });\n\n  if (response?.ok) {\n    return await response.json() as { success: boolean };\n  }\n\n  const error = await response.json().catch(() => ({ error: \"Unknown error\" })) as { error?: string };\n  throw new Error(error.error || 'Failed to delete file');\n}\n","/**\n * ComfyUI Data Manager - Helper Utilities\n */\n\n// ComfyUI app import (external)\ndeclare const app: {\n  extensionManager?: {\n    toast?: {\n      add: (options: { severity: string; summary: string; detail: string; life?: number }) => void;\n    };\n  };\n};\n\n/**\n * Update status bar text\n * @param text - Status text\n */\nexport function updateStatus(text: string): void {\n  const statusBar = document.getElementById(\"dm-status-bar\");\n  if (statusBar) {\n    statusBar.textContent = text;\n  }\n}\n\n/**\n * Show toast notification\n * @param severity - Severity level (info, success, warn, error)\n * @param summary - Title\n * @param detail - Detail message\n */\nexport function showToast(severity: string, summary: string, detail: string): void {\n  if (typeof app !== 'undefined' && app.extensionManager?.toast) {\n    app.extensionManager.toast.add({\n      severity,\n      summary,\n      detail,\n      life: 3000\n    });\n  } else {\n    console.log(`[${severity.toUpperCase()}] ${summary}: ${detail}`);\n  }\n}\n\n/**\n * Get parent directory path\n * @param path - Current path\n * @returns Parent path\n */\nexport function getParentPath(path: string): string {\n  const normalized = path.replace(/\\\\/g, \"/\");\n  const lastSlash = normalized.lastIndexOf(\"/\");\n  if (lastSlash <= 0) return \".\";\n  return normalized.substring(0, lastSlash);\n}\n\n/**\n * Extract filename from path\n * @param path - File path\n * @returns Filename\n */\nexport function getFileName(path: string): string {\n  return path.split(/[/\\\\]/).pop() || \"\";\n}\n\n/**\n * Extract file extension from path\n * @param path - File path\n * @returns Extension with dot\n */\nexport function getExt(path: string): string {\n  const parts = path.split('.');\n  const ext = parts.pop()?.toLowerCase() || \"\";\n  return '.' + ext;\n}\n","/**\n * ComfyUI Data Manager - Actions Component\n */\n\nimport { listDirectory } from '../../api/endpoints/file.js';\nimport { FileManagerState, saveLastPath, type FileItem } from '../../core/state.js';\nimport { updateStatus, showToast, getParentPath } from '../../utils/helpers.js';\nimport { createFileListItem, createFileGridItem } from './browser.js';\nimport type { SortBy } from '../../core/types.js';\n\n/**\n * Load directory\n * @param path - Directory path\n */\nexport async function loadDirectory(path: string): Promise<void> {\n  // Check for active SSH connection\n  const remoteConn = (window as unknown as { _remoteConnectionsState: { active: unknown } })._remoteConnectionsState?.active;\n  if (remoteConn) {\n    await loadRemoteDirectory(path, remoteConn as { connection_id: string; root_path?: string });\n    return;\n  }\n\n  updateStatus(`: ${path}...`);\n\n  try {\n    const data = await listDirectory(path);\n    FileManagerState.files = (data.files as FileItem[]) || [];\n    FileManagerState.currentPath = data.path;\n\n    // Save last visited path\n    saveLastPath(data.path);\n\n    // Save to history\n    if (FileManagerState.historyIndex === -1 ||\n        FileManagerState.history[FileManagerState.historyIndex] !== data.path) {\n      FileManagerState.history = FileManagerState.history.slice(0, FileManagerState.historyIndex + 1);\n      FileManagerState.history.push(data.path);\n      FileManagerState.historyIndex = FileManagerState.history.length - 1;\n    }\n\n    const pathInput = document.getElementById(\"dm-path-input\") as HTMLInputElement;\n    if (pathInput) pathInput.value = data.path;\n\n    renderFileListUI();\n    updateStatus(`${FileManagerState.files.length} `);\n\n  } catch (error) {\n    console.error(\"Load directory error:\", error);\n    updateStatus(\"\");\n    showToast(\"error\", \"\", \"\");\n  }\n}\n\n/**\n * Load remote SSH directory\n */\nasync function loadRemoteDirectory(path: string, conn: { connection_id: string; root_path?: string }): Promise<void> {\n  updateStatus(`: ${path}...`);\n\n  try {\n    const { sshList } = await import('../../api/ssh.js');\n    const data = await sshList(conn.connection_id, path || conn.root_path || \"/\");\n\n    FileManagerState.files = (data.files as FileItem[]) || [];\n    FileManagerState.currentPath = data.path || path;\n\n    const pathInput = document.getElementById(\"dm-path-input\") as HTMLInputElement;\n    if (pathInput) pathInput.value = `[SSH] ${data.path}`;\n\n    renderFileListUI();\n    updateStatus(`${FileManagerState.files.length}  ()`);\n\n  } catch (error) {\n    console.error(\"Load remote directory error:\", error);\n    updateStatus(\"\");\n    showToast(\"error\", \"\", `: ${(error as Error).message}`);\n  }\n}\n\n/**\n * Render file list UI\n */\nfunction renderFileListUI(): void {\n  const container = document.getElementById(\"dm-file-list\");\n  if (!container) return;\n\n  // Clear current selection\n  FileManagerState.selectedFiles = [];\n\n  // Sort files\n  const sortedFiles = [...FileManagerState.files].sort((a, b) => {\n    // Directories first\n    const aIsDir = (a as FileItem).is_dir || (a as FileItem).isDir || false;\n    const bIsDir = (b as FileItem).is_dir || (b as FileItem).isDir || false;\n    if (aIsDir && !bIsDir) return -1;\n    if (!aIsDir && bIsDir) return 1;\n\n    let comparison = 0;\n    switch (FileManagerState.sortBy) {\n      case 'name':\n        comparison = a.name.localeCompare(b.name);\n        break;\n      case 'size':\n        comparison = ((a as FileItem).size || 0) - ((b as FileItem).size || 0);\n        break;\n      case 'modified':\n        comparison = new Date((a as FileItem).modified || 0).getTime() - new Date((b as FileItem).modified || 0).getTime();\n        break;\n    }\n\n    return FileManagerState.sortOrder === 'asc' ? comparison : -comparison;\n  });\n\n  let html = \"\";\n\n  // Parent directory link\n  if (FileManagerState.currentPath !== \".\" && FileManagerState.currentPath !== \"/\") {\n    if (FileManagerState.viewMode === 'list') {\n      html += createFileListItem({\n        name: \"..\",\n        isDir: true,\n        path: getParentPath(FileManagerState.currentPath),\n        size: 0,\n        modified: undefined\n      }, true);\n    } else {\n      html += createFileGridItem({\n        name: \"..\",\n        isDir: true,\n        path: getParentPath(FileManagerState.currentPath)\n      }, true);\n    }\n  }\n\n  // Render file list\n  sortedFiles.forEach(file => {\n    html += FileManagerState.viewMode === 'list'\n      ? createFileListItem(file as FileItem, false)\n      : createFileGridItem(file as FileItem, false);\n  });\n\n  container.innerHTML = html;\n\n  // Reset scroll position to top\n  container.scrollTop = 0;\n\n  // Bind events\n  container.querySelectorAll(\".dm-file-item\").forEach(item => {\n    (item as HTMLElement).onclick = () => selectFile(item as HTMLElement);\n    (item as HTMLElement).ondblclick = () => openFile(item as HTMLElement);\n  });\n\n  container.querySelectorAll(\".dm-grid-item\").forEach(item => {\n    (item as HTMLElement).onclick = () => selectGridItem(item as HTMLElement);\n    (item as HTMLElement).ondblclick = async () => {\n      const path = (item as HTMLElement).dataset.path;\n      const isDir = (item as HTMLElement).dataset.isDir === \"true\";\n      if (isDir && path) {\n        await loadDirectory(path);\n      } else if (path) {\n        const { previewFile } = await import('./preview-actions.js');\n        await previewFile(path);\n      }\n    };\n  });\n}\n\n/**\n * Select list item\n */\nfunction selectFile(item: HTMLElement): void {\n  document.querySelectorAll(\".dm-file-item\").forEach(i => {\n    (i as HTMLElement).style.background = \"transparent\";\n  });\n\n  item.style.background = \"#3a3a3a\";\n\n  const path = item.dataset.path || \"\";\n  const isDir = item.dataset.isDir === \"true\";\n\n  FileManagerState.selectedFiles = [path];\n\n  if (!isDir && path) {\n    void (async () => {\n      const { previewFile } = await import('./preview-actions.js');\n      await previewFile(path);\n    })();\n  } else {\n    clearPreviewPanel();\n  }\n}\n\n/**\n * Select grid item\n */\nfunction selectGridItem(item: HTMLElement): void {\n  document.querySelectorAll(\".dm-grid-item\").forEach(i => {\n    (i as HTMLElement).style.borderColor = \"transparent\";\n  });\n\n  item.style.borderColor = \"#9b59b6\";\n  FileManagerState.selectedFiles = [item.dataset.path || \"\"];\n\n  const path = item.dataset.path;\n  const isDir = item.dataset.isDir === \"true\";\n\n  if (!isDir && path) {\n    void (async () => {\n      const { previewFile } = await import('./preview-actions.js');\n      await previewFile(path);\n    })();\n  }\n}\n\n/**\n * Open file\n */\nfunction openFile(item: HTMLElement): void {\n  const path = item.dataset.path;\n  const isDir = item.dataset.isDir === \"true\";\n\n  if (isDir && path) {\n    void loadDirectory(path);\n  } else if (path) {\n    void (async () => {\n      const { previewFile } = await import('./preview-actions.js');\n      await previewFile(path);\n    })();\n  }\n}\n\n/**\n * Clear preview panel\n */\nfunction clearPreviewPanel(): void {\n  const previewContent = document.getElementById(\"dm-preview-content\");\n  if (previewContent) {\n    previewContent.innerHTML = `\n      <div style=\"text-align: center; padding: 40px; color: #666;\">\n        <i class=\"pi pi-folder\" style=\"font-size: 48px; opacity: 0.5;\"></i>\n        <div style=\"margin-top: 15px; font-size: 13px;\"></div>\n      </div>\n    `;\n  }\n}\n\n/**\n * Toggle sort order\n * @param column - Sort column\n */\nexport function toggleSort(column: SortBy): void {\n  if (FileManagerState.sortBy === column) {\n    FileManagerState.sortOrder = FileManagerState.sortOrder === 'asc' ? 'desc' : 'asc';\n  } else {\n    FileManagerState.sortBy = column;\n    FileManagerState.sortOrder = 'asc';\n  }\n\n  const sortSelect = document.getElementById(\"dm-sort-select\") as HTMLSelectElement;\n  if (sortSelect) {\n    sortSelect.value = FileManagerState.sortBy;\n  }\n\n  renderFileListUI();\n  updateHeaderSortIndicators();\n}\n\n/**\n * Update header sort indicators\n */\nexport function updateHeaderSortIndicators(): void {\n  const headers = document.querySelectorAll('.dm-header-cell');\n  headers.forEach(header => {\n    const icon = header.querySelector('i') as HTMLElement;\n    if (icon) {\n      const column = (header as HTMLElement).dataset.sort as SortBy;\n      if (column === FileManagerState.sortBy) {\n        icon.className = FileManagerState.sortOrder === 'asc' ? 'pi pi-sort-amount-up' : 'pi pi-sort-amount-down';\n        icon.style.opacity = \"1\";\n      } else {\n        icon.className = 'pi pi-sort';\n        icon.style.opacity = \"0.5\";\n      }\n    }\n  });\n}\n\n/**\n * Navigate to parent directory\n */\nexport function navigateUp(): void {\n  if (FileManagerState.currentPath === \".\" || FileManagerState.currentPath === \"/\") {\n    return;\n  }\n\n  const parentPath = getParentPath(FileManagerState.currentPath);\n  if (parentPath !== FileManagerState.currentPath) {\n    void loadDirectory(parentPath);\n  }\n}\n\n/**\n * Navigate to root directory\n */\nexport function navigateHome(): void {\n  void loadDirectory(\".\");\n}\n","/**\n * ComfyUI Data Manager - Syntax Highlighting Utilities\n */\n\n// Syntax highlight color theme (VS Code Dark style)\nconst CODE_COLORS = {\n  keyword: '#569cd6',      // Keywords (blue)\n  string: '#ce9178',       // Strings (orange)\n  number: '#b5cea8',       // Numbers (light green)\n  boolean: '#569cd6',      // Booleans (blue)\n  null: '#569cd6',         // null (blue)\n  comment: '#6a9955',      // Comments (green)\n  function: '#dcdcaa',     // Functions (yellow)\n  class: '#4ec9b0',        // Classes (cyan)\n  tag: '#569cd6',          // HTML tags\n  attrName: '#9cdcfe',     // Attribute names\n  attrValue: '#ce9178',    // Attribute values\n} as const;\n\n/**\n * Generic syntax highlight function\n * @param code - Source code\n * @param ext - File extension\n * @returns Highlighted HTML string\n */\nexport function highlightCode(code: string, ext: string): string {\n  // HTML escape\n  let result = code\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;');\n\n  // Select highlight rules based on extension\n  switch (ext) {\n    case '.json':\n      result = highlightJSON(result);\n      break;\n    case '.py':\n      result = highlightPython(result);\n      break;\n    case '.js':\n    case '.ts':\n    case '.jsx':\n    case '.tsx':\n      result = highlightJavaScript(result);\n      break;\n    case '.html':\n    case '.htm':\n      result = highlightHTML(result);\n      break;\n    case '.css':\n      result = highlightCSS(result);\n      break;\n    case '.yaml':\n    case '.yml':\n      result = highlightYAML(result);\n      break;\n    case '.xml':\n      result = highlightXML(result);\n      break;\n    default:\n      result = highlightGeneric(result);\n  }\n\n  return result;\n}\n\n/**\n * JSON syntax highlight\n * @param code - JSON code\n * @returns Highlighted HTML string\n */\nexport function highlightJSON(code: string): string {\n  return code.replace(/(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)/g, function (match) {\n    let color: string = CODE_COLORS.number;\n    if (/^\"/.test(match)) color = /:$/.test(match) ? CODE_COLORS.attrName : CODE_COLORS.string;\n    else if (/true|false|null/.test(match)) color = CODE_COLORS.boolean;\n    return `<span style=\"color: ${color};\">${match}</span>`;\n  });\n}\n\n/**\n * Python syntax highlight\n * @param code - Python code\n * @returns Highlighted HTML string\n */\nexport function highlightPython(code: string): string {\n  const keywords = /\\b(def|class|import|from|if|elif|else|while|for|in|try|except|finally|with|as|return|yield|raise|pass|break|continue|and|or|not|is|lambda|True|False|None|async|await)\\b/g;\n  const decorators = /@[\\w.]+/g;\n  const strings = /(\"\"\"[\\s\\S]*?\"\"\"|'''[\\s\\S]*?'''|\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g;\n  const comments = /#.*$/gm;\n  const numbers = /\\b(\\d+\\.?\\d*)\\b/g;\n  const functions = /\\b([a-zA-Z_]\\w*)\\s*(?=\\()/g;\n\n  // Order matters: comments -> strings -> keywords -> functions -> numbers\n  return code\n    .replace(comments, `<span style=\"color: ${CODE_COLORS.comment};\">$&</span>`)\n    .replace(strings, `<span style=\"color: ${CODE_COLORS.string};\">$&</span>`)\n    .replace(keywords, `<span style=\"color: ${CODE_COLORS.keyword};\">$&</span>`)\n    .replace(decorators, `<span style=\"color: ${CODE_COLORS.function};\">$&</span>`)\n    .replace(functions, `<span style=\"color: ${CODE_COLORS.function};\">$1</span>(`)\n    .replace(numbers, `<span style=\"color: ${CODE_COLORS.number};\">$1</span>`);\n}\n\n/**\n * JavaScript/TypeScript syntax highlight\n * @param code - JavaScript code\n * @returns Highlighted HTML string\n */\nexport function highlightJavaScript(code: string): string {\n  const keywords = /\\b(const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|new|this|class|extends|import|export|from|async|await|try|catch|finally|throw|null|undefined|true|false|in|instanceof|typeof|void)\\b/g;\n  const templateStrings = /`(?:[^`\\\\]|\\\\.)*`/g;\n  const strings = /(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g;\n  const comments = /(\\/\\/.*$|\\/\\*[\\s\\S]*?\\*\\/)/gm;\n  const numbers = /\\b(\\d+\\.?\\d*)\\b/g;\n  const functions = /\\b([a-zA-Z_]\\w*)\\s*(?=\\()/g;\n  const arrowFunc = /(&gt;|=>)/g;\n\n  return code\n    .replace(comments, `<span style=\"color: ${CODE_COLORS.comment};\">$&</span>`)\n    .replace(templateStrings, `<span style=\"color: ${CODE_COLORS.string};\">$&</span>`)\n    .replace(strings, `<span style=\"color: ${CODE_COLORS.string};\">$&</span>`)\n    .replace(keywords, `<span style=\"color: ${CODE_COLORS.keyword};\">$&</span>`)\n    .replace(functions, `<span style=\"color: ${CODE_COLORS.function};\">$1</span>(`)\n    .replace(arrowFunc, `<span style=\"color: ${CODE_COLORS.keyword};\">$&</span>`)\n    .replace(numbers, `<span style=\"color: ${CODE_COLORS.number};\">$1</span>`);\n}\n\n/**\n * HTML syntax highlight\n * @param code - HTML code\n * @returns Highlighted HTML string\n */\nexport function highlightHTML(code: string): string {\n  // HTML tags\n  code = code.replace(/(&lt;\\/?)([\\w-]+)/g, `$1<span style=\"color: ${CODE_COLORS.tag};\">$2</span>`);\n  // Attribute names\n  code = code.replace(/([\\w-]+)(=)/g, `<span style=\"color: ${CODE_COLORS.attrName};\">$1</span>$2`);\n  // Attribute values\n  code = code.replace(/(=)(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g, `$1<span style=\"color: ${CODE_COLORS.attrValue};\">$2</span>`);\n  return code;\n}\n\n/**\n * CSS syntax highlight\n * @param code - CSS code\n * @returns Highlighted HTML string\n */\nexport function highlightCSS(code: string): string {\n  // Comments\n  code = code.replace(/(\\/\\*[\\s\\S]*?\\*\\/)/g, `<span style=\"color: ${CODE_COLORS.comment};\">$1</span>`);\n  // Strings\n  code = code.replace(/(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g, `<span style=\"color: ${CODE_COLORS.string};\">$1</span>`);\n  // Properties\n  code = code.replace(/([\\w-]+)(\\s*:)/g, `<span style=\"color: ${CODE_COLORS.attrName};\">$1</span>$2`);\n  // Values with units\n  code = code.replace(/(:\\s*)([\\d.#\\w-]+)/g, `$1<span style=\"color: ${CODE_COLORS.attrValue};\">$2</span>`);\n  // Selectors (at start of line or after })\n  code = code.replace(/([.#]?[\\w-]+)(\\s*\\{)/g, `<span style=\"color: ${CODE_COLORS.tag};\">$1</span>$2`);\n  return code;\n}\n\n/**\n * YAML syntax highlight\n * @param code - YAML code\n * @returns Highlighted HTML string\n */\nexport function highlightYAML(code: string): string {\n  // Comments\n  code = code.replace(/(#.*$)/gm, `<span style=\"color: ${CODE_COLORS.comment};\">$1</span>`);\n  // Keys (before colon)\n  code = code.replace(/^([\\w-]+):/gm, `<span style=\"color: ${CODE_COLORS.attrName};\">$1</span>:`);\n  // Values (after colon)\n  code = code.replace(/(:\\s*)([\\w./-]+)/g, `$1<span style=\"color: ${CODE_COLORS.string};\">$2</span>`);\n  // Booleans and null\n  code = code.replace(/\\b(true|false|null)\\b/g, `<span style=\"color: ${CODE_COLORS.boolean};\">$1</span>`);\n  // Numbers\n  code = code.replace(/\\b(\\d+\\.?\\d*)\\b/g, `<span style=\"color: ${CODE_COLORS.number};\">$1</span>`);\n  return code;\n}\n\n/**\n * XML syntax highlight\n * @param code - XML code\n * @returns Highlighted HTML string\n */\nexport function highlightXML(code: string): string {\n  // Tags\n  code = code.replace(/(&lt;\\/?)([\\w:]+)/g, `$1<span style=\"color: ${CODE_COLORS.tag};\">$2</span>`);\n  // Attribute names\n  code = code.replace(/([\\w:]+)(=)/g, `<span style=\"color: ${CODE_COLORS.attrName};\">$1</span>$2`);\n  // Attribute values\n  code = code.replace(/(=)(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g, `$1<span style=\"color: ${CODE_COLORS.attrValue};\">$2</span>`);\n  return code;\n}\n\n/**\n * Generic syntax highlight (fallback)\n * @param code - Code\n * @returns Highlighted HTML string\n */\nexport function highlightGeneric(code: string): string {\n  // Strings\n  code = code.replace(/(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g, `<span style=\"color: ${CODE_COLORS.string};\">$1</span>`);\n  // Comments (// and /* */)\n  code = code.replace(/(\\/\\/.*$)/gm, `<span style=\"color: ${CODE_COLORS.comment};\">$1</span>`);\n  code = code.replace(/(\\/\\*[\\s\\S]*?\\*\\/)/g, `<span style=\"color: ${CODE_COLORS.comment};\">$1</span>`);\n  // Keywords\n  const keywords = /\\b(function|return|if|else|for|while|var|let|const|true|false|null|undefined)\\b/g;\n  code = code.replace(keywords, `<span style=\"color: ${CODE_COLORS.keyword};\">$1</span>`);\n  // Numbers\n  code = code.replace(/\\b(\\d+\\.?\\d*)\\b/g, `<span style=\"color: ${CODE_COLORS.number};\">$1</span>`);\n  return code;\n}\n","/**\n * ComfyUI Data Manager - CSV Parsing Utilities\n */\n\n/**\n * Parse CSV text into 2D array\n * @param text - CSV text\n * @returns Two-dimensional array\n */\nexport function parseCSV(text: string): string[][] {\n  const rows: string[][] = [];\n  let currentRow: string[] = [];\n  let currentCell = '';\n  let inQuotes = false;\n\n  for (let i = 0; i < text.length; i++) {\n    const char = text[i];\n    const nextChar = text[i + 1];\n\n    if (inQuotes) {\n      if (char === '\"') {\n        if (nextChar === '\"') {\n          currentCell += '\"';\n          i++;\n        } else {\n          inQuotes = false;\n        }\n      } else {\n        currentCell += char;\n      }\n    } else {\n      if (char === '\"') {\n        inQuotes = true;\n      } else if (char === ',') {\n        currentRow.push(currentCell);\n        currentCell = '';\n      } else if (char === '\\r' && nextChar === '\\n') {\n        currentRow.push(currentCell);\n        rows.push(currentRow);\n        currentRow = [];\n        currentCell = '';\n        i++;\n      } else if (char === '\\n') {\n        currentRow.push(currentCell);\n        rows.push(currentRow);\n        currentRow = [];\n        currentCell = '';\n      } else if (char !== '\\r') {\n        currentCell += char;\n      }\n    }\n  }\n\n  // Add last cell and row\n  currentRow.push(currentCell);\n  if (currentRow.length > 0 || rows.length > 0) {\n    rows.push(currentRow);\n  }\n\n  return rows;\n}\n","/**\n * ComfyUI Data Manager - Table Preview Utilities\n *\n * Provides CSV/Excel table preview functionality\n */\n\nimport { escapeHtml } from './format.js';\nimport { loadScript } from './script.js';\nimport { parseCSV } from './csv.js';\nimport { LIMITS } from '../core/constants.js';\n\n/**\n * Table mode type\n */\nexport type TableModeType = 'floating' | 'panel';\n\n/**\n * Table options\n */\nexport interface TableOptions {\n  type?: TableModeType;\n  maxRows?: number;\n  height?: number | null;\n}\n\n/**\n * Default configuration\n */\nconst DEFAULT_OPTIONS: TableOptions = {\n  type: 'floating',\n  maxRows: LIMITS.MAX_PREVIEW_ROWS,\n  height: null\n};\n\n/**\n * Table mode configuration\n */\ntype TableModeConfig = {\n  containerClass: string;\n  controlsClass: string;\n  height: string | null;\n  hasFullscreen: boolean;\n  prefix: string;\n};\n\nconst MODE_CONFIG: Record<'floating' | 'panel', TableModeConfig> = {\n  floating: {\n    containerClass: 'dm-table-container',\n    controlsClass: 'dm-table-controls',\n    height: null,\n    hasFullscreen: false,\n    prefix: 'dm-floating-table'\n  },\n  panel: {\n    containerClass: 'dm-panel-table-container',\n    controlsClass: 'dm-table-controls-panel',\n    height: '400px',\n    hasFullscreen: true,\n    prefix: 'dm-table'\n  }\n};\n\n/**\n * Create table HTML\n * @param rows - Two-dimensional array data\n * @param options - Configuration options\n * @returns HTML string\n */\nexport function createTableHTML(rows: string[][], options: TableOptions = {}): string {\n  const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n  const mode = MODE_CONFIG[mergedOptions.type || 'floating'];\n  const displayRows = rows.slice(0, mergedOptions.maxRows || LIMITS.MAX_PREVIEW_ROWS);\n  const isTruncated = rows.length > (mergedOptions.maxRows || LIMITS.MAX_PREVIEW_ROWS);\n  const tableId = `${mode.prefix}-${Date.now()}`;\n\n  const heightStyle = mode.height !== null ? `height: ${mode.height};` : 'height: 100%;';\n  const containerStyle = `position: relative; flex: 1; overflow: hidden; ${heightStyle}`;\n\n  let tableHTML = `\n    <div style=\"display: flex; flex-direction: column; gap: 0; ${mergedOptions.type === 'floating' ? 'height: 100%;' : ''}\">\n      <div class=\"${mode.containerClass}\" style=\"${containerStyle}\">\n        <div id=\"${tableId}-wrapper\" class=\"dm-table-wrapper\"\n             style=\"width: 100%; overflow: auto; padding: 15px; ${heightStyle}\">\n          <table id=\"${tableId}\" class=\"dm-data-table\"\n                 style=\"width: 100%; border-collapse: collapse; font-size: 12px; transform-origin: top left;\">\n  `;\n\n  displayRows.forEach((row, rowIndex) => {\n    const isHeader = rowIndex === 0;\n    tableHTML += '<tr>';\n\n    row.forEach(cell => {\n      const cellContent = escapeHtml(String(cell ?? ''));\n      if (isHeader) {\n        tableHTML += `<th class=\"dm-table-header\">${cellContent}</th>`;\n      } else {\n        tableHTML += `<td class=\"dm-table-cell\">${cellContent}</td>`;\n      }\n    });\n\n    tableHTML += '</tr>';\n  });\n\n  tableHTML += `\n          </table>\n        </div>\n      </div>\n      ${createTableControls(tableId, mode)}\n    </div>\n  `;\n\n  if (isTruncated) {\n    const maxRows = mergedOptions.maxRows || LIMITS.MAX_PREVIEW_ROWS;\n    tableHTML = tableHTML.replace(\n      '</div>',\n      `<div class=\"dm-table-truncated\" style=\"text-align: center; padding: 10px; font-size: 11px;\">... ( ${maxRows}  ${rows.length} )</div></div>`\n    );\n  }\n\n  // Delay setting up controls\n  setTimeout(() => setupTableControls(tableId, (mergedOptions.type || 'floating') as 'floating' | 'panel'), 0);\n\n  return tableHTML;\n}\n\n/**\n * Create table controls HTML\n * @param tableId - Table ID\n * @param mode - Mode configuration\n * @returns Controls HTML string\n */\nfunction createTableControls(tableId: string, mode: typeof MODE_CONFIG.floating): string {\n  let controlsHTML = `\n    <div id=\"${tableId}-controls\" class=\"${mode.controlsClass}\" style=\"display: flex; align-items: center; justify-content: center; gap: 8px; padding: 10px; flex-shrink: 0;\">\n      <button class=\"comfy-btn dm-table-zoom-out-btn\" data-table-id=\"${tableId}\" title=\"\">\n        <i class=\"pi pi-search-minus\"></i>\n      </button>\n      <span id=\"${tableId}-zoom\" class=\"dm-table-zoom-display\">100%</span>\n      <button class=\"comfy-btn dm-table-zoom-in-btn\" data-table-id=\"${tableId}\" title=\"\">\n        <i class=\"pi pi-search-plus\"></i>\n      </button>\n      <button class=\"comfy-btn dm-table-fit-btn\" data-table-id=\"${tableId}\" title=\"\">\n        <i class=\"pi pi-arrows-alt\"></i>\n      </button>\n  `;\n\n  if (mode.hasFullscreen) {\n    controlsHTML += `\n      <button class=\"comfy-btn dm-table-fullscreen-btn\" data-table-id=\"${tableId}\" title=\"\">\n        <i class=\"pi pi-window-maximize\"></i>\n      </button>\n    `;\n  }\n\n  controlsHTML += '</div>';\n  return controlsHTML;\n}\n\n/**\n * Setup table control events\n * @param tableId - Table ID\n * @param modeType - Mode type ('floating' | 'panel')\n */\nexport function setupTableControls(tableId: string, modeType: TableModeType = 'floating'): void {\n  const table = document.getElementById(tableId);\n  if (!table) return;\n\n  const mode = MODE_CONFIG[modeType] || MODE_CONFIG.floating;\n  let zoom = 100;\n  let isFullscreen = false;\n  const tableEl = table as HTMLElement;\n\n  const wrapper = document.getElementById(`${tableId}-wrapper`);\n  const zoomDisplay = document.getElementById(`${tableId}-zoom`);\n  const zoomInBtn = document.querySelector(`.dm-table-zoom-in-btn[data-table-id=\"${tableId}\"]`) as HTMLButtonElement;\n  const zoomOutBtn = document.querySelector(`.dm-table-zoom-out-btn[data-table-id=\"${tableId}\"]`) as HTMLButtonElement;\n  const fitBtn = document.querySelector(`.dm-table-fit-btn[data-table-id=\"${tableId}\"]`) as HTMLButtonElement;\n  const fullscreenBtn = mode.hasFullscreen\n    ? document.querySelector(`.dm-table-fullscreen-btn[data-table-id=\"${tableId}\"]`) as HTMLButtonElement | null\n    : null;\n\n  function updateZoom(): void {\n    tableEl.style.transform = `scale(${zoom / 100})`;\n    if (zoomDisplay) zoomDisplay.textContent = `${zoom}%`;\n    if (wrapper) {\n      wrapper.style.width = zoom > 100 ? `${zoom}%` : '100%';\n    }\n  }\n\n  if (zoomInBtn) {\n    zoomInBtn.addEventListener('click', () => {\n      zoom = Math.min(zoom + LIMITS.DEFAULT_ZOOM_STEP, LIMITS.MAX_ZOOM_DISPLAY);\n      updateZoom();\n    });\n  }\n\n  if (zoomOutBtn) {\n    zoomOutBtn.addEventListener('click', () => {\n      zoom = Math.max(zoom - LIMITS.DEFAULT_ZOOM_STEP, LIMITS.MIN_ZOOM_DISPLAY);\n      updateZoom();\n    });\n  }\n\n  if (fitBtn) {\n    fitBtn.addEventListener('click', () => {\n      const containerWidth = wrapper?.clientWidth || 400;\n      const tableWidth = tableEl.scrollWidth;\n      const newZoom = Math.min(Math.floor((containerWidth / tableWidth) * 100), 100);\n      zoom = Math.max(newZoom, LIMITS.MIN_ZOOM_DISPLAY);\n      updateZoom();\n    });\n  }\n\n  if (fullscreenBtn) {\n    fullscreenBtn.addEventListener('click', () => {\n      isFullscreen = !isFullscreen;\n      if (isFullscreen) {\n        table.parentElement?.requestFullscreen();\n      } else {\n        document.exitFullscreen();\n      }\n    });\n  }\n}\n\n/**\n * Create empty table HTML\n * @param message - Empty message\n * @returns HTML string\n */\nexport function createEmptyTableHTML(message = \"\"): string {\n  return `\n    <div style=\"text-align: center; padding: 40px; color: #666;\">\n      <i class=\"pi pi-table\" style=\"font-size: 48px; opacity: 0.5;\"></i>\n      <div style=\"margin-top: 15px; font-size: 13px;\">${escapeHtml(message)}</div>\n    </div>\n  `;\n}\n\n/**\n * Create unsupported table HTML\n * @param format - Format name\n * @returns HTML string\n */\nexport function createUnsupportedTableHTML(format: string): string {\n  return `\n    <div style=\"text-align: center; padding: 40px; color: #666;\">\n      <i class=\"pi pi-file-excel\" style=\"font-size: 48px; opacity: 0.5;\"></i>\n      <div style=\"margin-top: 15px; font-size: 13px;\">${escapeHtml(format)} </div>\n    </div>\n  `;\n}\n\n/**\n * Create table error HTML\n * @param error - Error message\n * @returns HTML string\n */\nexport function createTableErrorHTML(error: string): string {\n  return `\n    <div style=\"text-align: center; padding: 40px; color: #e74c3c;\">\n      <i class=\"pi pi-exclamation-triangle\" style=\"font-size: 48px;\"></i>\n      <div style=\"margin-top: 15px; font-size: 13px;\"></div>\n      <div style=\"margin-top: 5px; font-size: 11px;\">${escapeHtml(error)}</div>\n    </div>\n  `;\n}\n\n/**\n * Parse spreadsheet file (CSV or Excel)\n * @param path - File path\n * @param ext - File extension\n * @returns Promise resolving to 2D array\n */\nexport async function parseSpreadsheet(path: string, ext: string): Promise<string[][]> {\n  const response = await fetch(`/dm/preview?path=${encodeURIComponent(path)}`);\n\n  if (!response.ok) {\n    throw new Error('Failed to load file');\n  }\n\n  if (ext === '.csv') {\n    const text = await response.text();\n    return parseCSV(text);\n  }\n\n  // For Excel files, we would need SheetJS (xlsx) library\n  // For now, return unsupported error\n  throw new Error('Excel format requires SheetJS library');\n}\n","/**\n * ComfyUI Data Manager - Script Loading Utilities\n */\n\n/**\n * Dynamically load external script\n * @param src - Script URL\n * @returns Promise that resolves when script is loaded\n */\nexport function loadScript(src: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    // If already loaded, resolve immediately\n    if (document.querySelector(`script[src=\"${src}\"]`)) {\n      resolve();\n      return;\n    }\n    const script = document.createElement('script');\n    script.src = src;\n    script.onload = () => resolve();\n    script.onerror = reject;\n    document.head.appendChild(script);\n  });\n}\n","/**\n * ComfyUI Data Manager - Floating Window Preview Content Loading\n */\n\nimport { FILE_TYPES, LIMITS } from '../../core/constants.js';\nimport { getFileType } from '../../utils/file-type.js';\nimport { escapeHtml } from '../../utils/format.js';\nimport { highlightCode } from '../../utils/syntax-highlight.js';\nimport { createTableHTML, setupTableControls, createEmptyTableHTML, createUnsupportedTableHTML, createTableErrorHTML, parseSpreadsheet } from '../../utils/table.js';\nimport { loadScript } from '../../utils/script.js';\n\n/**\n * Load preview content into container\n * @param content - Content container element\n * @param path - File path\n * @param ext - File extension\n * @param scale - Initial scale (for images only)\n */\nexport async function loadPreviewContent(content: HTMLElement, path: string, ext: string, scale: number = 1): Promise<void> {\n  content.innerHTML = `\n    <div class=\"dm-loading\" style=\"text-align: center; padding: 20px;\">\n      <i class=\"pi pi-spin pi-spinner\" style=\"font-size: 24px;\"></i>\n      <div style=\"margin-top: 10px;\">...</div>\n    </div>\n  `;\n\n  try {\n    let previewHTML = \"\";\n\n    // Image preview\n    if (FILE_TYPES.image.exts.includes(ext)) {\n      const imageUrl = `/dm/preview?path=${encodeURIComponent(path)}`;\n      previewHTML = `\n        <img src=\"${imageUrl}\"\n             class=\"dm-zoomable-image dm-preview-image\"\n             style=\"max-width: 100%; max-height: 400px;\n                    border-radius: 8px; border: 1px solid;\n                    transform-origin: center center;\n                    will-change: transform;\"\n             onerror=\"this.parentElement.innerHTML='<div class=\\\\'dm-error-message\\\\' style=\\\\'padding: 20px;\\\\'></div>'\"\n             onload=\"this.style.opacity=1; this.style.display='block';\">\n      `;\n    }\n    // Audio preview\n    else if (FILE_TYPES.audio.exts.includes(ext)) {\n      const audioUrl = `/dm/preview?path=${encodeURIComponent(path)}`;\n      const audioId = `dm-preview-audio-${Date.now()}`;\n      const displayName = escapeHtml(path.split(/[/\\\\]/).pop() || \"\");\n      previewHTML = `\n        <div class=\"dm-audio-preview\" style=\"width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;\">\n          <i class=\"pi pi-volume-up dm-audio-icon\" style=\"font-size: 64px; margin-bottom: 15px;\"></i>\n          <div class=\"dm-preview-filename\" style=\"margin-bottom: 15px; font-size: 14px;\">${displayName}</div>\n          <audio id=\"${audioId}\" preload=\"metadata\" style=\"width: 100%; max-width: 400px;\">\n            <source src=\"${audioUrl}\">\n            \n          </audio>\n        </div>\n      `;\n    }\n    // Video preview (browser supported)\n    else if (FILE_TYPES.video.exts.includes(ext)) {\n      const videoUrl = `/dm/preview?path=${encodeURIComponent(path)}`;\n      const videoId = `dm-preview-video-${Date.now()}`;\n      previewHTML = `\n        <div class=\"dm-video-preview\" style=\"width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;\">\n          <video id=\"${videoId}\"\n                 preload=\"metadata\"\n                 style=\"width: 100%; height: 100%; max-height: 100%; object-fit: contain; border-radius: 8px;\">\n            <source src=\"${videoUrl}\">\n            \n          </video>\n        </div>\n      `;\n    }\n    // External video format preview (requires external player)\n    else if (FILE_TYPES.videoExternal && FILE_TYPES.videoExternal.exts.includes(ext)) {\n      const extUpper = ext.toUpperCase().replace('.', '');\n      const displayName = escapeHtml(path.split(/[\\\\/]/).pop() || \"\");\n      previewHTML = `\n        <div class=\"dm-external-video\" style=\"text-align: center; padding: 40px;\">\n          <i class=\"pi pi-video dm-external-video-icon\" style=\"font-size: 64px; margin-bottom: 15px;\"></i>\n          <div class=\"dm-preview-filename\" style=\"font-size: 16px; margin-bottom: 8px;\">${displayName}</div>\n          <div class=\"dm-external-video-type\" style=\"font-size: 14px; font-weight: 600; margin-bottom: 15px;\">${extUpper} </div>\n          <div class=\"dm-external-video-desc\" style=\"margin-top: 10px; font-size: 12px; max-width: 300px; margin-left: auto; margin-right: auto;\">\n            <br>\n            <span class=\"dm-external-video-sub\">VLCWindows Media Player </span>\n          </div>\n          <div class=\"dm-external-video-tip\" style=\"margin-top: 15px; padding: 10px; border-radius: 6px; font-size: 11px;\">\n            \"\"\n          </div>\n        </div>\n      `;\n    }\n    // Code preview\n    else if (FILE_TYPES.code.exts.includes(ext)) {\n      const response = await fetch(`/dm/preview?path=${encodeURIComponent(path)}`);\n      if (response.ok) {\n        const text = await response.text();\n        const highlighted = highlightCode(text, ext);\n        previewHTML = `\n          <div class=\"dm-code-preview\" style=\"width: 100%; padding: 15px;\n                      font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; line-height: 1.5;\n                      overflow-x: auto; max-height: 400px; overflow-y: auto; border-radius: 0;\">\n            <pre class=\"dm-code-content\" style=\"margin: 0; white-space: pre-wrap;\">${highlighted}</pre>\n          </div>\n        `;\n      } else {\n        throw new Error('Failed to load file');\n      }\n    }\n    // Document preview\n    else if (FILE_TYPES.document.exts.includes(ext)) {\n      const docUrl = `/dm/preview?path=${encodeURIComponent(path)}`;\n      const isPDF = ext === '.pdf';\n      const isMarkdown = ext === '.md';\n      const isDocx = ext === '.docx';\n      const isDoc = ext === '.doc';\n\n      if (isDoc) {\n        // Old Word documents cannot be previewed\n        const displayName = escapeHtml(path.split(/[/\\\\]/).pop() || \"\");\n        previewHTML = `\n          <div class=\"dm-doc-unsupported\" style=\"text-align: center; padding: 40px;\">\n            <i class=\"pi pi-file-word dm-doc-unsupported-icon\" style=\"font-size: 64px; margin-bottom: 15px;\"></i>\n            <div class=\"dm-preview-filename\" style=\"margin-top: 15px; font-size: 14px;\">${displayName}</div>\n            <div class=\"dm-unsupported-message\" style=\"margin-top: 10px; font-size: 12px;\">.doc </div>\n            <div class=\"dm-unsupported-sub\" style=\"margin-top: 5px; font-size: 11px;\"> .docx \"\"</div>\n          </div>\n        `;\n      } else if (isDocx) {\n        // .docx files use mammoth.js to convert to HTML\n        try {\n          const response = await fetch(docUrl);\n          if (response.ok) {\n            const arrayBuffer = await response.arrayBuffer();\n\n            // Check if mammoth.js is loaded\n            if (typeof (window as unknown as { mammoth?: unknown }).mammoth === 'undefined') {\n              // Dynamically load mammoth.js\n              await loadScript('https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js');\n            }\n\n            const mammoth = (window as unknown as { mammoth: { convertToHtml: (options: { arrayBuffer: ArrayBuffer }) => { value: string } } }).mammoth;\n            if (typeof mammoth !== 'undefined') {\n              const result = mammoth.convertToHtml({ arrayBuffer: arrayBuffer });\n              const contentId = `dm-doc-content-${Date.now()}`;\n              previewHTML = `\n                <div id=\"${contentId}\" class=\"dm-document-content dm-docx-content\"\n                     style=\"width: 100%; height: 100%;\n                            font-family: 'Segoe UI', Arial, sans-serif;\n                            font-size: 13px;\n                            line-height: 1.6;\n                            overflow: auto;\n                            box-sizing: border-box;\n                            padding: 20px;\">\n                  <style>\n                    #${contentId} img { max-width: 100%; height: auto; display: inline-block; margin: 10px 0; }\n                    #${contentId} p { word-wrap: break-word; overflow-wrap: break-word; margin: 0.5em 0; }\n                    #${contentId} table { max-width: 100%; overflow: auto; display: block; margin: 10px 0; }\n                  </style>\n                  ${result.value}\n                </div>\n              `;\n            } else {\n              throw new Error('mammoth.js not available');\n            }\n          } else {\n            throw new Error('Failed to load file');\n          }\n        } catch (error) {\n          console.error('[DataManager] DOCX preview error:', error);\n          const displayName = escapeHtml(path.split(/[/\\\\]/).pop() || \"\");\n          previewHTML = `\n            <div class=\"dm-preview-error\" style=\"text-align: center; padding: 40px;\">\n              <i class=\"pi pi-exclamation-triangle dm-error-icon\" style=\"font-size: 48px;\"></i>\n              <div class=\"dm-preview-filename\" style=\"margin-top: 15px;\">${displayName}</div>\n              <div class=\"dm-error-title\" style=\"margin-top: 10px; font-size: 12px;\"></div>\n              <div class=\"dm-error-detail\" style=\"margin-top: 5px; font-size: 11px;\">${escapeHtml((error as Error).message)}</div>\n            </div>\n          `;\n        }\n      } else if (isPDF) {\n        previewHTML = `\n          <div style=\"width: 100%; height: 100%; overflow: hidden;\">\n            <embed id=\"dm-floating-pdf-embed\" src=\"${docUrl}\" type=\"application/pdf\"\n                   style=\"width: 100%; height: 100%; border: none; display: block;\" />\n          </div>\n        `;\n      } else if (isMarkdown) {\n        // Markdown preview\n        const response = await fetch(docUrl);\n        const text = await response.text();\n        previewHTML = `\n          <div class=\"dm-markdown-preview\" style=\"padding: 20px; font-size: 13px; line-height: 1.6; overflow-y: auto; max-height: 100%;\">\n            <pre style=\"white-space: pre-wrap; word-wrap: break-word;\">${escapeHtml(text)}</pre>\n          </div>\n        `;\n      } else {\n        // Other documents\n        const displayName = escapeHtml(path.split(/[/\\\\]/).pop() || \"\");\n        previewHTML = `\n          <div style=\"text-align: center; padding: 40px;\">\n            <i class=\"pi pi-file\" style=\"font-size: 64px; color: #888;\"></i>\n            <div style=\"margin-top: 15px; font-size: 14px;\">${displayName}</div>\n            <div style=\"margin-top: 8px; font-size: 12px; color: #888;\">\"\"</div>\n          </div>\n        `;\n      }\n    }\n    // Spreadsheet preview\n    else if (FILE_TYPES.spreadsheet.exts.includes(ext)) {\n      try {\n        const rows = await parseSpreadsheet(path, ext);\n        previewHTML = createTableHTML(rows, { type: 'floating' });\n      } catch (error) {\n        previewHTML = createTableErrorHTML((error as Error).message);\n      }\n    }\n    // Other files\n    else {\n      const fileName = path.split(/[/\\\\]/).pop() || \"\";\n      const fileType = getFileType({ name: path });\n      const icon = FILE_TYPES[fileType]?.icon || FILE_TYPES.unknown.icon;\n      const color = FILE_TYPES[fileType]?.color || FILE_TYPES.unknown.color;\n      previewHTML = `\n        <div style=\"text-align: center; padding: 30px;\">\n          <i class=\"pi ${icon}\" style=\"font-size: 64px; color: ${color};\"></i>\n          <div style=\"margin-top: 15px; color: #fff; font-size: 14px;\">${escapeHtml(fileName)}</div>\n          <div style=\"margin-top: 8px; color: #888; font-size: 12px;\"></div>\n        </div>\n      `;\n    }\n\n    content.innerHTML = previewHTML;\n\n  } catch (error) {\n    content.innerHTML = `\n      <div class=\"dm-preview-error\" style=\"text-align: center; padding: 40px;\">\n        <i class=\"pi pi-exclamation-triangle dm-error-icon\" style=\"font-size: 48px;\"></i>\n        <div class=\"dm-error-title\" style=\"margin-top: 15px; font-size: 14px;\"></div>\n        <div class=\"dm-error-detail\" style=\"margin-top: 5px; font-size: 11px;\">${escapeHtml((error as Error).message)}</div>\n      </div>\n    `;\n  }\n}\n","/**\n * ComfyUI Data Manager - Floating Dock Management\n */\n\nimport { updateStatus } from '../../utils/helpers.js';\nimport { previewFloatingWindows } from '../../core/state.js';\n\n/**\n * Floating window data interface\n */\nexport interface FloatingWindowData {\n  path: string;\n  fileName: string;\n  fileConfig: { icon: string; color: string };\n  window: HTMLElement;\n  minimized: boolean;\n}\n\n/**\n * Update Dock panel\n */\nexport function updateDock(): void {\n  const dock = document.getElementById(\"dm-preview-dock\");\n  if (!dock) return;\n\n  // Clear Dock\n  dock.innerHTML = \"\";\n\n  // Get minimized windows\n  const minimizedWindows = (previewFloatingWindows as FloatingWindowData[]).filter(w => w.minimized);\n  if (minimizedWindows.length === 0) {\n    (dock as HTMLElement).style.minHeight = \"0\";\n    (dock as HTMLElement).style.maxHeight = \"0\";\n    (dock as HTMLElement).style.padding = \"0 15px\";\n    return;\n  }\n\n  // Show Dock\n  (dock as HTMLElement).style.minHeight = \"60px\";\n  (dock as HTMLElement).style.maxHeight = \"60px\";\n  (dock as HTMLElement).style.padding = \"10px 15px\";\n\n  // Add thumbnail for each minimized window\n  minimizedWindows.forEach(w => {\n    const thumbnail = document.createElement(\"div\");\n    thumbnail.className = \"dm-dock-thumbnail\";\n    thumbnail.style.cssText = `\n      width: 80px;\n      height: 50px;\n      background: #2a2a2a;\n      border: 1px solid #3a3a3a;\n      border-radius: 6px;\n      cursor: pointer;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      gap: 4px;\n      transition: all 0.2s;\n    `;\n    thumbnail.title = `${w.fileName} - `;\n    thumbnail.innerHTML = `\n      <i class=\"pi ${w.fileConfig.icon}\" style=\"color: ${w.fileConfig.color}; font-size: 16px;\"></i>\n      <span style=\"color: #aaa; font-size: 9px; max-width: 70px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${w.fileName}</span>\n    `;\n    thumbnail.onmouseover = () => {\n      (thumbnail as HTMLElement).style.background = \"#3a3a3a\";\n      (thumbnail as HTMLElement).style.borderColor = w.fileConfig.color;\n    };\n    thumbnail.onmouseout = () => {\n      (thumbnail as HTMLElement).style.background = \"#2a2a2a\";\n      (thumbnail as HTMLElement).style.borderColor = \"#3a3a3a\";\n    };\n    thumbnail.onclick = () => restoreFloatingPreview(w.window);\n\n    dock.appendChild(thumbnail);\n  });\n}\n\n/**\n * Restore minimized floating preview window\n * @param window - Floating window element\n */\nexport function restoreFloatingPreview(window: HTMLElement): void {\n  // Window restore logic is implemented in window.ts\n  // This is a placeholder for the actual restore functionality\n  (window as unknown as { minimized?: boolean }).minimized = false;\n  (window as HTMLElement).style.display = \"flex\";\n  updateDock();\n}\n","/**\n * ComfyUI Data Manager - Floating Preview Window\n */\n\nimport { FILE_TYPES, LIMITS } from '../../core/constants.js';\nimport { getFileType } from '../../utils/file-type.js';\nimport { setupWindowDrag } from '../../utils/drag.js';\nimport { updateStatus, getExt } from '../../utils/helpers.js';\nimport { loadPreviewContent } from './preview-content.js';\nimport { updateDock } from './dock.js';\nimport { previewFloatingWindows } from '../../core/state.js';\nimport { applyComfyTheme, getComfyTheme, addThemeListener, type ComfyTheme } from '../../utils/theme.js';\nimport type { FloatingWindowData } from './dock.js';\n\n// ==================== Local Constants ====================\nconst DEFAULT_IMAGE_SCALE = 1;\n\n/**\n * Create floating preview window toolbar button\n */\nfunction createToolbarButton(\n  icon: string,\n  title: string,\n  onClick: () => void\n): HTMLButtonElement {\n  const button = document.createElement(\"button\");\n  button.className = \"comfy-btn\";\n  button.innerHTML = `<i class=\"pi ${icon}\"></i>`;\n  button.style.cssText = \"padding: 6px 10px; background: transparent; border: none; color: #888; cursor: pointer; border-radius: 4px;\";\n  button.title = title;\n  button.onmouseover = () => button.style.background = \"#3a3a3a\";\n  button.onmouseout = () => button.style.background = \"transparent\";\n  button.onclick = onClick;\n  return button;\n}\n\n/**\n * Open floating preview window\n * @param path - File path\n * @param fileName - File name\n */\nexport function openFloatingPreview(path: string, fileName: string): void {\n  // Check if preview window already opened for this file\n  const existingWindow = (previewFloatingWindows as FloatingWindowData[]).find(w => w.path === path);\n  if (existingWindow) {\n    existingWindow.window.focus();\n    return;\n  }\n\n  const ext = getExt(path);\n  const fileType = getFileType({ name: path });\n  const fileConfig = FILE_TYPES[fileType] || FILE_TYPES.unknown;\n  const isImage = FILE_TYPES.image.exts.includes(ext);\n  const isVideo = FILE_TYPES.video.exts.includes(ext);\n  const isAudio = FILE_TYPES.audio.exts.includes(ext);\n  const isPDF = ext === '.pdf';\n  const isMarkdown = ext === '.md';\n  const isDocument = isPDF || isMarkdown || FILE_TYPES.document.exts.includes(ext);\n  const isCode = FILE_TYPES.code.exts.includes(ext);\n  const isSpreadsheet = FILE_TYPES.spreadsheet.exts.includes(ext);\n\n  // Create floating preview window\n  const previewWindow = document.createElement(\"div\");\n  previewWindow.id = `dm-preview-${Date.now()}`;\n  previewWindow.className = \"dm-floating-preview\";\n  previewWindow.style.cssText = `\n    position: fixed;\n    top: 100px;\n    right: 50px;\n    width: 500px;\n    height: 600px;\n    background: #1a1a1a;\n    border: 1px solid #3a3a3a;\n    border-radius: 12px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n    z-index: ${LIMITS.FLOATING_Z_INDEX};\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n  `;\n\n  // Create title bar\n  const header = createPreviewHeader(fileName, fileConfig, isImage, isVideo, isAudio, isDocument, isCode, isSpreadsheet, previewWindow, path);\n  previewWindow.appendChild(header);\n\n  // Create content area\n  const content = document.createElement(\"div\");\n  content.id = `dm-preview-content-${Date.now()}`;\n  content.style.cssText = `\n    flex: 1;\n    overflow: auto;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  `;\n  previewWindow.appendChild(content);\n\n  // Create toolbar\n  const toolbar = createPreviewToolbar(path, ext, isImage, isVideo, isAudio, isPDF, isMarkdown, isCode, isSpreadsheet, content, previewWindow);\n  previewWindow.appendChild(toolbar);\n\n  document.body.appendChild(previewWindow);\n\n  // Apply ComfyUI theme\n  applyComfyTheme();\n\n  // Setup drag\n  setupWindowDrag(previewWindow, header);\n\n  // Store window reference\n  const windowData: FloatingWindowData = {\n    path: path,\n    fileName: fileName,\n    fileConfig: fileConfig,\n    window: previewWindow,\n    minimized: false\n  };\n  (previewFloatingWindows as FloatingWindowData[]).push(windowData);\n\n  // Load content\n  loadPreviewContent(content, path, ext, DEFAULT_IMAGE_SCALE);\n\n  updateStatus(`: ${fileName}`);\n}\n\n/**\n * Create preview window title bar\n */\nfunction createPreviewHeader(\n  fileName: string,\n  fileConfig: { icon: string; color: string },\n  isImage: boolean,\n  isVideo: boolean,\n  isAudio: boolean,\n  isDocument: boolean,\n  isCode: boolean,\n  isSpreadsheet: boolean,\n  previewWindow: HTMLElement,\n  path: string\n): HTMLElement {\n  const theme = getComfyTheme();\n  const textColor = theme.isLight ? '#222' : '#fff';\n\n  const header = document.createElement(\"div\");\n  header.className = \"dm-preview-header\";\n  header.style.cssText = `\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 15px;\n    background: linear-gradient(135deg, ${theme.bgSecondary} 0%, ${theme.bgPrimary} 100%);\n    border-bottom: 1px solid ${theme.borderColor};\n    cursor: move;\n    user-select: none;\n  `;\n\n  // macOS traffic lights\n  const trafficLights = document.createElement(\"div\");\n  trafficLights.className = \"dm-traffic-lights\";\n  trafficLights.style.cssText = \"display: flex; gap: 8px;\";\n\n  // Close button\n  const closeBtn = createTrafficLightButton(\"pi-times\", textColor, \"\", () => closeFloatingPreview(previewWindow));\n  trafficLights.appendChild(closeBtn);\n\n  // Minimize button\n  const minimizeBtn = createTrafficLightButton(\"pi-minus\", textColor, \"\", () => minimizeFloatingPreview(previewWindow, path, fileName, fileConfig));\n  trafficLights.appendChild(minimizeBtn);\n\n  // Fullscreen button - for image, video, audio, document, code, spreadsheet files\n  if (isImage || isVideo || isAudio || isDocument || isCode || isSpreadsheet) {\n    const fullscreenBtn = createTrafficLightButton(\"pi-window-maximize\", textColor, \"\", () => toggleFullscreen(previewWindow));\n    trafficLights.appendChild(fullscreenBtn);\n  }\n\n  header.appendChild(trafficLights);\n\n  // Title area\n  const title = document.createElement(\"div\");\n  title.className = \"dm-header-title-area\";\n  title.style.cssText = \"display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; flex: 1; justify-content: center;\";\n  title.innerHTML = `\n    <i class=\"pi ${fileConfig.icon}\" style=\"color: ${fileConfig.color};\"></i>\n    <span style=\"max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${fileName}</span>\n  `;\n\n  header.appendChild(title);\n\n  // Register theme change listener\n  addThemeListener((newTheme: ComfyTheme) => {\n    const newTextColor = newTheme.isLight ? '#222' : '#fff';\n    header.style.background = `linear-gradient(135deg, ${newTheme.bgSecondary} 0%, ${newTheme.bgPrimary} 100%)`;\n    header.style.borderColor = newTheme.borderColor;\n    title.style.color = newTextColor;\n\n    // Update button colors\n    const btns = header.querySelectorAll('.dm-traffic-btn');\n    btns.forEach(btn => { (btn as HTMLElement).style.color = newTextColor; });\n  });\n\n  return header;\n}\n\n/**\n * Create traffic light button (macOS style)\n */\nfunction createTrafficLightButton(\n  icon: string,\n  textColor: string,\n  title: string,\n  onClick: () => void\n): HTMLElement {\n  const button = document.createElement(\"button\");\n  button.className = \"comfy-btn dm-traffic-btn\";\n  button.innerHTML = `<i class=\"pi ${icon}\" style=\"font-size: 10px; color: ${textColor};\"></i>`;\n  button.style.cssText = `\n    width: 14px;\n    height: 14px;\n    padding: 0px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: 0.15s;\n  `;\n  button.title = title;\n\n  button.onclick = (e) => {\n    e.stopPropagation();\n    onClick();\n  };\n\n  return button;\n}\n\n/**\n * Create preview toolbar\n */\nfunction createPreviewToolbar(\n  path: string,\n  ext: string,\n  isImage: boolean,\n  isVideo: boolean,\n  isAudio: boolean,\n  isPDF: boolean,\n  isMarkdown: boolean,\n  isCode: boolean,\n  isSpreadsheet: boolean,\n  content: HTMLElement,\n  previewWindow: HTMLElement\n): HTMLElement {\n  const toolbar = document.createElement(\"div\");\n  toolbar.style.cssText = `\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 10px;\n    padding: 10px;\n    border-top: 1px solid #2a2a2a;\n    background: #1f1f1f;\n  `;\n\n  // Open button\n  const openBtn = createToolbarButton(\"pi-external-link\", \"\", () => {\n    window.open(`/dm/preview?path=${encodeURIComponent(path)}`, '_blank');\n  });\n  toolbar.appendChild(openBtn);\n\n  // Image-specific controls\n  if (isImage) {\n    const zoomInBtn = createToolbarButton(\"pi-search-plus\", \"\", () => {\n      // Zoom in logic\n    });\n    const zoomOutBtn = createToolbarButton(\"pi-search-minus\", \"\", () => {\n      // Zoom out logic\n    });\n    const fitBtn = createToolbarButton(\"pi-arrows-alt\", \"\", () => {\n      // Fit to window logic\n    });\n\n    toolbar.appendChild(zoomInBtn);\n    toolbar.appendChild(zoomOutBtn);\n    toolbar.appendChild(fitBtn);\n  }\n\n  // Refresh button\n  const refreshBtn = createToolbarButton(\"pi-refresh\", \"\", () => {\n    loadPreviewContent(content, path, ext);\n  });\n  toolbar.appendChild(refreshBtn);\n\n  return toolbar;\n}\n\n/**\n * Close floating preview window\n */\nfunction closeFloatingPreview(window: HTMLElement): void {\n  // Remove from floating windows array\n  const idx = (previewFloatingWindows as FloatingWindowData[]).findIndex(w => w.window === window);\n  if (idx > -1) {\n    (previewFloatingWindows as FloatingWindowData[]).splice(idx, 1);\n  }\n\n  // Remove window element\n  window.remove();\n\n  // Update dock\n  updateDock();\n}\n\n/**\n * Minimize floating preview window\n */\nfunction minimizeFloatingPreview(\n  window: HTMLElement,\n  path: string,\n  fileName: string,\n  fileConfig: { icon: string; color: string }\n): void {\n  const windowData = (previewFloatingWindows as FloatingWindowData[]).find(w => w.window === window);\n  if (windowData) {\n    windowData.minimized = true;\n  }\n  window.style.display = \"none\";\n\n  // Update dock\n  updateDock();\n}\n\n/**\n * Toggle fullscreen for floating window\n */\nfunction toggleFullscreen(window: HTMLElement): void {\n  if (window.dataset.fullscreen === \"true\") {\n    window.dataset.fullscreen = \"false\";\n    window.style.top = \"100px\";\n    window.style.right = \"50px\";\n    window.style.width = \"500px\";\n    window.style.height = \"600px\";\n  } else {\n    window.dataset.fullscreen = \"true\";\n    window.style.top = \"0\";\n    window.style.right = \"0\";\n    window.style.width = \"100vw\";\n    window.style.height = \"100vh\";\n    window.style.borderRadius = \"0\";\n  }\n}\n","/**\n * ComfyUI Data Manager - Extension Entry Point\n *\n * Features:\n * - File manager UI interface\n * - File preview (document/image/audio/video)\n * - File operations (create/delete/rename/copy path)\n * - Sort and view toggle\n */\n\n// @ts-ignore - ComfyUI provides this module at runtime\nimport { app } from \"../../scripts/app.js\";\n\n// Import core modules\nimport { FileManagerState, saveLastPath, getLastPath, saveViewMode, getViewMode } from './core/state.js';\n\n// Import UI modules\nimport { createFileManagerWindow, destroyFileManagerWindow, type WindowManagerCallbacks } from './ui/main-window.js';\nimport { loadDirectory, toggleSort, navigateUp, navigateHome } from './ui/components/actions.js';\nimport { checkNodeConnectionAndUpdateFormat } from './ui/components/preview.js';\n\n// Import API modules\nimport { createFile as apiCreateFile, createDirectory as apiCreateDirectory, deleteFile as apiDeleteFile } from './api/endpoints/file.js';\n\n// Import floating window modules\nimport { openFloatingPreview } from './ui/floating/window.js';\n\n// Import utility functions\nimport { updateStatus, showToast, getParentPath, getExt, getFileName } from './utils/helpers.js';\nimport { applyComfyTheme, initThemeSystem } from './utils/theme.js';\n\n// ==================== Constants ====================\nconst MIN_NODE_VERSION = 2;\n\n// Detect Node version (safe detection)\nconst IS_NODE_V3 = typeof (app as { ui?: { version?: { major?: number } } }).ui !== 'undefined' &&\n                    (app as { ui?: { version?: { major?: number } } }).ui !== null &&\n                    (app as { ui: { version?: { major?: number } } }).ui?.version &&\n                    typeof (app as { ui: { version: { major?: number } } }).ui.version === 'object' &&\n                    (app as { ui: { version: { major?: number } } }).ui.version.major &&\n                    (app as { ui: { version: { major: number } } }).ui.version.major >= MIN_NODE_VERSION;\n\nconsole.log(`[DataManager] Extension loading, Node V${IS_NODE_V3 ? '3' : '1'} detected`);\n\n// Global variable reference\nlet fileManagerWindow: HTMLElement | null = null;\n\n// ============================================\n// Extension Configuration\n// ============================================\nconst extensionConfig = {\n  name: \"ComfyUI.DataManager\",\n\n  commands: [\n    {\n      id: \"data-manager.open\",\n      label: \"Open Data Manager\",\n      icon: \"pi pi-folder-open\",\n      function: () => openFileManager()\n    }\n  ],\n\n  keybindings: [\n    { combo: { key: \"d\", ctrl: true, shift: true }, commandId: \"data-manager.open\" }\n  ],\n\n  // Action bar button\n  actionBarButtons: [\n    {\n      icon: \"pi pi-folder\",\n      tooltip: \" (Ctrl+Shift+D)\",\n      class: \"dm-actionbar-btn\",\n      onClick: () => openFileManager()\n    }\n  ],\n\n  async setup() {\n    // Inject official-style button styles\n    const style = document.createElement(\"style\");\n    style.textContent = `\n      .dm-actionbar-btn {\n        width: 32px !important;\n        height: 32px !important;\n        border: none !important;\n        border-radius: 6px !important;\n        background: rgba(255, 255, 255, 0.05) !important;\n        color: rgba(255, 255, 255, 0.9) !important;\n        margin-right: 0.5rem !important;\n        transition: all 0.2s ease !important;\n      }\n      .dm-actionbar-btn:hover {\n        background: rgba(255, 255, 255, 0.15) !important;\n      }\n      .dm-actionbar-btn i {\n        color: rgba(255, 255, 255, 0.9) !important;\n      }\n    `;\n    document.head.appendChild(style);\n\n    // Simplified position fix function\n    const fixPosition = () => {\n      const dmBtn = document.querySelector('.dm-actionbar-btn');\n      const queueBtn = Array.from(document.querySelectorAll('button')).find(b =>\n        b.getAttribute('aria-label') === 'Expand job queue'\n      );\n\n      if (!dmBtn || !queueBtn) return false;\n\n      const queueParent = queueBtn.parentElement;\n      const prevSibling = queueBtn.previousElementSibling;\n\n      // Only move when button is not in correct position\n      if (prevSibling !== dmBtn || dmBtn.parentElement !== queueParent) {\n        queueParent!.insertBefore(dmBtn, queueBtn);\n        console.log('[DataManager] Button position fixed');\n        return true;\n      }\n      return false;\n    };\n\n    // Use more comprehensive listener strategy\n    let lastCall = 0;\n    const observer = new MutationObserver((mutations) => {\n      const now = Date.now();\n      if (now - lastCall < 100) return;\n      lastCall = now;\n\n      // Check for relevant DOM changes\n      const hasRelevantChange = mutations.some(m => {\n        if (m.type === 'childList') {\n          for (const node of m.addedNodes) {\n            if (node.nodeType === 1) {\n              const el = node as Element;\n              if (el.classList?.contains('actionbar-container') ||\n                  el.classList?.contains('dm-actionbar-btn') ||\n                  el.querySelector?.('.dm-actionbar-btn') ||\n                  el.querySelector?.('[aria-label=\"Expand job queue\"]')) {\n                return true;\n              }\n            }\n          }\n        }\n        if ((m.target as Element).closest?.('.actionbar-container')) {\n          return true;\n        }\n        return false;\n      });\n\n      if (hasRelevantChange) {\n        requestAnimationFrame(fixPosition);\n      }\n    });\n\n    // Observe entire body\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true\n    });\n\n    // Periodic position check (as fallback)\n    setInterval(() => {\n      fixPosition();\n    }, 2000);\n\n    console.log(\"[DataManager] Extension setup completed\");\n\n    // Initialize theme system\n    initThemeSystem();\n  },\n\n  async nodeCreated(node: unknown) {\n    const nodeObj = node as { comfyClass?: string; addDOMWidget?: (name: string, type: string, elem: HTMLElement, options?: { minWidth?: number; minHeight?: number }) => void };\n    if (nodeObj.comfyClass === \"DataManagerCore\") {\n      console.log(\"[DataManager] DataManagerCore node created, IS_NODE_V3:\", IS_NODE_V3);\n\n      // V1/V3 API both use addDOMWidget to add button\n      if (nodeObj.addDOMWidget) {\n        const container = document.createElement(\"div\");\n        container.style.cssText = `\n          display: flex;\n          justify-content: center;\n          padding: 10px;\n        `;\n\n        const button = document.createElement(\"button\");\n        button.className = \"comfy-btn\";\n        button.innerHTML = '<i class=\"pi pi-folder-open\"></i> ';\n        button.style.cssText = `\n          padding: 12px 24px;\n          font-size: 14px;\n          background: #6c757d;\n          border: none;\n          border-radius: 8px;\n          color: white;\n          cursor: pointer;\n          transition: all 0.2s;\n          box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        `;\n        button.onmouseover = () => {\n          button.style.background = \"#5a6268\";\n          button.style.transform = \"translateY(-1px)\";\n          button.style.boxShadow = \"0 4px 8px rgba(0,0,0,0.15)\";\n        };\n        button.onmouseout = () => {\n          button.style.background = \"#6c757d\";\n          button.style.transform = \"translateY(0)\";\n          button.style.boxShadow = \"0 2px 4px rgba(0,0,0,0.1)\";\n        };\n        button.onclick = (e) => {\n          e.stopPropagation();\n          openFileManager();\n        };\n\n        container.appendChild(button);\n        nodeObj.addDOMWidget(\"dm_open_btn\", \"dm_open_btn\", container, {\n          minWidth: 200,\n          minHeight: 50\n        });\n      }\n    } else if (nodeObj.comfyClass === \"InputPathConfig\") {\n      console.log(\"[DataManager] InputPathConfig node created\");\n      // Initialize format selector state\n      (nodeObj as { _dmFormatSelectorEnabled?: boolean })._dmFormatSelectorEnabled = false;\n    } else if (nodeObj.comfyClass === \"OutputPathConfig\") {\n      console.log(\"[DataManager] OutputPathConfig node created\");\n      // Initialize OutputPathConfig node state\n      const outputNode = nodeObj as { _dmOutputType?: string; _dmFilePath?: string };\n      outputNode._dmOutputType = \"STRING\";\n      outputNode._dmFilePath = \"\";\n    }\n  },\n\n  getNodeMenuItems(node: unknown) {\n    const nodeObj = node as { comfyClass?: string };\n    if (nodeObj.comfyClass === \"DataManagerCore\") {\n      return [\n        {\n          content: \"\",\n          callback: () => openFileManager()\n        }\n      ];\n    }\n    return [];\n  },\n\n  getCanvasMenuItems() {\n    return [\n      null,\n      {\n        content: \"Data Manager\",\n        callback: () => openFileManager()\n      }\n    ];\n  }\n};\n\n// ============================================\n// Main Functions\n// ============================================\n\n/**\n * Open file manager\n */\nfunction openFileManager(): void {\n  // If window exists, destroy it first (cleanup event listeners)\n  if (fileManagerWindow) {\n    destroyFileManagerWindow();\n  }\n\n  // Restore last visited path, or use default\n  const lastPath = getLastPath();\n  if (lastPath && lastPath !== '.') {\n    FileManagerState.currentPath = lastPath;\n    console.log('[DataManager] Restored last path:', lastPath);\n  } else {\n    FileManagerState.currentPath = \".\";\n  }\n\n  // Create window callbacks\n  const callbacks: WindowManagerCallbacks = {\n    onRefresh: () => loadDirectory(FileManagerState.currentPath),\n    onClose: () => {\n      destroyFileManagerWindow();\n      fileManagerWindow = null;\n    },\n    onOpenFloating: () => {\n      const selected = FileManagerState.selectedFiles[0];\n      if (selected) {\n        openFloatingPreview(selected, getFileName(selected));\n      }\n    },\n    onCopyPath: () => copySelectedPaths(),\n    onDelete: () => deleteSelectedFiles(),\n    // SSH callbacks\n    onSshConnect: async (conn) => {\n      const result = conn as { root_path?: string; username?: string; host?: string };\n      // Set active connection\n      const state = (window as unknown as { _remoteConnectionsState: { active: unknown } })._remoteConnectionsState;\n      state.active = conn;\n      // Save to localStorage\n      try {\n        localStorage.setItem('comfyui_datamanager_last_connection', JSON.stringify(conn));\n      } catch (e) {}\n      // Load remote root directory\n      await loadDirectory(result.root_path || \"/\");\n      showToast(\"success\", \"\", `SSH: ${result.username}@${result.host}`);\n    },\n    onSshDisconnect: async () => {\n      const state = (window as unknown as { _remoteConnectionsState: { active: { connection_id?: string } | null } })._remoteConnectionsState;\n      const conn = state.active;\n      if (conn && conn.connection_id) {\n        try {\n          const { sshDisconnect } = await import('./api/ssh.js');\n          await sshDisconnect(conn.connection_id);\n        } catch (e) {\n          console.log('[DataManager] SSH disconnect error:', e);\n        }\n      }\n      // Clear active connection\n      state.active = null;\n      try {\n        localStorage.removeItem('comfyui_datamanager_last_connection');\n      } catch (e) {}\n      // Load local directory\n      await loadDirectory(\".\");\n      showToast(\"info\", \"\", \"SSH \");\n    }\n  };\n\n  fileManagerWindow = createFileManagerWindow(callbacks);\n\n  // Apply ComfyUI theme\n  applyComfyTheme();\n\n  loadDirectory(FileManagerState.currentPath);\n\n  // Delay check node connection status, ensure window is fully created\n  setTimeout(() => {\n    checkAndUpdateFormatSelector();\n  }, 500);\n}\n\n/**\n * Check InputPathConfig node connection status and update format selector\n */\nfunction checkAndUpdateFormatSelector(): void {\n  try {\n    checkNodeConnectionAndUpdateFormat();\n  } catch (e) {\n    console.log(\"[DataManager] Error in checkAndUpdateFormatSelector:\", e);\n  }\n}\n\n// ============================================\n// File Operations\n// ============================================\n\n/**\n * Copy selected file paths to clipboard\n */\nfunction copySelectedPaths(): void {\n  const selected = FileManagerState.selectedFiles;\n  if (selected.length === 0) {\n    showToast(\"warn\", \"\", \"\");\n    return;\n  }\n\n  const paths = selected.join('\\n');\n  navigator.clipboard.writeText(paths).then(() => {\n    showToast(\"success\", \"\", ` ${selected.length} `);\n  }).catch(() => {\n    showToast(\"error\", \"\", \"\");\n  });\n}\n\n/**\n * Delete selected files\n */\nasync function deleteSelectedFiles(): Promise<void> {\n  const selected = FileManagerState.selectedFiles;\n  if (selected.length === 0) {\n    showToast(\"warn\", \"\", \"\");\n    return;\n  }\n\n  const message = selected.length === 1\n    ? ` \"${getFileName(selected[0])}\"?`\n    : ` ${selected.length} ?`;\n\n  if (!confirm(message)) {\n    return;\n  }\n\n  try {\n    for (const path of selected) {\n      await apiDeleteFile(path, true);\n    }\n    showToast(\"success\", \"\", ` ${selected.length} `);\n    loadDirectory(FileManagerState.currentPath);\n  } catch (error) {\n    showToast(\"error\", \"\", (error as Error).message);\n  }\n}\n\n// ============================================\n// Register Extension\n// ============================================\napp.registerExtension(extensionConfig);\n\nexport { extensionConfig };\n"],"file":"extension.js"}