{"version":3,"mappings":"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","names":["STORAGE_KEYS","FileManagerState","saveState","key","value","e","loadState","defaultValue","saveLastPath","path","getLastPath","saveViewMode","mode","getViewMode","fileManagerWindow","previewModal","previewFloatingWindows","REMOTE_STORAGE_KEY","LAST_CONN_STORAGE_KEY","remoteConnectionsStateValue","initRemoteConnections","saved","lastConn","remoteConnectionsState","themeListeners","addThemeListener","callback","notifyThemeChanged","theme","getComfyTheme","setupThemeWatcher","observer","mutations","shouldUpdate","mutation","applyComfyTheme","lastThemeValues","getThemeValues","checkInterval","currentThemeValues","rootStyle","themeWatcher","initThemeSystem","error","isLightColor","color","match","r","g","b","hex","bodyStyle","bgPrimary","bgSecondary","isLight","comfyBgTertiary","bgTertiary","inputBg","rawInputText","textPrimary","textSecondary","bgHover","root","applyThemeToHeader","header","createHeader","options","title","icon","onClose","onMinimize","onFullscreen","onRefresh","trafficLights","closeBtn","createTrafficButton","minimizeBtn","fullscreenBtn","titleArea","iconElement","titleText","actions","refreshBtn","createHeaderButton","currentTheme","onClick","button","createRemoteSelector","callbacks","onSshConnect","onSshDisconnect","container","select","updateRemoteOptions","state","updateConnectionStatus","connId","savedConn","c","opt","sshConnect","result","connectionData","err","active","localOpt","selectedValue","conn","indicator","statusText","createNewButton","createSortSelect","sortSelect","option","createSettingsButton","openSettingsPanel","__vitePreload","sshDisconnect","createToolbar","toolbar","leftSection","navGroup","upBtn","m","homeBtn","pathInput","loadDirectory","rightSection","viewToggleBtn","updateViewToggleButton","newMode","browserPanel","API_ENDPOINTS","LIMITS","FILE_TYPES","getFileType","file","ext","type","config","getTypeByExt","formatSize","bytes","unit","formatDate","dateStr","escapeHtml","text","div","createBrowserPanel","viewMode","panel","createListHeader","content","createHeaderCell","sortKey","label","width","cell","toggleSort","createFileListItem","isParent","fileType","size","modified","createFileGridItem","filePath","thumbUrl","FORMAT_TYPE_MAP","TYPE_FORMATS","getFormatsForType","typeKey","getTypeColor","getTypeIcon","createFormatSelector","detectedType","selectedFormat","onFormatChange","showTypeIndicator","compact","typeIndicator","typeColor","formatSection","formats","defaultFormat","fmt","updateFormatDescription","buttonGroup","btn","isSelected","btnEl","description","format","descriptionEl","DEFAULT_DETECTED_TYPE","checkNodeConnectionAndUpdateFormat","app","inputPathConfigNodes","n","fileInput","i","sourceNodeId","sourceNode","detectTypeFromSourceNode","updateFormatSelector","node","nodeType","typeMapping","output","createPreviewPanel","onOpenFloating","onCopyPath","onDelete","infoSection","floatingBtn","copyPathBtn","deleteBtn","currentFormat","selector","createStatusBar","bottomArea","dock","bar","setupWindowDrag","windowEl","rect","offsetX","offsetY","mouseMoveHandler","x","y","mouseUpHandler","keydownHandler","createFileManagerWindow","window","toastContainer","createMainContent","destroyFileManagerWindow","mainContent","previewPanel","listDirectory","response","errorData","errorMsg","getPreviewUrl","getFileInfo","createFile","directory","filename","createDirectory","dirname","deleteFile","useTrash","updateStatus","statusBar","showToast","severity","summary","detail","showInternalToast","colors","toast","getParentPath","normalized","lastSlash","getFileName","getExt","remoteConn","loadRemoteDirectory","data","renderFileListUI","sshList","sortedFiles","a","aIsDir","bIsDir","comparison","html","item","selectFile","openFile","selectGridItem","previewFile","updateCopyPathButtonState","copyBtn","hasSelection","isDir","clearPreviewPanel","previewContent","column","updateHeaderSortIndicators","navigateUp","parentPath","navigateHome","navigateBack","loadDirectoryWithoutHistory","updateNavButtons","navigateForward","loadRemoteDirectoryWithoutHistory","backBtn","forwardBtn","CODE_COLORS","highlightCode","code","highlightJSON","highlightPython","highlightJavaScript","highlightHTML","highlightCSS","highlightYAML","highlightXML","highlightGeneric","keywords","decorators","strings","comments","numbers","functions","templateStrings","arrowFunc","loadScript","src","resolve","reject","script","parseCSV","rows","currentRow","currentCell","inQuotes","char","nextChar","DEFAULT_OPTIONS","MODE_CONFIG","createTableHTML","mergedOptions","hasFullscreen","displayRows","isTruncated","tableId","tablePath","heightStyle","containerStyle","tableHTML","row","rowIndex","isHeader","cellContent","createTableControls","maxRows","setupTableControls","controlsHTML","modeType","table","showFullscreen","zoom","tableEl","wrapper","zoomDisplay","zoomInBtn","zoomOutBtn","fitBtn","updateZoom","containerWidth","tableWidth","newZoom","fileName","openFloatingPreview","window$1","createTableErrorHTML","parseSpreadsheet","win","arrayBuffer","XLSX","workbook","firstSheetName","worksheet","cleanMammothOutput","cleaned","functionPattern","targetPattern","objectPattern","loadPreviewContent","scale","imageId","previewHTML","imageUrl","audioUrl","audioId","displayName","audioExt","videoUrl","videoId","extUpper","docUrl","isPDF","isMarkdown","isDocx","scriptError","mammoth","rawHtml","cleanedHtml","contentId","updateFileInfo","fileInfo","info","updateDock","minimizedWindows","w","thumbnail","restoreFloatingPreview","windowData","DEFAULT_IMAGE_SCALE","DEFAULT_DOC_FONT_SIZE","DEFAULT_CODE_FONT_SIZE","FONT_SIZE_MIN","FONT_SIZE_MAX","FONT_SIZE_DISPLAY_MIN_WIDTH","ICONS","TITLES","SELECTORS","createToolbarButton","existingWindow","fileConfig","isImage","isVideo","isAudio","isDocument","isCode","isSpreadsheet","previewWindow","createPreviewHeader","mediaId","createPreviewToolbar","textColor","createTrafficLightButton","closeFloatingPreview","minimizeFloatingPreview","toggleFullscreen","newTheme","newTextColor","addFontSizeControls","toolbarLeft","createToolbarSeparator","fontSize","fontDownBtn","updateFontSize","fontDisplay","fontUpBtn","resetBtn","targetElement","addMediaControls","toolbarRight","mediaElement","timeDisplay","volumeBtn","playPauseBtn","formatTime","seconds","mins","secs","videoFullscreenBtn","openBtn","toolbarCenter","separator","setupImageToolbarControls","pdfFullscreenBtn","embed","docFullscreenBtn","codeFullscreenBtn","spreadsheetFullscreenBtn","imagePath","image","imageTranslateX","imageTranslateY","delta","isDraggingImage","dragStart","idx","_path","_fileName","_fileConfig","MIN_NODE_VERSION","IS_NODE_V3","extensionConfig","openFileManager","style","ensureThemeApplied","fixPosition","dmBtn","queueBtn","queueParent","lastCall","now","el","nodeObj","outputNode","lastPath","selected","copySelectedPaths","deleteSelectedFiles","sortBy","showNewFileDialog","checkAndUpdateFormatSelector","paths","fallbackCopy","textArea","message","apiDeleteFile","modal","dialog","fileBtn","folderBtn","cancelBtn","createNewFile","createNewFolder","name","apiCreateFile","apiCreateDirectory"],"ignoreList":[],"sources":["../frontend/src/core/state.ts","../frontend/src/utils/theme.ts","../frontend/src/ui/components/header.ts","../frontend/src/ui/components/toolbar.ts","../frontend/src/core/constants.ts","../frontend/src/utils/file-type.ts","../frontend/src/utils/format.ts","../frontend/src/ui/components/browser.ts","../frontend/src/ui/components/format-selector.ts","../frontend/src/ui/components/preview.ts","../frontend/src/utils/drag.ts","../frontend/src/ui/main-window.ts","../frontend/src/api/endpoints/file.ts","../frontend/src/utils/helpers.ts","../frontend/src/ui/components/actions.ts","../frontend/src/utils/syntax-highlight.ts","../frontend/src/utils/script.ts","../frontend/src/utils/csv.ts","../frontend/src/utils/table.ts","../frontend/src/ui/floating/preview-content.ts","../frontend/src/ui/floating/dock.ts","../frontend/src/ui/floating/window.ts","../frontend/src/extension.ts"],"sourcesContent":["/**\n * ComfyUI Data Manager - State Management\n */\n\n// ==================== Types ====================\n\nexport type ViewMode = 'list' | 'grid'\nexport type SortBy = 'name' | 'size' | 'modified'\nexport type SortOrder = 'asc' | 'desc'\n\nexport interface FileItem {\n  name: string\n  path?: string\n  size?: number\n  modified?: number | string\n  is_dir?: boolean\n  isDir?: boolean // Alias for compatibility\n  type?: string\n}\n\nexport interface FileManagerStateData {\n  currentPath: string\n  selectedFiles: string[] // Array of file paths (strings)\n  currentPreviewFile: string | null\n  viewMode: ViewMode\n  sortBy: SortBy\n  sortOrder: SortOrder\n  files: FileItem[]\n  history: string[]\n  historyIndex: number\n}\n\nexport interface RemoteConnection {\n  id: string\n  name: string\n  host: string\n  port: number\n  username: string\n  password?: string\n  keyPath?: string\n}\n\nexport interface RemoteConnectionsState {\n  active: RemoteConnection | null\n  saved: RemoteConnection[]\n}\n\n// ==================== Storage Keys ====================\n\nexport const STORAGE_KEYS = {\n  LAST_PATH: 'comfyui_datamanager_last_path',\n  VIEW_MODE: 'comfyui_datamanager_view_mode',\n  SORT_BY: 'comfyui_datamanager_sort_by',\n  REMOTE_CONNECTIONS: 'comfyui_datamanager_remote_connections',\n  LAST_CONNECTION: 'comfyui_datamanager_last_connection',\n} as const\n\n// ==================== File Manager State ====================\n\nexport const FileManagerState: FileManagerStateData = {\n  currentPath: '',\n  selectedFiles: [],\n  currentPreviewFile: null,\n  viewMode: 'list',\n  sortBy: 'name',\n  sortOrder: 'asc',\n  files: [],\n  history: [],\n  historyIndex: -1,\n}\n\n// ==================== Storage Functions ====================\n\nexport function saveState(key: string, value: unknown): void {\n  try {\n    localStorage.setItem(key, JSON.stringify(value))\n  } catch (e) {\n    console.warn('[DataManager] Failed to save state:', e)\n  }\n}\n\nexport function loadState<T>(key: string, defaultValue: T): T {\n  try {\n    const value = localStorage.getItem(key)\n    return value ? (JSON.parse(value) as T) : defaultValue\n  } catch (e) {\n    console.warn('[DataManager] Failed to load state:', e)\n    return defaultValue\n  }\n}\n\nexport function saveLastPath(path: string): void {\n  saveState(STORAGE_KEYS.LAST_PATH, path)\n}\n\nexport function getLastPath(): string {\n  return loadState<string>(STORAGE_KEYS.LAST_PATH, '.')\n}\n\nexport function saveViewMode(mode: ViewMode): void {\n  saveState(STORAGE_KEYS.VIEW_MODE, mode)\n}\n\nexport function getViewMode(): ViewMode {\n  return loadState<ViewMode>(STORAGE_KEYS.VIEW_MODE, 'list')\n}\n\n// ==================== Global Variables ====================\n\nexport let fileManagerWindow: Window | null = null\nexport let previewModal: HTMLElement | null = null\nexport let previewFloatingWindows: unknown[] = [] // Will contain FloatingWindowData objects\n\n// ==================== SSH Remote Connection State ====================\n\nconst REMOTE_STORAGE_KEY = STORAGE_KEYS.REMOTE_CONNECTIONS\nconst LAST_CONN_STORAGE_KEY = STORAGE_KEYS.LAST_CONNECTION\n\n// Initialize remote connections state\nlet remoteConnectionsStateValue: RemoteConnectionsState = {\n  active: null,\n  saved: [],\n}\n\n// Initialize remote connections\nfunction initRemoteConnections(): void {\n  try {\n    const saved = localStorage.getItem(REMOTE_STORAGE_KEY)\n    if (saved) {\n      remoteConnectionsStateValue.saved = JSON.parse(saved)\n    }\n    const lastConn = localStorage.getItem(LAST_CONN_STORAGE_KEY)\n    if (lastConn) {\n      remoteConnectionsStateValue.active = JSON.parse(lastConn)\n    }\n    // Update window reference (for compatibility with existing code)\n    if (window._remoteConnectionsState) {\n      window._remoteConnectionsState.active = remoteConnectionsStateValue.active\n      window._remoteConnectionsState.saved = remoteConnectionsStateValue.saved\n    } else {\n      window._remoteConnectionsState = remoteConnectionsStateValue\n    }\n  } catch (e) {\n    console.warn('[DataManager] Failed to init remote connections:', e)\n  }\n}\n\n// Initialize immediately\ninitRemoteConnections()\n\n// Export for external use\nexport const remoteConnectionsState = remoteConnectionsStateValue\n","/**\n * ComfyUI Data Manager - Theme Utilities\n *\n * Get ComfyUI CSS variables and adapt to Data Manager interface\n */\n\n// Theme listener callback type\nexport type ThemeListener = (theme: ComfyTheme) => void\n\n// Theme listeners\nconst themeListeners: ThemeListener[] = []\n\n/**\n * ComfyUI theme colors interface\n */\nexport interface ComfyTheme {\n  bgPrimary: string\n  bgSecondary: string\n  bgTertiary: string\n  inputBg: string\n  inputText: string\n  borderColor: string\n  textPrimary: string\n  textSecondary: string\n  accentColor: string\n  errorColor: string\n  successColor: string\n  isLight: boolean\n}\n\n/**\n * Add theme change listener\n * @param callback - Callback function when theme changes\n */\nexport function addThemeListener(callback: ThemeListener): void {\n  themeListeners.push(callback)\n}\n\n/**\n * Notify all theme listeners\n */\nexport function notifyThemeChanged(): void {\n  const theme = getComfyTheme()\n  themeListeners.forEach((callback) => {\n    try {\n      callback(theme)\n    } catch (e) {\n      console.error('[DataManager] Theme listener error:', e)\n    }\n  })\n}\n\n/**\n * Setup ComfyUI theme watcher\n */\nfunction setupThemeWatcher(): { observer: MutationObserver; checkInterval: number } {\n  // Listen for body attribute changes (some theme systems switch themes via attributes)\n  const observer = new MutationObserver((mutations) => {\n    let shouldUpdate = false\n    for (const mutation of mutations) {\n      if (mutation.type === 'attributes') {\n        shouldUpdate = true\n        break\n      }\n    }\n    if (shouldUpdate) {\n      applyComfyTheme()\n      notifyThemeChanged()\n    }\n  })\n\n  observer.observe(document.documentElement, {\n    attributes: true,\n    attributeFilter: ['class', 'data-theme'],\n  })\n\n  // Listen for CSS variable changes\n  let lastThemeValues = getThemeValues()\n  const checkInterval = window.setInterval(() => {\n    const currentThemeValues = getThemeValues()\n    if (JSON.stringify(lastThemeValues) !== JSON.stringify(currentThemeValues)) {\n      lastThemeValues = currentThemeValues\n      applyComfyTheme()\n      notifyThemeChanged()\n    }\n  }, 2000)\n\n  return { observer, checkInterval }\n}\n\n/**\n * Get current theme values for comparison\n */\nfunction getThemeValues(): Record<string, string> {\n  const rootStyle = window.getComputedStyle(document.documentElement)\n  return {\n    bg: rootStyle.getPropertyValue('--comfy-menu-bg'),\n    bg2: rootStyle.getPropertyValue('--comfy-menu-bg-2'),\n    inputText: rootStyle.getPropertyValue('--input-text'),\n    borderColor: rootStyle.getPropertyValue('--border-color'),\n  }\n}\n\n// Theme watcher instance\nlet themeWatcher: { observer: MutationObserver; checkInterval: number } | null = null\n\n/**\n * Initialize theme system\n */\nexport function initThemeSystem(): void {\n  if (!themeWatcher) {\n    // Delay initialization to ensure DOM is fully loaded\n    setTimeout(() => {\n      try {\n        themeWatcher = setupThemeWatcher()\n      } catch (error) {\n        console.error('[DataManager] Theme watcher init failed:', error)\n      }\n    }, 1000)\n  }\n}\n\n/**\n * Check if a color is light\n * @param color - CSS color value\n * @returns True if color is light\n */\nfunction isLightColor(color: string): boolean {\n  // Handle rgb() format\n  if (color.includes('rgb')) {\n    const match = color.match(/rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)/)\n    if (match) {\n      const r = parseInt(match[1])\n      const g = parseInt(match[2])\n      const b = parseInt(match[3])\n      const brightness = (r * 299 + g * 587 + b * 114) / 1000\n      // console.log('[DataManager Theme] Color brightness:', brightness, 'for', color);\n      return brightness > 128\n    }\n  }\n\n  // Handle hex format\n  const hex = color.replace('#', '')\n  if (hex.length === 3) {\n    const r = parseInt(hex[0] + hex[0], 16)\n    const g = parseInt(hex[1] + hex[1], 16)\n    const b = parseInt(hex[2] + hex[2], 16)\n    return (r * 299 + g * 587 + b * 114) / 1000 > 128\n  }\n  if (hex.length === 6) {\n    const r = parseInt(hex.substring(0, 2), 16)\n    const g = parseInt(hex.substring(2, 4), 16)\n    const b = parseInt(hex.substring(4, 6), 16)\n    return (r * 299 + g * 587 + b * 114) / 1000 > 128\n  }\n  return false\n}\n\n/**\n * Get ComfyUI theme CSS variables\n * @returns Theme color object\n */\nexport function getComfyTheme(): ComfyTheme {\n  try {\n    const rootStyle = window.getComputedStyle(document.documentElement)\n    const bodyStyle = window.getComputedStyle(document.body)\n\n    // Get background colors\n    const bgPrimary = rootStyle.getPropertyValue('--comfy-menu-bg')?.trim() || '#1a1a1a'\n    const bgSecondary =\n      rootStyle.getPropertyValue('--comfy-menu-bg-2')?.trim() ||\n      rootStyle.getPropertyValue('--comfy-menu-secondary-bg')?.trim() ||\n      '#252525'\n\n    // CRITICAL: Detect theme based on bgPrimary (main window background)\n    const isLight = isLightColor(bgPrimary)\n\n    // For bgTertiary, use appropriate color based on theme\n    // ComfyUI's --comfy-menu-bg-3 may be dark even in light themes, so we override it\n    const comfyBgTertiary = rootStyle.getPropertyValue('--comfy-menu-bg-3')?.trim()\n    let bgTertiary: string\n    let inputBg: string\n\n    if (isLight) {\n      // Light theme: use light gray for buttons/inputs\n      bgTertiary = '#f0f0f0'\n      inputBg = rootStyle.getPropertyValue('--comfy-input-bg')?.trim() || '#ffffff'\n    } else {\n      // Dark theme: use ComfyUI's value or default dark\n      bgTertiary = comfyBgTertiary || '#2a2a2a'\n      inputBg = rootStyle.getPropertyValue('--comfy-input-bg')?.trim() || bgTertiary\n    }\n\n    // console.log('[DataManager Theme] bgPrimary:', bgPrimary);\n    // console.log('[DataManager Theme] isLight:', isLight);\n    // console.log('[DataManager Theme] bgTertiary (final):', bgTertiary);\n\n    // Get raw input text color from ComfyUI for debugging\n    const rawInputText = rootStyle.getPropertyValue('--input-text')?.trim() || ''\n    // console.log('[DataManager Theme] rawInputText:', rawInputText);\n\n    // CRITICAL: For text colors, ALWAYS use smart defaults based on theme brightness\n    // Never use ComfyUI's --input-text directly because it may have wrong contrast\n    const textPrimary = isLight ? '#222222' : '#dddddd'\n    const textSecondary = isLight ? '#666666' : '#999999'\n\n    // console.log('[DataManager Theme] Using textPrimary:', textPrimary, 'textSecondary:', textSecondary);\n\n    return {\n      // Background colors\n      bgPrimary: bgPrimary,\n      bgSecondary: bgSecondary,\n      bgTertiary: bgTertiary,\n\n      // Input - ALWAYS use theme-appropriate color, not ComfyUI's\n      inputBg: inputBg,\n      inputText: textPrimary,\n\n      // Border\n      borderColor:\n        rootStyle.getPropertyValue('--border-color')?.trim() || (isLight ? '#dddddd' : '#444444'),\n\n      // Text\n      textPrimary: textPrimary,\n      textSecondary: textSecondary,\n\n      // Accent (some themes may define)\n      accentColor: rootStyle.getPropertyValue('--comfy-accent')?.trim() || '#9b59b6',\n\n      // Error/success\n      errorColor: '#e74c3c',\n      successColor: '#27ae60',\n      isLight,\n    }\n  } catch (error) {\n    console.warn('[DataManager] Failed to get ComfyUI theme:', error)\n    // Return default dark theme\n    return {\n      bgPrimary: '#1a1a1a',\n      bgSecondary: '#252525',\n      bgTertiary: '#2a2a2a',\n      inputBg: '#2a2a2a',\n      inputText: '#dddddd',\n      borderColor: '#444444',\n      textPrimary: '#dddddd',\n      textSecondary: '#999999',\n      accentColor: '#9b59b6',\n      errorColor: '#e74c3c',\n      successColor: '#27ae60',\n      isLight: false,\n    }\n  }\n}\n\n/**\n * Apply ComfyUI theme to Data Manager elements\n */\nexport function applyComfyTheme(): void {\n  const theme = getComfyTheme()\n\n  // Calculate hover color (slightly darker for light theme, lighter for dark theme)\n  const bgHover = theme.isLight ? '#e0e0e0' : '#3a3a3a'\n\n  // Apply CSS custom properties to root\n  const root = document.documentElement\n  root.style.setProperty('--dm-bg-primary', theme.bgPrimary)\n  root.style.setProperty('--dm-bg-secondary', theme.bgSecondary)\n  root.style.setProperty('--dm-bg-tertiary', theme.bgTertiary)\n  root.style.setProperty('--dm-bg-hover', bgHover)\n  root.style.setProperty('--dm-input-bg', theme.inputBg)\n  root.style.setProperty('--dm-input-text', theme.inputText)\n  root.style.setProperty('--dm-border-color', theme.borderColor)\n  root.style.setProperty('--dm-text-primary', theme.textPrimary)\n  root.style.setProperty('--dm-text-secondary', theme.textSecondary)\n  root.style.setProperty('--dm-accent-color', theme.accentColor)\n  root.style.setProperty('--dm-error-color', theme.errorColor)\n  root.style.setProperty('--dm-success-color', theme.successColor)\n}\n","/**\n * ComfyUI Data Manager - Header Component\n */\n\nimport type { ComfyTheme } from '../../utils/theme.js'\nimport { getComfyTheme, addThemeListener } from '../../utils/theme.js'\n\n/**\n * Header options\n */\nexport interface HeaderOptions {\n  title?: string\n  icon?: string\n  onClose?: () => void\n  onMinimize?: () => void\n  onFullscreen?: () => void\n  onRefresh?: () => void\n}\n\n// Theme change callback storage\nlet themeChangeCallback: ((theme: ComfyTheme) => void) | null = null\n\n/**\n * Apply theme to header\n * @param header - Header element\n * @param theme - Theme object\n */\nfunction applyThemeToHeader(header: HTMLElement, theme: ComfyTheme): void {\n  if (!header) return\n\n  header.style.background = `linear-gradient(135deg, ${theme.bgSecondary} 0%, ${theme.bgPrimary} 100%)`\n  header.style.borderColor = theme.borderColor\n}\n\n/**\n * Create window header (ComfyUI style)\n * @param options - Configuration options\n * @returns Header element\n */\nexport function createHeader(options: HeaderOptions = {}): HTMLElement {\n  const {\n    title = 'Data Manager',\n    icon = 'pi-folder-open',\n    onClose = null,\n    onMinimize = null,\n    onFullscreen = null,\n    onRefresh = null,\n  } = options\n\n  const theme = getComfyTheme()\n\n  const header = document.createElement('div')\n  header.className = 'dm-header dm-preview-header'\n  header.setAttribute('draggable', 'false')\n\n  header.style.cssText = `\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 10px 16px;\n    background: transparent;\n    border-bottom: 0.8px solid ${theme.borderColor};\n    cursor: move;\n    user-select: none;\n    gap: 12px;\n  `\n\n  // Traffic light buttons (macOS style)\n  const trafficLights = document.createElement('div')\n  trafficLights.className = 'dm-traffic-lights'\n  trafficLights.style.cssText = 'display: flex; gap: 8px;'\n\n  const closeBtn = createTrafficButton('pi-times', '', onClose)\n  const minimizeBtn = createTrafficButton('pi-minus', '', onMinimize)\n  const fullscreenBtn = createTrafficButton('pi-window-maximize', '', onFullscreen)\n\n  trafficLights.appendChild(closeBtn)\n  trafficLights.appendChild(minimizeBtn)\n  trafficLights.appendChild(fullscreenBtn)\n\n  // Title area\n  const titleArea = document.createElement('div')\n  titleArea.className = 'dm-header-title-area'\n  titleArea.style.cssText = `\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 14px;\n    font-weight: 500;\n    flex: 1 1 0%;\n    color: ${theme.textPrimary};\n  `\n\n  const iconElement = document.createElement('i')\n  iconElement.className = `pi ${icon}`\n  iconElement.style.color = theme.textSecondary\n\n  const titleText = document.createElement('span')\n  titleText.style.cssText = `\n    flex: 1;\n    min-width: 0;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  `\n  titleText.textContent = title\n\n  titleArea.appendChild(iconElement)\n  titleArea.appendChild(titleText)\n\n  // Actions area (right side)\n  const actions = document.createElement('div')\n  actions.style.cssText = 'display: flex; gap: 8px; align-items: center;'\n\n  if (onRefresh) {\n    const refreshBtn = createHeaderButton('pi-refresh', '', onRefresh)\n    actions.appendChild(refreshBtn)\n  }\n\n  header.appendChild(trafficLights)\n  header.appendChild(titleArea)\n  header.appendChild(actions)\n\n  // Store theme update function\n  ;(header as unknown as { _updateTheme?: () => void })._updateTheme = () => {\n    const currentTheme = getComfyTheme()\n    applyThemeToHeader(header, currentTheme)\n    if (themeChangeCallback) {\n      themeChangeCallback(currentTheme)\n    }\n  }\n\n  // Register theme change listener\n  addThemeListener((theme) => {\n    applyThemeToHeader(header, theme)\n  })\n\n  return header\n}\n\n/**\n * Create traffic light button (ComfyUI style)\n * @param icon - Icon class name\n * @param title - Tooltip text\n * @param onClick - Click callback\n * @returns Button element\n */\nfunction createTrafficButton(\n  icon: string,\n  title: string,\n  onClick: (() => void) | null\n): HTMLElement {\n  const theme = getComfyTheme()\n  const button = document.createElement('button')\n  button.className = 'comfy-btn dm-traffic-btn'\n  button.innerHTML = `<i class=\"pi ${icon}\" style=\"font-size: 12px;\"></i>`\n  button.style.cssText = `\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: 0.8px solid ${theme.borderColor};\n    border-radius: 6px;\n    color: ${theme.textSecondary};\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.15s ease;\n  `\n  button.title = title\n\n  // Hover effect\n  button.onmouseenter = () => {\n    button.style.background = theme.bgTertiary\n    button.style.color = theme.textPrimary\n  }\n  button.onmouseleave = () => {\n    button.style.background = 'transparent'\n    button.style.color = theme.textSecondary\n  }\n\n  if (onClick) {\n    button.onclick = (e) => {\n      e.stopPropagation()\n      onClick()\n    }\n  }\n\n  return button\n}\n\n/**\n * Create header button (ComfyUI style)\n * @param icon - Icon class name\n * @param title - Title text\n * @param onClick - Click callback\n * @returns Button element\n */\nexport function createHeaderButton(icon: string, title: string, onClick: () => void): HTMLElement {\n  const theme = getComfyTheme()\n  const button = document.createElement('button')\n  button.className = 'comfy-btn dm-header-btn'\n  button.innerHTML = `<i class=\"pi ${icon}\" style=\"font-size: 14px;\"></i>`\n  button.style.cssText = `\n    width: 28px;\n    height: 28px;\n    padding: 0;\n    background: transparent;\n    border: 0.8px solid ${theme.borderColor};\n    border-radius: 6px;\n    color: ${theme.textSecondary};\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.15s ease;\n  `\n  button.title = title\n\n  button.onmouseenter = () => {\n    button.style.background = theme.bgTertiary\n    button.style.color = theme.textPrimary\n  }\n  button.onmouseleave = () => {\n    button.style.background = 'transparent'\n    button.style.color = theme.textSecondary\n  }\n  button.onmouseout = () => (button.style.background = 'transparent')\n  button.onclick = onClick\n  return button\n}\n","/**\n * ComfyUI Data Manager - Toolbar Component\n */\n\nimport { getComfyTheme } from '../../utils/theme.js'\nimport { FileManagerState } from '../../core/state.js'\n\n/**\n * Toolbar callbacks\n */\nexport interface ToolbarCallbacks {\n  onSshConnect?: (result: unknown) => void\n  onSshDisconnect?: () => void\n  onSortChange?: (sortBy: string) => void\n  onNewFile?: () => void\n}\n\n/**\n * Remote connection state interface\n */\ninterface RemoteConnection {\n  id?: string\n  name?: string\n  host?: string\n  port?: number\n  username?: string\n  password?: string\n  connection_id?: string\n}\n\ninterface RemoteConnectionsState {\n  active: RemoteConnection | null\n  saved: RemoteConnection[]\n}\n\n/**\n * Create remote device selector\n * @param callbacks - Callback functions\n * @returns Selector container element\n */\nfunction createRemoteSelector(callbacks: ToolbarCallbacks): HTMLElement {\n  const { onSshConnect, onSshDisconnect } = callbacks\n  const theme = getComfyTheme()\n\n  const container = document.createElement('div')\n  container.style.cssText = 'display: flex; align-items: center; gap: 5px;'\n\n  // Device select dropdown\n  const select = document.createElement('select')\n  select.id = 'dm-remote-select'\n  select.style.cssText = `\n    padding: 8px 12px;\n    border: 1px solid ${theme.borderColor} !important;\n    border-radius: 6px;\n    font-size: 13px;\n    min-width: 150px;\n    cursor: pointer;\n    background: ${theme.bgTertiary} !important;\n    color: ${theme.inputText} !important;\n  `\n\n  // Initialize options\n  updateRemoteOptions(select, onSshConnect, onSshDisconnect)\n\n  select.onchange = async (e) => {\n    const value = (e.target as HTMLSelectElement).value\n    const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })\n      ._remoteConnectionsState\n\n    if (value === '__local__') {\n      // Switch to local\n      state.active = null\n      try {\n        localStorage.removeItem('comfyui_datamanager_last_connection')\n      } catch (err) {}\n      // \n      updateConnectionStatus()\n      // \n      if (onSshDisconnect) {\n        await onSshDisconnect()\n        // \n        updateRemoteOptions(select, onSshConnect, onSshDisconnect)\n      }\n    } else if (value.startsWith('conn_')) {\n      // Connect to saved device\n      const connId = value.substring(5)\n      const savedConn = state.saved.find((c) => c.id === connId)\n      if (savedConn) {\n        try {\n          select.disabled = true\n          const opt = document.createElement('option')\n          opt.textContent = '...'\n          select.innerHTML = ''\n          select.appendChild(opt)\n\n          //  SSH API \n          const { sshConnect } = await import('../../api/ssh.js')\n          const result = await sshConnect(\n            savedConn.host || '',\n            savedConn.port || 22,\n            savedConn.username || '',\n            atob(savedConn.password || '')\n          )\n\n          // \n          const connectionData = {\n            ...savedConn,\n            connection_id: result.connection_id,\n            root_path: result.root_path,\n          }\n\n          state.active = connectionData\n          try {\n            localStorage.setItem(\n              'comfyui_datamanager_last_connection',\n              JSON.stringify(connectionData)\n            )\n          } catch (err) {}\n\n          // \n          updateConnectionStatus()\n\n          // \n          if (onSshConnect) await onSshConnect(connectionData)\n\n          // \n          select.disabled = false // \n          updateRemoteOptions(select, onSshConnect, onSshDisconnect)\n        } catch (err) {\n          alert(': ' + (err as Error).message)\n          select.disabled = false\n          updateRemoteOptions(select, onSshConnect, onSshDisconnect)\n        }\n      }\n    }\n    //  updateRemoteOptions \n  }\n\n  container.appendChild(select)\n\n  return container\n}\n\n/**\n * Update remote selector options\n */\nfunction updateRemoteOptions(\n  select: HTMLSelectElement,\n  onSshConnect?: (result: unknown) => void,\n  onSshDisconnect?: () => void\n): void {\n  const theme = getComfyTheme()\n  const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })\n    ._remoteConnectionsState\n  const active = state.active\n\n  select.innerHTML = ''\n\n  // Local option\n  const localOpt = document.createElement('option')\n  localOpt.value = '__local__'\n  localOpt.textContent = ''\n  // \n  if (!active) {\n    localOpt.selected = true\n  }\n  select.appendChild(localOpt)\n\n  // Saved connections\n  let selectedValue = '__local__' // \n  state.saved.forEach((conn) => {\n    const opt = document.createElement('option')\n    opt.value = `conn_${conn.id}`\n    opt.textContent = conn.name || `${conn.username}@${conn.host}`\n    //  active.id  conn.id active.connection_id\n    //  connection_id id \n    if (active && active.id === conn.id) {\n      ;(opt as HTMLOptionElement).style.color = theme.successColor\n      opt.selected = true\n      selectedValue = opt.value\n    }\n    select.appendChild(opt)\n  })\n\n  // \n  select.value = selectedValue\n}\n\n/**\n * Update connection status indicator\n */\nfunction updateConnectionStatus(): void {\n  const theme = getComfyTheme()\n  const indicator = document.getElementById('dm-connection-indicator')\n  const statusText = document.getElementById('dm-connection-status')\n  const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })\n    ._remoteConnectionsState\n  const active = state.active\n\n  if (indicator) {\n    ;(indicator as HTMLElement).style.background = active ? theme.successColor : theme.textSecondary\n  }\n  if (statusText) {\n    if (active) {\n      statusText.textContent = `SSH: ${active.username}@${active.host}`\n    } else {\n      statusText.textContent = ''\n    }\n  }\n}\n\n/**\n * Create new file button\n * @param callbacks - Callback functions\n * @returns Button element\n */\nfunction createNewButton(callbacks: ToolbarCallbacks): HTMLElement {\n  const theme = getComfyTheme()\n  const button = document.createElement('button')\n  button.className = 'comfy-btn'\n  button.id = 'dm-new-btn'\n  button.innerHTML = '<i class=\"pi pi-plus\"></i>'\n  button.style.cssText = `\n    padding: 8px 12px;\n    border: 1px solid ${theme.borderColor} !important;\n    border-radius: 6px;\n    cursor: pointer;\n    background: ${theme.bgTertiary} !important;\n    color: ${theme.textPrimary} !important;\n  `\n  button.title = ''\n\n  button.onclick = () => {\n    if (callbacks.onNewFile) {\n      callbacks.onNewFile()\n    }\n  }\n\n  return button\n}\n\n/**\n * Create sort select dropdown\n * @param callbacks - Callback functions\n * @returns Select element\n */\nfunction createSortSelect(callbacks: ToolbarCallbacks): HTMLElement {\n  const theme = getComfyTheme()\n  const sortSelect = document.createElement('select')\n  sortSelect.id = 'dm-sort-select'\n  sortSelect.className = 'dm-select comfy-btn'\n  sortSelect.style.cssText = `\n    padding: 8px 12px;\n    border: 1px solid ${theme.borderColor} !important;\n    border-radius: 6px;\n    font-size: 13px;\n    cursor: pointer;\n    background: ${theme.bgTertiary} !important;\n    color: ${theme.inputText} !important;\n  `\n\n  const sortOptions = [\n    { value: 'name', label: '' },\n    { value: 'size', label: '' },\n    { value: 'modified', label: '' },\n  ]\n\n  sortOptions.forEach((opt) => {\n    const option = document.createElement('option')\n    option.value = opt.value\n    option.textContent = opt.label\n    sortSelect.appendChild(option)\n  })\n\n  sortSelect.onchange = (e) => {\n    const value = (e.target as HTMLSelectElement).value\n    if (callbacks.onSortChange) {\n      callbacks.onSortChange(value)\n    }\n  }\n\n  return sortSelect\n}\n\n/**\n * Create settings button\n * @param callbacks - Callback functions\n * @returns Button element\n */\nfunction createSettingsButton(callbacks: ToolbarCallbacks): HTMLElement {\n  const { onSshConnect, onSshDisconnect } = callbacks\n  const theme = getComfyTheme()\n\n  const button = document.createElement('button')\n  button.className = 'comfy-btn'\n  button.id = 'dm-settings-btn'\n  button.innerHTML = '<i class=\"pi pi-cog\"></i>'\n  button.style.cssText = `\n    padding: 8px 12px;\n    border: 1px solid ${theme.borderColor} !important;\n    border-radius: 6px;\n    cursor: pointer;\n    background: ${theme.bgTertiary} !important;\n    color: ${theme.textPrimary} !important;\n  `\n  button.title = ''\n\n  button.onclick = async () => {\n    const { openSettingsPanel } = await import('./settings.js')\n    openSettingsPanel({\n      onConnect: (result: unknown) => {\n        const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })\n          ._remoteConnectionsState\n        state.active = result as RemoteConnection\n        try {\n          localStorage.setItem('comfyui_datamanager_last_connection', JSON.stringify(result))\n        } catch (err) {}\n        updateConnectionStatus()\n        // \n        const select = document.getElementById('dm-remote-select') as HTMLSelectElement\n        if (select) {\n          updateRemoteOptions(select, onSshConnect, onSshDisconnect)\n        }\n        if (onSshConnect) onSshConnect(result)\n      },\n      onDisconnect: async () => {\n        const state = (window as unknown as { _remoteConnectionsState: RemoteConnectionsState })\n          ._remoteConnectionsState\n        const conn = state.active\n        if (conn && conn.connection_id) {\n          try {\n            const { sshDisconnect } = await import('../../api/ssh.js')\n            await sshDisconnect(conn.connection_id)\n          } catch (e) {\n            console.log('[DataManager] SSH disconnect error:', e)\n          }\n        }\n        state.active = null\n        try {\n          localStorage.removeItem('comfyui_datamanager_last_connection')\n        } catch (err) {}\n        updateConnectionStatus()\n        // \n        const select = document.getElementById('dm-remote-select') as HTMLSelectElement\n        if (select) {\n          updateRemoteOptions(select, onSshConnect, onSshDisconnect)\n        }\n        if (onSshDisconnect) onSshDisconnect()\n      },\n    })\n  }\n\n  return button\n}\n\n/**\n * Create toolbar\n * @param callbacks - Callback functions\n * @returns Toolbar element\n */\nexport function createToolbar(callbacks: ToolbarCallbacks = {}): HTMLElement {\n  const theme = getComfyTheme()\n  const toolbar = document.createElement('div')\n  toolbar.className = 'dm-toolbar'\n  toolbar.style.cssText = `\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 10px 15px;\n    border-bottom: 1px solid ${theme.borderColor};\n    gap: 15px;\n  `\n\n  const leftSection = document.createElement('div')\n  leftSection.style.cssText =\n    'display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0;'\n\n  // Navigation buttons group\n  const navGroup = document.createElement('div')\n  navGroup.style.cssText = `\n    display: flex;\n    gap: 5px;\n  `\n\n  // Up button (navigate to parent directory)\n  const upBtn = document.createElement('button')\n  upBtn.id = 'dm-nav-up-btn'\n  upBtn.className = 'comfy-btn'\n  upBtn.innerHTML = '<i class=\"pi pi-arrow-up\"></i>'\n  upBtn.title = ''\n  upBtn.style.cssText = `\n    padding: 8px 12px;\n    border: 1px solid ${theme.borderColor} !important;\n    border-radius: 6px;\n    background: ${theme.bgTertiary} !important;\n    color: ${theme.textPrimary} !important;\n    cursor: pointer;\n  `\n  upBtn.onclick = () => import('./actions.js').then((m) => m.navigateUp())\n\n  // Home button (navigate to root directory)\n  const homeBtn = document.createElement('button')\n  homeBtn.id = 'dm-nav-home-btn'\n  homeBtn.className = 'comfy-btn'\n  homeBtn.innerHTML = '<i class=\"pi pi-home\"></i>'\n  homeBtn.title = ''\n  homeBtn.style.cssText = `\n    padding: 8px 12px;\n    border: 1px solid ${theme.borderColor} !important;\n    border-radius: 6px;\n    background: ${theme.bgTertiary} !important;\n    color: ${theme.textPrimary} !important;\n    cursor: pointer;\n  `\n  homeBtn.onclick = () => import('./actions.js').then((m) => m.navigateHome())\n\n  navGroup.appendChild(upBtn)\n  navGroup.appendChild(homeBtn)\n  leftSection.appendChild(navGroup)\n\n  // Path input\n  const pathInput = document.createElement('input')\n  pathInput.id = 'dm-path-input'\n  pathInput.type = 'text'\n  pathInput.className = 'dm-input'\n  pathInput.style.cssText = `\n    flex: 1;\n    min-width: 0;\n    padding: 8px 12px;\n    border: 1px solid ${theme.borderColor} !important;\n    border-radius: 6px;\n    font-size: 13px;\n    background: ${theme.bgTertiary} !important;\n    color: ${theme.inputText} !important;\n  `\n  pathInput.value = FileManagerState.currentPath || '.'\n  pathInput.onkeypress = (e) => {\n    if (e.key === 'Enter') {\n      const { loadDirectory } = require('./actions.js')\n      loadDirectory((e.target as HTMLInputElement).value)\n    }\n  }\n\n  leftSection.appendChild(pathInput)\n\n  // Sort select dropdown\n  leftSection.appendChild(createSortSelect(callbacks))\n\n  toolbar.appendChild(leftSection)\n\n  const rightSection = document.createElement('div')\n  rightSection.style.cssText = 'display: flex; align-items: center; gap: 10px;'\n\n  // View toggle button\n  const viewToggleBtn = document.createElement('button')\n  viewToggleBtn.id = 'dm-view-toggle-btn'\n  viewToggleBtn.className = 'comfy-btn'\n  viewToggleBtn.title = ''\n  viewToggleBtn.style.cssText = `\n    padding: 8px 12px;\n    border: 1px solid ${theme.borderColor} !important;\n    border-radius: 6px;\n    background: ${theme.bgTertiary} !important;\n    color: ${theme.textPrimary} !important;\n    cursor: pointer;\n  `\n\n  // Function to update view toggle button icon based on current mode\n  function updateViewToggleButton(): void {\n    const mode = FileManagerState.viewMode\n    viewToggleBtn.innerHTML =\n      mode === 'list'\n        ? '<i class=\"pi pi-th-large\"></i>' // Show grid icon, hint to switch to grid\n        : '<i class=\"pi pi-list\"></i>' // Show list icon, hint to switch to list\n  }\n\n  viewToggleBtn.onclick = async () => {\n    const newMode = FileManagerState.viewMode === 'list' ? 'grid' : 'list'\n    FileManagerState.viewMode = newMode\n\n    // Save view mode to localStorage\n    const { saveViewMode } = await import('../../core/state.js')\n    saveViewMode(newMode)\n\n    updateViewToggleButton()\n\n    // Update container CSS and header visibility\n    const container = document.getElementById('dm-file-list')\n    const browserPanel = document.getElementById('dm-browser-panel')\n\n    if (container) {\n      if (newMode === 'grid') {\n        // Grid view styles\n        container.style.cssText = `\n          flex: 1;\n          overflow-y: auto;\n          padding: 10px;\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));\n          gap: 10px;\n          align-content: start;\n          justify-content: start;\n        `\n        // Hide list header\n        const header = browserPanel?.querySelector('.dm-list-header') as HTMLElement\n        if (header) header.style.display = 'none'\n      } else {\n        // List view styles\n        container.style.cssText = `\n          flex: 1;\n          overflow-y: auto;\n          padding: 5px 0;\n        `\n        // Show list header\n        const header = browserPanel?.querySelector('.dm-list-header') as HTMLElement\n        if (header) header.style.display = 'flex'\n      }\n    }\n\n    // Re-render file list\n    const { loadDirectory } = await import('./actions.js')\n    await loadDirectory(FileManagerState.currentPath)\n  }\n\n  // Initialize button state\n  updateViewToggleButton()\n\n  rightSection.appendChild(viewToggleBtn)\n  rightSection.appendChild(createRemoteSelector(callbacks))\n  rightSection.appendChild(createSettingsButton(callbacks))\n  rightSection.appendChild(createNewButton(callbacks))\n\n  toolbar.appendChild(rightSection)\n\n  // Initialize connection status\n  setTimeout(() => updateConnectionStatus(), 100)\n\n  return toolbar\n}\n","/**\n * ComfyUI Data Manager - Constants Configuration\n */\n\n// ==================== API Endpoints ====================\n\nexport const API_ENDPOINTS = {\n  LIST: '/dm/list',\n  PREVIEW: '/dm/preview',\n  INFO: '/dm/info',\n  CREATE_FILE: '/dm/create/file',\n  CREATE_DIRECTORY: '/dm/create/directory',\n  DELETE: '/dm/delete',\n} as const\n\n// ==================== Limits ====================\n\nexport const LIMITS = {\n  // Table\n  MAX_PREVIEW_ROWS: 100,\n\n  // Code preview\n  MAX_CODE_LENGTH: 50000,\n\n  // Zoom\n  MIN_ZOOM: 0.1,\n  MAX_ZOOM: 5,\n  DEFAULT_ZOOM_STEP: 25,\n  MIN_ZOOM_DISPLAY: 25,\n  MAX_ZOOM_DISPLAY: 300,\n\n  // Font size\n  MIN_FONT_SIZE: 8,\n  MAX_FONT_SIZE: 32,\n\n  // Window\n  DEFAULT_WINDOW_WIDTH: 1200,\n  DEFAULT_WINDOW_HEIGHT: 700,\n  FLOATING_Z_INDEX: 10001,\n} as const\n\n// ==================== File Types ====================\n\nexport interface FileTypeConfig {\n  exts: string[]\n  icon: string\n  color: string\n}\n\nexport const FILE_TYPES: Record<string, FileTypeConfig> = {\n  image: {\n    exts: [\n      '.jpg',\n      '.jpeg',\n      '.png',\n      '.gif',\n      '.bmp',\n      '.webp',\n      '.svg',\n      '.ico',\n      '.tiff',\n      '.tif',\n      '.avif',\n      '.heic',\n      '.heif',\n      '.tga',\n    ],\n    icon: 'pi-image',\n    color: '#e74c3c',\n  },\n  video: {\n    exts: ['.mp4', '.webm', '.mov', '.mkv'],\n    icon: 'pi-video',\n    color: '#9b59b6',\n  },\n  videoExternal: {\n    exts: ['.avi'],\n    icon: 'pi-video',\n    color: '#8e44ad',\n  },\n  audio: {\n    exts: ['.mp3', '.wav', '.flac', '.aac', '.ogg', '.wma', '.m4a'],\n    icon: 'pi-volume-up',\n    color: '#3498db',\n  },\n  document: {\n    exts: ['.pdf', '.doc', '.docx', '.txt', '.rtf', '.md'],\n    icon: 'pi-file',\n    color: '#95a5a6',\n  },\n  spreadsheet: {\n    exts: ['.xls', '.xlsx', '.csv', '.ods'],\n    icon: 'pi-table',\n    color: '#27ae60',\n  },\n  archive: {\n    exts: ['.zip', '.rar', '.7z', '.tar', '.gz'],\n    icon: 'pi-box',\n    color: '#f39c12',\n  },\n  code: {\n    exts: ['.py', '.js', '.html', '.css', '.json', '.xml', '.yaml', '.yml', '.cpp', '.c', '.h'],\n    icon: 'pi-code',\n    color: '#1abc9c',\n  },\n  folder: {\n    exts: [], // Folders don't have extensions\n    icon: 'pi-folder',\n    color: '#f1c40f',\n  },\n  unknown: {\n    exts: [], // Unknown files don't have specific extensions\n    icon: 'pi-file',\n    color: '#7f8c8d',\n  },\n}\n","/**\n * ComfyUI Data Manager - File Type Detection Utilities\n */\n\nimport { FILE_TYPES } from '../core/constants.js'\n\n/**\n * Identify file type from file object\n * @param file - File object with name and is_dir properties\n * @returns File type key\n */\nexport function getFileType(file: { name?: string; path?: string; is_dir?: boolean }): string {\n  if (file.is_dir) return 'folder'\n  const ext = '.' + ((file.name || file.path || '').split('.').pop()?.toLowerCase() || '')\n  for (const [type, config] of Object.entries(FILE_TYPES)) {\n    if (config.exts && config.exts.includes(ext)) return type\n  }\n  return 'unknown'\n}\n\n/**\n * Get file type by extension\n * @param ext - File extension (with dot)\n * @returns File type key\n */\nexport function getTypeByExt(ext: string): string {\n  for (const [type, config] of Object.entries(FILE_TYPES)) {\n    if (config.exts && config.exts.includes(ext)) return type\n  }\n  return 'unknown'\n}\n","/**\n * ComfyUI Data Manager - Format Utilities\n */\n\n/**\n * Format file size to human readable string\n * @param bytes - Number of bytes\n * @returns Formatted size string\n */\nexport function formatSize(bytes: number): string {\n  if (!bytes) return ''\n  for (const unit of ['B', 'KB', 'MB', 'GB']) {\n    if (bytes < 1024) return bytes.toFixed(1) + ' ' + unit\n    bytes /= 1024\n  }\n  return bytes.toFixed(1) + ' TB'\n}\n\n/**\n * Format date to localized string\n * @param dateStr - Date string\n * @returns Formatted date string\n */\nexport function formatDate(dateStr: string): string {\n  if (!dateStr) return ''\n  const date = new Date(dateStr)\n  return date.toLocaleString('zh-CN', {\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n    hour: '2-digit',\n    minute: '2-digit',\n  })\n}\n\n/**\n * Escape HTML special characters\n * @param text - Raw text\n * @returns Escaped HTML string\n */\nexport function escapeHtml(text: string): string {\n  const div = document.createElement('div')\n  div.textContent = text\n  return div.innerHTML\n}\n","/**\n * ComfyUI Data Manager - Browser Panel Component\n */\n\nimport { FILE_TYPES } from '../../core/constants.js'\nimport { getFileType, getTypeByExt } from '../../utils/file-type.js'\nimport { formatDate, formatSize, escapeHtml } from '../../utils/format.js'\nimport { getComfyTheme } from '../../utils/theme.js'\nimport type { FileItem } from '../../core/state.js'\n\n/**\n * Create file browser panel\n * @param viewMode - View mode ('list' or 'grid')\n * @returns Panel element\n */\nexport function createBrowserPanel(viewMode: 'list' | 'grid' = 'list'): HTMLElement {\n  const theme = getComfyTheme()\n  const panel = document.createElement('div')\n  panel.id = 'dm-browser-panel'\n  panel.className = 'dm-browser-panel'\n  panel.style.cssText = `\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    border-right: 1px solid ${theme.borderColor};\n    overflow: hidden;\n  `\n\n  if (viewMode === 'list') {\n    panel.appendChild(createListHeader())\n  }\n\n  const content = document.createElement('div')\n  content.id = 'dm-file-list'\n  if (viewMode === 'grid') {\n    content.style.cssText = `\n      flex: 1;\n      overflow-y: auto;\n      padding: 10px;\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));\n      gap: 10px;\n      align-content: start;\n      justify-content: start;\n    `\n  } else {\n    content.style.cssText = `\n      flex: 1;\n      overflow-y: auto;\n      padding: 5px 0;\n    `\n  }\n  content.innerHTML = `\n    <div class=\"dm-browser-loading\" style=\"text-align: center; padding: 40px;\">\n      <i class=\"pi pi-spin pi-spinner\" style=\"font-size: 24px;\"></i>\n    </div>\n  `\n  panel.appendChild(content)\n\n  return panel\n}\n\n/**\n * Create list view header\n * @returns Header element\n */\nfunction createListHeader(): HTMLElement {\n  const theme = getComfyTheme()\n  const header = document.createElement('div')\n  header.className = 'dm-list-header'\n  header.style.cssText = `\n    display: flex;\n    padding: 10px 15px;\n    border-bottom: 1px solid ${theme.borderColor};\n    font-size: 12px;\n    font-weight: 600;\n  `\n\n  const createHeaderCell = (sortKey: string, label: string, width: string) => {\n    const cell = document.createElement('div')\n    cell.className = 'dm-header-cell'\n    cell.dataset.sort = sortKey\n    cell.style.cssText = `${width}; cursor: pointer; display: flex; align-items: center; gap: 5px; user-select: none;`\n    cell.innerHTML = `<span>${label}</span><i class=\"pi pi-sort\" style=\"font-size: 10px; opacity: 0.5;\"></i>`\n    cell.onclick = async () => {\n      const { toggleSort } = await import('../components/actions.js')\n      toggleSort(sortKey as 'name' | 'size' | 'modified')\n    }\n    return cell\n  }\n\n  header.appendChild(createHeaderCell('name', '', 'flex: 1;'))\n  header.appendChild(createHeaderCell('size', '', 'flex: 0 0 100px;'))\n  header.appendChild(createHeaderCell('modified', '', 'flex: 0 0 150px;'))\n\n  return header\n}\n\n/**\n * Create list item HTML\n * @param file - File object\n * @param isParent - Whether it's parent directory\n * @returns HTML string\n */\nexport function createFileListItem(file: FileItem, isParent: boolean): string {\n  const theme = getComfyTheme()\n  const fileType = getFileType(file)\n  const icon = FILE_TYPES[fileType]?.icon || FILE_TYPES.unknown.icon\n  const color = FILE_TYPES[fileType]?.color || FILE_TYPES.unknown.color\n\n  const size = file.is_dir ? '' : formatSize(file.size ?? 0) || ''\n  const modified = file.modified ? formatDate(String(file.modified)) : ''\n\n  return `\n    <div class=\"dm-file-item\" data-path=\"${escapeHtml(file.path || file.name)}\" data-is-dir=\"${file.is_dir || false}\"\n         style=\"display: flex; align-items: center; padding: 10px 15px;\n                border-bottom: 1px solid ${theme.borderColor}; cursor: pointer;\n                transition: background 0.2s;\">\n      <div style=\"flex: 1; display: flex; align-items: center; gap: 10px; overflow: hidden;\">\n        <i class=\"pi ${icon} dm-file-icon\" style=\"color: ${color}; font-size: 16px;\"></i>\n        <span class=\"dm-file-name\" style=\"font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${escapeHtml(file.name)}</span>\n      </div>\n      <div class=\"dm-file-size\" style=\"flex: 0 0 100px; font-size: 12px;\">${size}</div>\n      <div class=\"dm-file-modified\" style=\"flex: 0 0 150px; font-size: 12px;\">${modified}</div>\n    </div>\n  `\n}\n\n/**\n * Create grid item HTML\n * @param file - File object\n * @param isParent - Whether it's parent directory\n * @returns HTML string\n */\nexport function createFileGridItem(file: FileItem, isParent: boolean): string {\n  const theme = getComfyTheme()\n\n  // Parent directory uses special style\n  if (isParent) {\n    return `\n      <div class=\"dm-grid-item dm-grid-item-parent\" data-path=\"${file.path}\" data-is-dir=\"true\"\n           data-name=\"..\"\n           style=\"display: flex; flex-direction: column; align-items: center; justify-content: center;\n                  padding: 10px; min-height: 100px;\n                  border-radius: 8px; cursor: pointer;\n                  transition: all 0.2s; border: 2px dashed ${theme.borderColor}; box-sizing: border-box;\">\n        <i class=\"pi pi-folder-open dm-parent-icon\" style=\"font-size: 36px;\"></i>\n        <span class=\"dm-parent-text\" style=\"font-size: 11px; text-align: center;\n                      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\n                      width: 100%; margin-top: 6px; line-height: 1.3;\"></span>\n      </div>\n    `\n  }\n\n  const fileType = getFileType(file)\n  const icon = FILE_TYPES[fileType]?.icon || FILE_TYPES.unknown.icon\n  const color = FILE_TYPES[fileType]?.color || FILE_TYPES.unknown.color\n\n  // For image files, show actual thumbnail instead of icon\n  const filePath = file.path || file.name\n  if (fileType === 'image' && !file.is_dir && filePath) {\n    const thumbUrl = `/dm/preview?path=${encodeURIComponent(filePath)}`\n    return `\n      <div class=\"dm-grid-item dm-grid-item-image\" data-path=\"${escapeHtml(filePath)}\" data-is-dir=\"false\"\n           data-name=\"${escapeHtml(file.name)}\"\n           style=\"display: flex; flex-direction: column; align-items: center; justify-content: flex-start;\n                  padding: 8px; min-height: 100px;\n                  border-radius: 8px; cursor: pointer;\n                  transition: all 0.2s; border: 2px solid ${theme.borderColor}; box-sizing: border-box;\">\n        <div style=\"width: 100%; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; overflow: hidden; border-radius: 6px; background: ${theme.bgTertiary};\">\n          <img src=\"${thumbUrl}\" class=\"dm-grid-thumbnail\" alt=\"${escapeHtml(file.name)}\"\n               style=\"width: 100%; height: 100%; object-fit: cover;\"\n               onerror=\"this.style.display='none'; this.nextElementSibling.style.display='block';\">\n          <i class=\"pi ${icon} dm-grid-icon\" style=\"display: none; color: ${color}; font-size: 32px;\"></i>\n        </div>\n        <span class=\"dm-grid-filename\" style=\"font-size: 10px; text-align: center;\n                      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\n                      width: 100%; margin-top: 6px; line-height: 1.3;\">${escapeHtml(file.name)}</span>\n      </div>\n    `\n  }\n\n  return `\n    <div class=\"dm-grid-item\" data-path=\"${escapeHtml(filePath)}\" data-is-dir=\"${file.is_dir || false}\"\n         data-name=\"${escapeHtml(file.name)}\"\n         style=\"display: flex; flex-direction: column; align-items: center; justify-content: flex-start;\n                padding: 8px; min-height: 100px;\n                border-radius: 8px; cursor: pointer;\n                transition: all 0.2s; border: 2px solid ${theme.borderColor}; box-sizing: border-box;\">\n      <div style=\"width: 100%; aspect-ratio: 1; display: flex; align-items: center; justify-content: center;\">\n        <i class=\"pi ${icon} dm-grid-icon\" style=\"color: ${color}; font-size: 32px;\"></i>\n      </div>\n      <span class=\"dm-grid-filename\" style=\"font-size: 10px; text-align: center;\n                    overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\n                    width: 100%; margin-top: 6px; line-height: 1.3;\">${escapeHtml(file.name)}</span>\n    </div>\n  `\n}\n","/**\n * ComfyUI Data Manager - Format Selector Component\n */\n\nimport { getComfyTheme } from '../../utils/theme.js'\n\n/**\n * Format type map\n */\nexport const FORMAT_TYPE_MAP: Record<string, { type: string; label: string; description: string }> =\n  {\n    png: { type: 'IMAGE', label: 'PNG ', description: '' },\n    jpg: { type: 'IMAGE', label: 'JPEG ', description: '' },\n    webp: { type: 'IMAGE', label: 'WebP ', description: '' },\n    mp4: { type: 'VIDEO', label: 'MP4 ', description: '' },\n    webm: { type: 'VIDEO', label: 'WebM ', description: '' },\n    avi: { type: 'VIDEO', label: 'AVI ', description: '' },\n    mp3: { type: 'AUDIO', label: 'MP3 ', description: '' },\n    wav: { type: 'AUDIO', label: 'WAV ', description: '' },\n    flac: { type: 'AUDIO', label: 'FLAC ', description: '' },\n    ogg: { type: 'AUDIO', label: 'OGG ', description: '' },\n    latent: { type: 'LATENT', label: 'Latent', description: 'ComfyUI Latent ' },\n    json: { type: 'DATA', label: 'JSON', description: '' },\n    txt: { type: 'DATA', label: '', description: '' },\n  }\n\n/**\n * Type to formats mapping\n */\nexport const TYPE_FORMATS: Record<string, string[]> = {\n  IMAGE: ['png', 'jpg', 'webp'],\n  VIDEO: ['mp4', 'webm', 'avi'],\n  AUDIO: ['mp3', 'wav', 'flac', 'ogg'],\n  LATENT: ['latent'],\n  MASK: ['png'],\n  CONDITIONING: ['json'],\n  STRING: ['txt', 'json'],\n}\n\n/**\n * Format selector options\n */\nexport interface FormatSelectorOptions {\n  detectedType?: string | null\n  selectedFormat?: string | null\n  onFormatChange?: ((format: string) => void) | null\n  showTypeIndicator?: boolean\n  compact?: boolean\n}\n\n/**\n * Get formats for type (internal use)\n * @param type - Data type\n * @returns Array of format strings\n */\nfunction getFormatsForType(type: string): string[] {\n  const typeKey = type.toUpperCase()\n  return TYPE_FORMATS[typeKey] || ['json']\n}\n\n/**\n * Get type color\n * @param type - Data type\n * @returns Color string\n */\nfunction getTypeColor(type: string): string {\n  const colors: Record<string, string> = {\n    IMAGE: '#e74c3c',\n    VIDEO: '#9b59b6',\n    AUDIO: '#3498db',\n    LATENT: '#27ae60',\n    MASK: '#f39c12',\n    DATA: '#95a5a6',\n  }\n  return colors[type] || '#95a5a6'\n}\n\n/**\n * Get type icon\n * @param type - Data type\n * @returns Icon class name\n */\nfunction getTypeIcon(type: string): string {\n  const icons: Record<string, string> = {\n    IMAGE: 'pi-image',\n    VIDEO: 'pi-video',\n    AUDIO: 'pi-volume-up',\n    LATENT: 'pi-cube',\n    MASK: 'pi-mask',\n    DATA: 'pi-file',\n  }\n  return icons[type] || 'pi-file'\n}\n\n/**\n * Create format selector\n * @param options - Configuration options\n * @returns Format selector element\n */\nexport function createFormatSelector(options: FormatSelectorOptions = {}): HTMLElement {\n  const {\n    detectedType = null,\n    selectedFormat = null,\n    onFormatChange = null,\n    showTypeIndicator = true,\n    compact = false,\n  } = options\n\n  const theme = getComfyTheme()\n\n  const container = document.createElement('div')\n  container.className = 'dm-format-selector'\n  container.style.cssText = `\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    padding: 15px;\n    background: ${theme.bgSecondary};\n    border-radius: 8px;\n    border: 1px solid ${theme.borderColor};\n  `\n\n  // Type indicator\n  if (showTypeIndicator && detectedType) {\n    const typeIndicator = document.createElement('div')\n    typeIndicator.className = 'dm-type-indicator'\n    const typeColor = getTypeColor(detectedType)\n    typeIndicator.style.cssText = `\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px 12px;\n      background: ${typeColor}20;\n      border-left: 3px solid ${typeColor};\n      border-radius: 4px;\n      font-size: 12px;\n      color: ${typeColor};\n    `\n    typeIndicator.innerHTML = `\n      <i class=\"pi ${getTypeIcon(detectedType)}\"></i>\n      <span style=\"font-weight: 600;\">${detectedType}</span>\n      <span style=\"color: ${theme.textSecondary};\"></span>\n    `\n    container.appendChild(typeIndicator)\n  }\n\n  // Format selection area\n  const formatSection = document.createElement('div')\n  formatSection.style.cssText = `\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n  `\n\n  const label = document.createElement('label')\n  label.style.cssText = `\n    font-size: 12px;\n    color: ${theme.textSecondary};\n    font-weight: 500;\n  `\n  label.textContent = ':'\n  formatSection.appendChild(label)\n\n  const formats = detectedType ? getFormatsForType(detectedType) : Object.keys(FORMAT_TYPE_MAP)\n  const defaultFormat = selectedFormat || (detectedType ? formats[0] : 'png')\n\n  if (compact) {\n    // Compact mode: use dropdown\n    const select = document.createElement('select')\n    select.id = 'dm-format-select'\n    select.className = 'comfy-combo'\n    select.style.cssText = `\n      width: 100%;\n      padding: 8px 12px;\n      background: ${theme.bgTertiary};\n      border: 1px solid ${theme.borderColor};\n      border-radius: 6px;\n      color: ${theme.inputText};\n      font-size: 13px;\n      cursor: pointer;\n    `\n    formats.forEach((fmt) => {\n      const option = document.createElement('option')\n      option.value = fmt\n      option.textContent = fmt.toUpperCase()\n      if (fmt === defaultFormat) option.selected = true\n      select.appendChild(option)\n    })\n    select.onchange = (e) => {\n      if (onFormatChange) {\n        onFormatChange((e.target as HTMLSelectElement).value)\n      }\n      updateFormatDescription((e.target as HTMLSelectElement).value)\n    }\n    formatSection.appendChild(select)\n  } else {\n    // Full mode: use button group\n    const buttonGroup = document.createElement('div')\n    buttonGroup.style.cssText = `\n      display: flex;\n      flex-wrap: wrap;\n      gap: 6px;\n    `\n    buttonGroup.id = 'dm-format-buttons'\n\n    formats.forEach((fmt) => {\n      const btn = document.createElement('button')\n      btn.className = 'comfy-btn dm-format-btn'\n      btn.dataset.format = fmt\n      const isSelected = fmt === defaultFormat\n      btn.style.cssText = `\n        padding: 8px 16px;\n        background: ${isSelected ? theme.bgTertiary : theme.bgTertiary};\n        border: 1px solid ${isSelected ? theme.accentColor : theme.borderColor};\n        border-radius: 6px;\n        color: ${isSelected ? theme.accentColor : theme.textPrimary};\n        font-size: 12px;\n        font-weight: ${isSelected ? '600' : '400'};\n        cursor: pointer;\n        transition: all 0.2s;\n      `\n      btn.textContent = fmt.toUpperCase()\n      btn.onclick = () => {\n        // Update all button states\n        buttonGroup.querySelectorAll('.dm-format-btn').forEach((b) => {\n          const btnEl = b as HTMLElement\n          btnEl.style.background = theme.bgTertiary\n          btnEl.style.borderColor = theme.borderColor\n          btnEl.style.color = theme.textPrimary\n          btnEl.style.fontWeight = '400'\n        })\n        // Activate current button\n        btn.style.background = theme.bgTertiary\n        btn.style.borderColor = theme.accentColor\n        btn.style.color = theme.accentColor\n        btn.style.fontWeight = '600'\n        if (onFormatChange) {\n          onFormatChange(fmt)\n        }\n        updateFormatDescription(fmt)\n      }\n      buttonGroup.appendChild(btn)\n    })\n    formatSection.appendChild(buttonGroup)\n  }\n\n  container.appendChild(formatSection)\n\n  // Format description\n  const description = document.createElement('div')\n  description.id = 'dm-format-description'\n  description.style.cssText = `\n    font-size: 11px;\n    color: ${theme.textSecondary};\n    padding: 8px 12px;\n    background: ${theme.bgPrimary};\n    border-radius: 4px;\n  `\n  description.textContent = FORMAT_TYPE_MAP[defaultFormat]?.description || ''\n  container.appendChild(description)\n\n  // Initialize format description\n  updateFormatDescription(defaultFormat)\n\n  return container\n}\n\n/**\n * Update format description\n * @param format - Format string\n */\nfunction updateFormatDescription(format: string): void {\n  const descriptionEl = document.getElementById('dm-format-description')\n  if (descriptionEl) {\n    ;(descriptionEl as HTMLElement).textContent = FORMAT_TYPE_MAP[format]?.description || ''\n  }\n}\n","/**\n * ComfyUI Data Manager - Preview Panel Component\n */\n\nimport { createFormatSelector, type FormatSelectorOptions } from './format-selector.js'\nimport { getComfyTheme } from '../../utils/theme.js'\nimport { FileManagerState } from '../../core/state.js'\n\n// ==================== Constants ====================\nconst DEFAULT_DETECTED_TYPE = 'IMAGE'\n\n/**\n * Preview panel callbacks\n */\nexport interface PreviewCallbacks {\n  onOpenFloating?: () => void\n  onCopyPath?: () => void\n  onDelete?: () => void\n}\n\n/**\n * Check node connection and update format selector\n */\nexport function checkNodeConnectionAndUpdateFormat(): void {\n  try {\n    const app = (\n      window as unknown as {\n        app?: { graph?: { _nodes?: unknown[]; getNodeById?: (id: number) => unknown } }\n      }\n    ).app\n    const nodes = app?.graph?._nodes || []\n    const inputPathConfigNodes = nodes.filter(\n      (n: unknown) => (n as { comfyClass?: string }).comfyClass === 'InputPathConfig'\n    )\n\n    if (inputPathConfigNodes.length === 0) {\n      return\n    }\n\n    const node = inputPathConfigNodes[0] as {\n      inputs?: Array<{ name?: string; link?: { origin_id?: number } }>\n    }\n    const inputs = node.inputs || []\n    const fileInput = inputs.find((i: { name?: string }) => i.name === 'file_input')\n\n    if (fileInput && fileInput.link) {\n      const sourceNodeId = fileInput.link.origin_id\n      const sourceNode =\n        sourceNodeId !== undefined ? app?.graph?.getNodeById?.(sourceNodeId) : undefined\n      if (sourceNode) {\n        const detectedType = detectTypeFromSourceNode(sourceNode)\n        updateFormatSelector(detectedType, null, null)\n      }\n    }\n  } catch (e) {\n    console.log('[DataManager] Error checking node connection:', e)\n  }\n}\n\n/**\n * Detect data type from node type\n * @param node - Source node\n * @returns Detected type string\n */\nfunction detectTypeFromSourceNode(node: {\n  type?: string\n  comfyClass?: string\n  outputs?: Array<{ type?: string }>\n}): string {\n  const nodeType = node.type || node.comfyClass || ''\n\n  // Type mapping\n  const typeMapping: Record<string, string> = {\n    LoadImage: 'IMAGE',\n    LoadVideo: 'VIDEO',\n    LoadAudio: 'AUDIO',\n    EmptyLatentImage: 'LATENT',\n    VAEDecode: 'IMAGE',\n    CheckpointLoaderSimple: 'MODEL',\n  }\n\n  // Check output port types\n  if (node.outputs && node.outputs.length > 0) {\n    for (const output of node.outputs) {\n      if (output.type === 'IMAGE') return 'IMAGE'\n      if (output.type === 'LATENT') return 'LATENT'\n      if (output.type === 'MASK') return 'MASK'\n      if (output.type === 'VIDEO') return 'VIDEO'\n      if (output.type === 'AUDIO') return 'AUDIO'\n      if (output.type === 'MODEL') return 'MODEL'\n      if (output.type === 'VAE') return 'VAE'\n      if (output.type === 'CLIP') return 'CLIP'\n    }\n  }\n\n  // Use node type mapping\n  for (const [key, value] of Object.entries(typeMapping)) {\n    if (nodeType.includes(key)) {\n      return value\n    }\n  }\n\n  return DEFAULT_DETECTED_TYPE\n}\n\n/**\n * Create preview panel\n * @param callbacks - Callback functions\n * @returns Panel element\n */\nexport function createPreviewPanel(callbacks: PreviewCallbacks = {}): HTMLElement {\n  const { onOpenFloating, onCopyPath, onDelete } = callbacks\n  const theme = getComfyTheme()\n\n  const panel = document.createElement('div')\n  panel.id = 'dm-preview-panel'\n  panel.style.cssText = `\n    flex: 0 0 400px;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n  `\n\n  const header = document.createElement('div')\n  header.className = 'dm-preview-header'\n  header.style.cssText = `\n    padding: 15px;\n    border-bottom: 1px solid ${theme.borderColor};\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: 10px;\n  `\n  header.innerHTML = `\n    <h3 class=\"dm-title\" style=\"margin: 0; font-size: 14px;\">\n      <i class=\"pi pi-eye\"></i> \n    </h3>\n    <div style=\"display: flex; gap: 5px;\">\n      <button id=\"dm-copy-path-btn\" class=\"comfy-btn dm-icon-btn\" disabled style=\"padding: 6px 12px; font-size: 12px; opacity: 0.5; cursor: not-allowed;\" title=\"\">\n        <i class=\"pi pi-copy\"></i>\n      </button>\n      <button id=\"dm-delete-file-btn\" class=\"comfy-btn dm-icon-btn\" style=\"padding: 6px 12px; font-size: 12px;\">\n        <i class=\"pi pi-trash\"></i>\n      </button>\n      <button id=\"dm-open-floating-preview-btn\" class=\"comfy-btn dm-icon-btn\" style=\"display: none; padding: 6px 12px; font-size: 12px;\">\n        <i class=\"pi pi-window-maximize\"></i>\n      </button>\n    </div>\n  `\n  panel.appendChild(header)\n\n  const content = document.createElement('div')\n  content.id = 'dm-preview-content'\n  content.style.cssText = `\n    flex: 1;\n    overflow-y: auto;\n    padding: 15px;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n  `\n  content.innerHTML = `\n    <div style=\"text-align: center; padding: 40px; color: ${theme.textSecondary};\">\n      <i class=\"pi pi-file\" style=\"font-size: 48px; opacity: 0.5;\"></i>\n      <div style=\"margin-top: 15px; font-size: 13px;\"></div>\n    </div>\n  `\n  panel.appendChild(content)\n\n  // Format selector area\n  const formatSection = document.createElement('div')\n  formatSection.id = 'dm-format-section'\n  formatSection.style.cssText = `\n    padding: 15px;\n    background: ${theme.bgTertiary};\n    border-top: 1px solid ${theme.borderColor};\n    display: none;\n  `\n  formatSection.innerHTML = `\n    <div style=\"text-align: center; padding: 20px; color: ${theme.textSecondary};\">\n      <i class=\"pi pi-cog\" style=\"font-size: 32px; opacity: 0.5;\"></i>\n      <div style=\"margin-top: 10px; font-size: 12px;\"></div>\n    </div>\n  `\n  panel.appendChild(formatSection)\n\n  // File info area\n  const infoSection = document.createElement('div')\n  infoSection.id = 'dm-file-info'\n  infoSection.style.cssText = `\n    padding: 15px;\n    background: ${theme.bgSecondary};\n    border-top: 1px solid ${theme.borderColor};\n    font-size: 12px;\n    color: ${theme.textSecondary};\n  `\n  infoSection.innerHTML = '<div style=\"text-align: center;\">No file selected</div>'\n  panel.appendChild(infoSection)\n\n  // Bind button events\n  const floatingBtn = header.querySelector('#dm-open-floating-preview-btn') as HTMLButtonElement\n  const copyPathBtn = header.querySelector('#dm-copy-path-btn') as HTMLButtonElement\n  const deleteBtn = header.querySelector('#dm-delete-file-btn') as HTMLButtonElement\n\n  if (floatingBtn && onOpenFloating) {\n    floatingBtn.onclick = onOpenFloating\n  }\n  if (copyPathBtn && onCopyPath) {\n    copyPathBtn.onclick = onCopyPath\n  }\n  if (deleteBtn && onDelete) {\n    deleteBtn.onclick = onDelete\n  }\n\n  return panel\n}\n\n/**\n * Update format selector\n * @param detectedType - Detected type\n * @param currentFormat - Current format\n * @param onFormatChange - Format change callback\n */\nexport function updateFormatSelector(\n  detectedType: string | null,\n  currentFormat: string | null = null,\n  onFormatChange: ((format: string) => void) | null = null\n): void {\n  const formatSection = document.getElementById('dm-format-section')\n  if (!formatSection) return\n\n  formatSection.innerHTML = ''\n\n  if (!detectedType) {\n    formatSection.style.display = 'none'\n    return\n  }\n\n  formatSection.style.display = 'block'\n\n  const selector = createFormatSelector({\n    detectedType: detectedType,\n    selectedFormat: currentFormat,\n    onFormatChange: onFormatChange,\n    compact: true,\n  })\n\n  formatSection.appendChild(selector)\n}\n\n/**\n * Hide format selector\n */\nexport function hideFormatSelector(): void {\n  const formatSection = document.getElementById('dm-format-section')\n  if (formatSection) {\n    formatSection.style.display = 'none'\n  }\n}\n\n/**\n * Create status bar\n * @returns Status bar element\n */\nexport function createStatusBar(): HTMLElement {\n  const theme = getComfyTheme()\n  // Create bottom area container (contains Dock and status bar)\n  const bottomArea = document.createElement('div')\n  bottomArea.className = 'dm-bottom-area'\n  bottomArea.style.cssText = `\n    display: flex;\n    flex-direction: column;\n  `\n\n  // Create Dock\n  const dock = document.createElement('div')\n  dock.id = 'dm-preview-dock'\n  dock.className = 'dm-preview-dock'\n  dock.style.cssText = `\n    min-height: 0;\n    max-height: 0;\n    padding: 0 15px;\n    background: ${theme.bgPrimary};\n    border-top: 0.8px solid ${theme.borderColor};\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    overflow-x: auto;\n    overflow-y: hidden;\n    transition: min-height 0.3s ease, max-height 0.3s ease, padding 0.3s ease;\n  `\n\n  // Create status bar\n  const bar = document.createElement('div')\n  bar.id = 'dm-status-bar'\n  bar.style.cssText = `\n    padding: 8px 16px;\n    font-size: 12px;\n    color: ${theme.textSecondary};\n    background: transparent;\n    border-top: 0.8px solid ${theme.borderColor};\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  `\n  bar.innerHTML = `\n    <div id=\"dm-connection-status\" style=\"color: ${theme.successColor};\"></div>\n    <div style=\"display: flex; align-items: center; gap: 10px;\">\n      <span id=\"dm-status-ready\"></span>\n      <div id=\"dm-connection-indicator\" style=\"width: 8px; height: 8px; border-radius: 50%; background: ${theme.textSecondary}; transition: background 0.3s ease;\"></div>\n    </div>\n  `\n\n  bottomArea.appendChild(dock)\n  bottomArea.appendChild(bar)\n\n  // Delay update connection status\n  setTimeout(() => {\n    const currentTheme = getComfyTheme()\n    const indicator = document.getElementById('dm-connection-indicator')\n    const statusText = document.getElementById('dm-connection-status')\n    const state = (window as unknown as { _remoteConnectionsState: { active: unknown } })\n      ._remoteConnectionsState\n    const active = state?.active\n    if (indicator) {\n      ;(indicator as HTMLElement).style.background = active\n        ? currentTheme.successColor\n        : currentTheme.textSecondary\n    }\n    if (statusText && active) {\n      const conn = active as { username?: string; host?: string }\n      statusText.textContent = `SSH: ${conn.username}@${conn.host}`\n    }\n  }, 100)\n\n  return bottomArea\n}\n","/**\n * ComfyUI Data Manager - Drag Utilities\n */\n\n/**\n * Setup window drag functionality\n * Adds event listeners dynamically on drag start, removes on drag end\n * @param windowEl - Window element\n * @param header - Header element (drag handle area)\n */\nexport function setupWindowDrag(windowEl: HTMLElement, header: HTMLElement): void {\n  // Disable native drag to prevent ghost image\n  windowEl.draggable = false\n  header.draggable = false\n\n  // Prevent native drag events\n  windowEl.addEventListener('dragstart', (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n    return false\n  })\n\n  header.addEventListener('mousedown', (e) => {\n    // Exclude buttons and icons\n    if (\n      (e.target && (e.target as HTMLElement).tagName === 'BUTTON') ||\n      (e.target as HTMLElement).tagName === 'I'\n    )\n      return\n\n    // Don't allow dragging when fullscreen\n    if (windowEl.dataset.fullscreen === 'true') return\n\n    // Prevent default behavior (including native drag)\n    e.preventDefault()\n\n    const rect = windowEl.getBoundingClientRect()\n    const offsetX = e.clientX - rect.left\n    const offsetY = e.clientY - rect.top\n\n    // Remove transition for performance\n    windowEl.style.transition = 'none'\n\n    // Clear transform, use left/top positioning\n    windowEl.style.transform = 'none'\n    windowEl.style.left = rect.left + 'px'\n    windowEl.style.top = rect.top + 'px'\n\n    // Mark as dragging\n    ;(windowEl as unknown as { _isDragging: boolean })._isDragging = true\n\n    // Define mousemove handler\n    const mouseMoveHandler = (e: MouseEvent) => {\n      if (!(windowEl as unknown as { _isDragging: boolean })._isDragging) return\n      const x = e.clientX - offsetX\n      const y = e.clientY - offsetY\n      windowEl.style.left = Math.max(0, x) + 'px'\n      windowEl.style.top = Math.max(0, y) + 'px'\n    }\n\n    // Define mouseup handler\n    const mouseUpHandler = () => {\n      // Restore transition\n      windowEl.style.transition = ''\n\n      // Clear dragging flag\n      ;(windowEl as unknown as { _isDragging: boolean })._isDragging = false\n\n      // Immediately remove listeners\n      document.removeEventListener('mousemove', mouseMoveHandler)\n      document.removeEventListener('mouseup', mouseUpHandler)\n    }\n\n    // Add listeners to document (ensure response even when mouse leaves window)\n    document.addEventListener('mousemove', mouseMoveHandler)\n    document.addEventListener('mouseup', mouseUpHandler)\n  })\n}\n\n/**\n * Cleanup window drag state\n * @param windowEl - Window element\n */\nexport function cleanupWindowDrag(windowEl: HTMLElement): void {\n  if ((windowEl as unknown as { _isDragging?: boolean })._isDragging) {\n    ;(windowEl as unknown as { _isDragging: boolean })._isDragging = false\n    windowEl.style.transition = ''\n  }\n}\n","/**\n * ComfyUI Data Manager - Main File Manager Window\n */\n\nimport { createHeader } from './components/header.js'\nimport { createToolbar, type ToolbarCallbacks } from './components/toolbar.js'\nimport { createBrowserPanel } from './components/browser.js'\nimport { createPreviewPanel, createStatusBar, type PreviewCallbacks } from './components/preview.js'\nimport { loadDirectory } from './components/actions.js'\nimport { setupWindowDrag } from '../utils/drag.js'\nimport { FileManagerState } from '../core/state.js'\nimport { getComfyTheme } from '../utils/theme.js'\n\n// Keyboard event handler reference\nlet keydownHandler: ((e: KeyboardEvent) => void) | null = null\n\n/**\n * Window callbacks\n */\nexport interface WindowManagerCallbacks extends ToolbarCallbacks, PreviewCallbacks {\n  onClose?: () => void\n  onRefresh?: () => void\n  onOpenFloating?: () => void\n  onCopyPath?: () => void\n  onDelete?: () => void\n}\n\n/**\n * Create file manager window\n * @param callbacks - Callback functions object\n * @returns Window element\n */\nexport function createFileManagerWindow(callbacks: WindowManagerCallbacks = {}): HTMLElement {\n  const theme = getComfyTheme()\n  const window = document.createElement('div')\n  window.id = 'dm-file-manager'\n  window.style.cssText = `\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 1200px;\n    height: 700px;\n    max-width: calc(100vw - 40px);\n    max-height: calc(100vh - 40px);\n    background: ${theme.bgPrimary};\n    border: 0.8px solid ${theme.borderColor};\n    border-radius: 8px;\n    box-shadow: rgba(0, 0, 0, 0.4) 1px 1px 8px 0px;\n    z-index: 10000;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    font-family: Inter, Arial, sans-serif;\n  `\n\n  // Create toast notification container (positioned above all content)\n  const toastContainer = document.createElement('div')\n  toastContainer.id = 'dm-toast-container'\n  toastContainer.style.cssText = `\n    position: absolute;\n    top: 60px;\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 10001;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    pointer-events: none;\n  `\n  window.appendChild(toastContainer)\n\n  // Assemble window\n  window.appendChild(\n    createHeader({\n      title: 'Data Manager',\n      icon: 'pi-folder-open',\n      onClose: callbacks.onClose,\n      onRefresh: callbacks.onRefresh,\n    })\n  )\n  window.appendChild(createToolbar(callbacks))\n  window.appendChild(createMainContent(callbacks))\n  window.appendChild(createStatusBar())\n\n  document.body.appendChild(window)\n\n  // Setup drag\n  const header = window.querySelector('.dm-header') as HTMLElement\n  setupWindowDrag(window, header)\n\n  // Add keyboard event listener (ESC to close)\n  keydownHandler = (e: KeyboardEvent) => {\n    if (e.key === 'Escape') {\n      e.preventDefault()\n      e.stopPropagation()\n      if (callbacks.onClose) callbacks.onClose()\n    }\n  }\n  document.addEventListener('keydown', keydownHandler, { capture: true })\n\n  return window\n}\n\n/**\n * Destroy window (cleanup event listeners)\n */\nexport function destroyFileManagerWindow(): void {\n  // Remove keyboard event listener\n  if (keydownHandler) {\n    document.removeEventListener('keydown', keydownHandler, { capture: true })\n    keydownHandler = null\n  }\n\n  // Remove window element\n  const window = document.getElementById('dm-file-manager')\n  if (window) {\n    window.remove()\n  }\n}\n\n/**\n * Create main content area\n * @param callbacks - Callback functions object\n * @returns Main content element\n */\nfunction createMainContent(callbacks: WindowManagerCallbacks): HTMLElement {\n  const mainContent = document.createElement('div')\n  mainContent.style.cssText = 'flex: 1; display: flex; overflow: hidden;'\n\n  const browserPanel = createBrowserPanel(FileManagerState.viewMode)\n  mainContent.appendChild(browserPanel)\n\n  const previewPanel = createPreviewPanel({\n    onOpenFloating: callbacks.onOpenFloating,\n    onCopyPath: callbacks.onCopyPath,\n    onDelete: callbacks.onDelete,\n  })\n  mainContent.appendChild(previewPanel)\n\n  return mainContent\n}\n","/**\n * ComfyUI Data Manager - File API Endpoints\n */\n\nimport { API_ENDPOINTS } from '../../core/constants.js'\n\n/**\n * Directory listing response\n */\nexport interface DirectoryListResponse {\n  files: unknown[]\n  path: string\n}\n\n/**\n * File info response\n */\nexport interface FileInfo {\n  path: string\n  name: string\n  size: number\n  modified: number\n  isDir: boolean\n  type?: string\n}\n\n/**\n * Create file/directory response\n */\nexport interface CreateResponse {\n  success: boolean\n  path?: string\n  error?: string\n  message?: string\n}\n\n/**\n * List directory contents\n * @param path - Directory path\n * @returns Directory data\n */\nexport async function listDirectory(path: string): Promise<DirectoryListResponse> {\n  const response = await fetch(API_ENDPOINTS.LIST, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ path }),\n  })\n\n  if (response?.ok) {\n    return (await response.json()) as DirectoryListResponse\n  }\n\n  const errorData = (await response.json().catch(() => ({}))) as Record<string, unknown>\n  const errorMsg =\n    (errorData.error as string) || (errorData.message as string) || `HTTP ${response.status}`\n  throw new Error(`Failed to list directory: ${errorMsg}`)\n}\n\n/**\n * Get file preview URL\n * @param path - File path\n * @returns Preview URL\n */\nexport function getPreviewUrl(path: string): string {\n  return `${API_ENDPOINTS.PREVIEW}?path=${encodeURIComponent(path)}`\n}\n\n/**\n * Get file information\n * @param path - File path\n * @returns File info object\n */\nexport async function getFileInfo(path: string): Promise<FileInfo> {\n  const response = await fetch(API_ENDPOINTS.INFO, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ path }),\n  })\n\n  if (response?.ok) {\n    const data = (await response.json()) as { info: FileInfo }\n    return data.info\n  }\n\n  const errorData = (await response.json().catch(() => ({}))) as Record<string, unknown>\n  const errorMsg =\n    (errorData.error as string) || (errorData.message as string) || `HTTP ${response.status}`\n  throw new Error(`Failed to get file info: ${errorMsg}`)\n}\n\n/**\n * Create new file\n * @param directory - Target directory\n * @param filename - File name\n * @param content - File content (default empty)\n * @returns Creation result\n */\nexport async function createFile(\n  directory: string,\n  filename: string,\n  content = ''\n): Promise<CreateResponse> {\n  const response = await fetch(API_ENDPOINTS.CREATE_FILE, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ directory, filename, content }),\n  })\n\n  if (response?.ok) {\n    return (await response.json()) as CreateResponse\n  }\n\n  const error = (await response.json().catch(() => ({ error: 'Unknown error' }))) as CreateResponse\n  throw new Error(error.error || error.message || 'Failed to create file')\n}\n\n/**\n * Create new directory\n * @param directory - Parent directory\n * @param dirname - Directory name\n * @returns Creation result\n */\nexport async function createDirectory(directory: string, dirname: string): Promise<CreateResponse> {\n  const response = await fetch(API_ENDPOINTS.CREATE_DIRECTORY, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ directory, dirname }),\n  })\n\n  if (response?.ok) {\n    return (await response.json()) as CreateResponse\n  }\n\n  const error = (await response.json().catch(() => ({ error: 'Unknown error' }))) as CreateResponse\n  throw new Error(error.error || error.message || 'Failed to create directory')\n}\n\n/**\n * Delete file or directory\n * @param path - File or directory path\n * @param useTrash - Move to trash (default true)\n * @returns Deletion result\n */\nexport async function deleteFile(\n  path: string,\n  useTrash = true\n): Promise<{ success: boolean; error?: string }> {\n  const response = await fetch(API_ENDPOINTS.DELETE, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ path, use_trash: useTrash }),\n  })\n\n  if (response?.ok) {\n    return (await response.json()) as { success: boolean }\n  }\n\n  const error = (await response.json().catch(() => ({ error: 'Unknown error' }))) as {\n    error?: string\n  }\n  throw new Error(error.error || 'Failed to delete file')\n}\n","/**\n * ComfyUI Data Manager - Helper Utilities\n */\n\nimport { getComfyTheme } from './theme.js'\n\n// ComfyUI app import (external)\ndeclare const app: {\n  extensionManager?: {\n    toast?: {\n      add: (options: { severity: string; summary: string; detail: string; life?: number }) => void\n    }\n  }\n}\n\n/**\n * Update status bar text\n * @param text - Status text\n */\nexport function updateStatus(text: string): void {\n  const statusBar = document.getElementById('dm-status-bar')\n  if (statusBar) {\n    statusBar.textContent = text\n  }\n}\n\n/**\n * Show toast notification\n * @param severity - Severity level (info, success, warn, error)\n * @param summary - Title\n * @param detail - Detail message\n */\nexport function showToast(severity: string, summary: string, detail: string): void {\n  // Always try to use internal Data Manager toast first (when window is open)\n  const toastContainer = document.getElementById('dm-toast-container')\n  if (toastContainer) {\n    showInternalToast(severity, summary, detail)\n    // IMPORTANT: Return early to prevent ComfyUI toast from showing\n    return\n  }\n\n  // Only use ComfyUI toast if Data Manager window is not open\n  if (typeof app !== 'undefined' && app.extensionManager?.toast) {\n    app.extensionManager.toast.add({\n      severity,\n      summary,\n      detail,\n      life: 3000,\n    })\n  } else {\n    console.log(`[${severity.toUpperCase()}] ${summary}: ${detail}`)\n  }\n}\n\n/**\n * Show internal toast notification inside Data Manager window\n * @param severity - Severity level (info, success, warn, error)\n * @param summary - Title\n * @param detail - Detail message\n */\nfunction showInternalToast(severity: string, summary: string, detail: string): void {\n  const toastContainer = document.getElementById('dm-toast-container')\n  if (!toastContainer) return\n\n  const theme = getComfyTheme()\n\n  // ComfyUI-style colors using theme system\n  const colors: Record<string, { bg: string; icon: string }> = {\n    success: { bg: theme.successColor, icon: 'pi-check-circle' },\n    error: { bg: theme.errorColor, icon: 'pi-exclamation-circle' },\n    warn: { bg: '#f39c12', icon: 'pi-exclamation-triangle' },\n    info: { bg: theme.bgTertiary, icon: 'pi-info-circle' },\n  }\n\n  const color = colors[severity] || colors.info\n\n  const toast = document.createElement('div')\n  toast.style.cssText = `\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 12px 20px;\n    background: ${color.bg};\n    color: ${theme.textPrimary};\n    border: 1px solid ${theme.borderColor};\n    border-radius: 8px;\n    box-shadow: rgba(0, 0, 0, 0.3) 0 4px 12px 0;\n    font-size: 13px;\n    min-width: 280px;\n    max-width: 400px;\n    animation: dmSlideIn 0.3s ease-out;\n    pointer-events: auto;\n  `\n  toast.innerHTML = `\n    <i class=\"pi ${color.icon}\" style=\"font-size: 18px;\"></i>\n    <div style=\"flex: 1;\">\n      <div style=\"font-weight: 600; margin-bottom: 2px;\">${summary}</div>\n      <div style=\"opacity: 0.9; font-size: 12px;\">${detail}</div>\n    </div>\n  `\n\n  toastContainer.appendChild(toast)\n\n  // Auto remove after 3 seconds\n  setTimeout(() => {\n    toast.style.opacity = '0'\n    toast.style.transform = 'translateY(-10px)'\n    toast.style.transition = 'all 0.3s ease-in'\n    setTimeout(() => toast.remove(), 300)\n  }, 3000)\n}\n\n/**\n * Get parent directory path\n * @param path - Current path\n * @returns Parent path\n */\nexport function getParentPath(path: string): string {\n  const normalized = path.replace(/\\\\/g, '/')\n  const lastSlash = normalized.lastIndexOf('/')\n  if (lastSlash <= 0) return '.'\n  return normalized.substring(0, lastSlash)\n}\n\n/**\n * Extract filename from path\n * @param path - File path\n * @returns Filename\n */\nexport function getFileName(path: string): string {\n  return path.split(/[/\\\\]/).pop() || ''\n}\n\n/**\n * Extract file extension from path\n * @param path - File path\n * @returns Extension with dot\n */\nexport function getExt(path: string): string {\n  const parts = path.split('.')\n  const ext = parts.pop()?.toLowerCase() || ''\n  return '.' + ext\n}\n","/**\n * ComfyUI Data Manager - Actions Component\n */\n\nimport { listDirectory } from '../../api/endpoints/file.js'\nimport { FileManagerState, saveLastPath, type FileItem } from '../../core/state.js'\nimport { updateStatus, showToast, getParentPath } from '../../utils/helpers.js'\nimport { createFileListItem, createFileGridItem } from './browser.js'\nimport { getComfyTheme } from '../../utils/theme.js'\nimport type { SortBy } from '../../core/types.js'\n\n/**\n * Load directory\n * @param path - Directory path\n */\nexport async function loadDirectory(path: string): Promise<void> {\n  // Check for active SSH connection\n  const remoteConn = (window as unknown as { _remoteConnectionsState: { active: unknown } })\n    ._remoteConnectionsState?.active\n  if (remoteConn) {\n    await loadRemoteDirectory(path, remoteConn as { connection_id: string; root_path?: string })\n    return\n  }\n\n  updateStatus(`: ${path}...`)\n\n  try {\n    const data = await listDirectory(path)\n    FileManagerState.files = (data.files as FileItem[]) || []\n    FileManagerState.currentPath = data.path\n\n    // Save last visited path\n    saveLastPath(data.path)\n\n    // Save to history\n    if (\n      FileManagerState.historyIndex === -1 ||\n      FileManagerState.history[FileManagerState.historyIndex] !== data.path\n    ) {\n      FileManagerState.history = FileManagerState.history.slice(\n        0,\n        FileManagerState.historyIndex + 1\n      )\n      FileManagerState.history.push(data.path)\n      FileManagerState.historyIndex = FileManagerState.history.length - 1\n    }\n\n    const pathInput = document.getElementById('dm-path-input') as HTMLInputElement\n    if (pathInput) pathInput.value = data.path\n\n    renderFileListUI()\n    updateStatus(`${FileManagerState.files.length} `)\n  } catch (error) {\n    console.error('Load directory error:', error)\n    updateStatus('')\n    showToast('error', '', '')\n  }\n}\n\n/**\n * Load remote SSH directory\n */\nasync function loadRemoteDirectory(\n  path: string,\n  conn: { connection_id: string; root_path?: string }\n): Promise<void> {\n  updateStatus(`: ${path}...`)\n\n  try {\n    const { sshList } = await import('../../api/ssh.js')\n    const data = await sshList(conn.connection_id, path || conn.root_path || '/')\n\n    FileManagerState.files = (data.files as FileItem[]) || []\n    FileManagerState.currentPath = data.path || path\n\n    const pathInput = document.getElementById('dm-path-input') as HTMLInputElement\n    if (pathInput) pathInput.value = `[SSH] ${data.path}`\n\n    renderFileListUI()\n    updateStatus(`${FileManagerState.files.length}  ()`)\n  } catch (error) {\n    console.error('Load remote directory error:', error)\n    updateStatus('')\n    showToast('error', '', `: ${(error as Error).message}`)\n  }\n}\n\n/**\n * Render file list UI\n */\nfunction renderFileListUI(): void {\n  const container = document.getElementById('dm-file-list')\n  if (!container) return\n\n  // Clear current selection\n  FileManagerState.selectedFiles = []\n\n  // Sort files\n  const sortedFiles = [...FileManagerState.files].sort((a, b) => {\n    // Directories first\n    const aIsDir = (a as FileItem).is_dir || (a as FileItem).isDir || false\n    const bIsDir = (b as FileItem).is_dir || (b as FileItem).isDir || false\n    if (aIsDir && !bIsDir) return -1\n    if (!aIsDir && bIsDir) return 1\n\n    let comparison = 0\n    switch (FileManagerState.sortBy) {\n      case 'name':\n        comparison = a.name.localeCompare(b.name)\n        break\n      case 'size':\n        comparison = ((a as FileItem).size || 0) - ((b as FileItem).size || 0)\n        break\n      case 'modified':\n        comparison =\n          new Date((a as FileItem).modified || 0).getTime() -\n          new Date((b as FileItem).modified || 0).getTime()\n        break\n    }\n\n    return FileManagerState.sortOrder === 'asc' ? comparison : -comparison\n  })\n\n  let html = ''\n\n  // Parent directory link\n  if (FileManagerState.currentPath !== '.' && FileManagerState.currentPath !== '/') {\n    if (FileManagerState.viewMode === 'list') {\n      html += createFileListItem(\n        {\n          name: '..',\n          isDir: true,\n          path: getParentPath(FileManagerState.currentPath),\n          size: 0,\n          modified: undefined,\n        },\n        true\n      )\n    } else {\n      html += createFileGridItem(\n        {\n          name: '..',\n          isDir: true,\n          path: getParentPath(FileManagerState.currentPath),\n        },\n        true\n      )\n    }\n  }\n\n  // Render file list\n  sortedFiles.forEach((file) => {\n    html +=\n      FileManagerState.viewMode === 'list'\n        ? createFileListItem(file as FileItem, false)\n        : createFileGridItem(file as FileItem, false)\n  })\n\n  container.innerHTML = html\n\n  // Reset scroll position to top\n  container.scrollTop = 0\n\n  // Bind events\n  container.querySelectorAll('.dm-file-item').forEach((item) => {\n    ;(item as HTMLElement).onclick = () => selectFile(item as HTMLElement)\n    ;(item as HTMLElement).ondblclick = () => openFile(item as HTMLElement)\n  })\n\n  container.querySelectorAll('.dm-grid-item').forEach((item) => {\n    ;(item as HTMLElement).onclick = () => selectGridItem(item as HTMLElement)\n    ;(item as HTMLElement).ondblclick = async () => {\n      const path = (item as HTMLElement).dataset.path\n      const isDir = (item as HTMLElement).dataset.isDir === 'true'\n      if (isDir && path) {\n        await loadDirectory(path)\n      } else if (path) {\n        const { previewFile } = await import('./preview-actions.js')\n        await previewFile(path)\n      }\n    }\n  })\n}\n\n/**\n * Update copy path button state\n */\nfunction updateCopyPathButtonState(): void {\n  const copyBtn = document.getElementById('dm-copy-path-btn') as HTMLButtonElement\n  if (!copyBtn) return\n\n  const hasSelection = FileManagerState.selectedFiles.length > 0\n  copyBtn.disabled = !hasSelection\n  copyBtn.style.opacity = hasSelection ? '1' : '0.5'\n  copyBtn.style.cursor = hasSelection ? 'pointer' : 'not-allowed'\n}\n\n/**\n * Select list item\n */\nfunction selectFile(item: HTMLElement): void {\n  const theme = getComfyTheme()\n\n  document.querySelectorAll('.dm-file-item').forEach((i) => {\n    ;(i as HTMLElement).style.background = 'transparent'\n  })\n\n  item.style.background = `${theme.bgTertiary} !important`\n\n  const path = item.dataset.path || ''\n  const isDir = item.dataset.isDir === 'true'\n\n  FileManagerState.selectedFiles = [path]\n\n  // Update copy path button state\n  updateCopyPathButtonState()\n\n  if (!isDir && path) {\n    void (async () => {\n      const { previewFile } = await import('./preview-actions.js')\n      await previewFile(path)\n    })()\n  } else {\n    clearPreviewPanel()\n  }\n}\n\n/**\n * Select grid item\n */\nfunction selectGridItem(item: HTMLElement): void {\n  const theme = getComfyTheme()\n\n  document.querySelectorAll('.dm-grid-item').forEach((i) => {\n    ;(i as HTMLElement).style.borderColor = 'transparent'\n  })\n\n  item.style.borderColor = `${theme.accentColor} !important`\n  FileManagerState.selectedFiles = [item.dataset.path || '']\n\n  // Update copy path button state\n  updateCopyPathButtonState()\n\n  const path = item.dataset.path\n  const isDir = item.dataset.isDir === 'true'\n\n  if (!isDir && path) {\n    void (async () => {\n      const { previewFile } = await import('./preview-actions.js')\n      await previewFile(path)\n    })()\n  }\n}\n\n/**\n * Open file\n */\nfunction openFile(item: HTMLElement): void {\n  const path = item.dataset.path\n  const isDir = item.dataset.isDir === 'true'\n\n  if (isDir && path) {\n    void loadDirectory(path)\n  } else if (path) {\n    void (async () => {\n      const { previewFile } = await import('./preview-actions.js')\n      await previewFile(path)\n    })()\n  }\n}\n\n/**\n * Clear preview panel\n */\nfunction clearPreviewPanel(): void {\n  const previewContent = document.getElementById('dm-preview-content')\n  if (previewContent) {\n    const theme = getComfyTheme()\n    previewContent.innerHTML = `\n      <div style=\"text-align: center; padding: 40px; color: ${theme.textSecondary};\">\n        <i class=\"pi pi-folder\" style=\"font-size: 48px; opacity: 0.5;\"></i>\n        <div style=\"margin-top: 15px; font-size: 13px;\"></div>\n      </div>\n    `\n  }\n}\n\n/**\n * Toggle sort order\n * @param column - Sort column\n */\nexport function toggleSort(column: SortBy): void {\n  if (FileManagerState.sortBy === column) {\n    FileManagerState.sortOrder = FileManagerState.sortOrder === 'asc' ? 'desc' : 'asc'\n  } else {\n    FileManagerState.sortBy = column\n    FileManagerState.sortOrder = 'asc'\n  }\n\n  const sortSelect = document.getElementById('dm-sort-select') as HTMLSelectElement\n  if (sortSelect) {\n    sortSelect.value = FileManagerState.sortBy\n  }\n\n  renderFileListUI()\n  updateHeaderSortIndicators()\n}\n\n/**\n * Update header sort indicators\n */\nexport function updateHeaderSortIndicators(): void {\n  const headers = document.querySelectorAll('.dm-header-cell')\n  headers.forEach((header) => {\n    const icon = header.querySelector('i') as HTMLElement\n    if (icon) {\n      const column = (header as HTMLElement).dataset.sort as SortBy\n      if (column === FileManagerState.sortBy) {\n        icon.className =\n          FileManagerState.sortOrder === 'asc' ? 'pi pi-sort-amount-up' : 'pi pi-sort-amount-down'\n        icon.style.opacity = '1'\n      } else {\n        icon.className = 'pi pi-sort'\n        icon.style.opacity = '0.5'\n      }\n    }\n  })\n}\n\n/**\n * Navigate to parent directory\n */\nexport function navigateUp(): void {\n  if (FileManagerState.currentPath === '.' || FileManagerState.currentPath === '/') {\n    return\n  }\n\n  const parentPath = getParentPath(FileManagerState.currentPath)\n  if (parentPath !== FileManagerState.currentPath) {\n    void loadDirectory(parentPath)\n  }\n}\n\n/**\n * Navigate to root directory\n */\nexport function navigateHome(): void {\n  void loadDirectory('.')\n}\n\n/**\n * Navigate back in history\n */\nexport async function navigateBack(): Promise<void> {\n  if (FileManagerState.historyIndex <= 0) return\n\n  FileManagerState.historyIndex--\n  const path = FileManagerState.history[FileManagerState.historyIndex]\n  await loadDirectoryWithoutHistory(path)\n  updateNavButtons()\n}\n\n/**\n * Navigate forward in history\n */\nexport async function navigateForward(): Promise<void> {\n  if (FileManagerState.historyIndex >= FileManagerState.history.length - 1) return\n\n  FileManagerState.historyIndex++\n  const path = FileManagerState.history[FileManagerState.historyIndex]\n  await loadDirectoryWithoutHistory(path)\n  updateNavButtons()\n}\n\n/**\n * Load directory without adding to history (for navigation)\n * @param path - Directory path\n */\nasync function loadDirectoryWithoutHistory(path: string): Promise<void> {\n  // Check for active SSH connection\n  const remoteConn = (window as unknown as { _remoteConnectionsState: { active: unknown } })\n    ._remoteConnectionsState?.active\n  if (remoteConn) {\n    await loadRemoteDirectoryWithoutHistory(\n      path,\n      remoteConn as { connection_id: string; root_path?: string }\n    )\n    return\n  }\n\n  updateStatus(`: ${path}...`)\n\n  try {\n    const data = await listDirectory(path)\n    FileManagerState.files = (data.files as FileItem[]) || []\n    FileManagerState.currentPath = data.path\n\n    // Save last visited path\n    saveLastPath(data.path)\n\n    const pathInput = document.getElementById('dm-path-input') as HTMLInputElement\n    if (pathInput) pathInput.value = data.path\n\n    renderFileListUI()\n    updateStatus(`${FileManagerState.files.length} `)\n  } catch (error) {\n    console.error('Load directory error:', error)\n    updateStatus('')\n    showToast('error', '', '')\n  }\n}\n\n/**\n * Load remote SSH directory without history\n */\nasync function loadRemoteDirectoryWithoutHistory(\n  path: string,\n  conn: { connection_id: string; root_path?: string }\n): Promise<void> {\n  updateStatus(`: ${path}...`)\n\n  try {\n    const { sshList } = await import('../../api/ssh.js')\n    const data = await sshList(conn.connection_id, path || conn.root_path || '/')\n\n    FileManagerState.files = (data.files as FileItem[]) || []\n    FileManagerState.currentPath = data.path || path\n\n    const pathInput = document.getElementById('dm-path-input') as HTMLInputElement\n    if (pathInput) pathInput.value = `[SSH] ${data.path}`\n\n    renderFileListUI()\n    updateStatus(`${FileManagerState.files.length}  ()`)\n  } catch (error) {\n    console.error('Load remote directory error:', error)\n    updateStatus('')\n    showToast('error', '', `: ${(error as Error).message}`)\n  }\n}\n\n/**\n * Update navigation buttons state\n */\nexport function updateNavButtons(): void {\n  const backBtn = document.getElementById('dm-nav-back-btn') as HTMLButtonElement\n  const forwardBtn = document.getElementById('dm-nav-forward-btn') as HTMLButtonElement\n\n  if (backBtn) {\n    backBtn.disabled = FileManagerState.historyIndex <= 0\n    backBtn.style.opacity = FileManagerState.historyIndex <= 0 ? '0.3' : '1'\n  }\n  if (forwardBtn) {\n    forwardBtn.disabled = FileManagerState.historyIndex >= FileManagerState.history.length - 1\n    forwardBtn.style.opacity =\n      FileManagerState.historyIndex >= FileManagerState.history.length - 1 ? '0.3' : '1'\n  }\n}\n","/**\n * ComfyUI Data Manager - Syntax Highlighting Utilities\n */\n\n// Syntax highlight color theme (VS Code Dark style)\nconst CODE_COLORS = {\n  keyword: '#569cd6', // Keywords (blue)\n  string: '#ce9178', // Strings (orange)\n  number: '#b5cea8', // Numbers (light green)\n  boolean: '#569cd6', // Booleans (blue)\n  null: '#569cd6', // null (blue)\n  comment: '#6a9955', // Comments (green)\n  function: '#dcdcaa', // Functions (yellow)\n  class: '#4ec9b0', // Classes (cyan)\n  tag: '#569cd6', // HTML tags\n  attrName: '#9cdcfe', // Attribute names\n  attrValue: '#ce9178', // Attribute values\n} as const\n\n/**\n * Generic syntax highlight function\n * @param code - Source code\n * @param ext - File extension\n * @returns Highlighted HTML string\n */\nexport function highlightCode(code: string, ext: string): string {\n  // HTML escape\n  let result = code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')\n\n  // Select highlight rules based on extension\n  switch (ext) {\n    case '.json':\n      result = highlightJSON(result)\n      break\n    case '.py':\n      result = highlightPython(result)\n      break\n    case '.js':\n    case '.ts':\n    case '.jsx':\n    case '.tsx':\n      result = highlightJavaScript(result)\n      break\n    case '.html':\n    case '.htm':\n      result = highlightHTML(result)\n      break\n    case '.css':\n      result = highlightCSS(result)\n      break\n    case '.yaml':\n    case '.yml':\n      result = highlightYAML(result)\n      break\n    case '.xml':\n      result = highlightXML(result)\n      break\n    default:\n      result = highlightGeneric(result)\n  }\n\n  return result\n}\n\n/**\n * JSON syntax highlight\n * @param code - JSON code\n * @returns Highlighted HTML string\n */\nexport function highlightJSON(code: string): string {\n  return code.replace(\n    /(\"(\\\\u[a-zA-Z0-9]{4}|\\\\[^u]|[^\\\\\"])*\"(\\s*:)?|\\b(true|false|null)\\b|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?)/g,\n    function (match) {\n      let color: string = CODE_COLORS.number\n      if (/^\"/.test(match)) color = /:$/.test(match) ? CODE_COLORS.attrName : CODE_COLORS.string\n      else if (/true|false|null/.test(match)) color = CODE_COLORS.boolean\n      return `<span style=\"color: ${color};\">${match}</span>`\n    }\n  )\n}\n\n/**\n * Python syntax highlight\n * @param code - Python code\n * @returns Highlighted HTML string\n */\nexport function highlightPython(code: string): string {\n  const keywords =\n    /\\b(def|class|import|from|if|elif|else|while|for|in|try|except|finally|with|as|return|yield|raise|pass|break|continue|and|or|not|is|lambda|True|False|None|async|await)\\b/g\n  const decorators = /@[\\w.]+/g\n  const strings = /(\"\"\"[\\s\\S]*?\"\"\"|'''[\\s\\S]*?'''|\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g\n  const comments = /#.*$/gm\n  const numbers = /\\b(\\d+\\.?\\d*)\\b/g\n  const functions = /\\b([a-zA-Z_]\\w*)\\s*(?=\\()/g\n\n  // Order matters: comments -> strings -> keywords -> functions -> numbers\n  return code\n    .replace(comments, `<span style=\"color: ${CODE_COLORS.comment};\">$&</span>`)\n    .replace(strings, `<span style=\"color: ${CODE_COLORS.string};\">$&</span>`)\n    .replace(keywords, `<span style=\"color: ${CODE_COLORS.keyword};\">$&</span>`)\n    .replace(decorators, `<span style=\"color: ${CODE_COLORS.function};\">$&</span>`)\n    .replace(functions, `<span style=\"color: ${CODE_COLORS.function};\">$1</span>(`)\n    .replace(numbers, `<span style=\"color: ${CODE_COLORS.number};\">$1</span>`)\n}\n\n/**\n * JavaScript/TypeScript syntax highlight\n * @param code - JavaScript code\n * @returns Highlighted HTML string\n */\nexport function highlightJavaScript(code: string): string {\n  const keywords =\n    /\\b(const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|new|this|class|extends|import|export|from|async|await|try|catch|finally|throw|null|undefined|true|false|in|instanceof|typeof|void)\\b/g\n  const templateStrings = /`(?:[^`\\\\]|\\\\.)*`/g\n  const strings = /(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g\n  const comments = /(\\/\\/.*$|\\/\\*[\\s\\S]*?\\*\\/)/gm\n  const numbers = /\\b(\\d+\\.?\\d*)\\b/g\n  const functions = /\\b([a-zA-Z_]\\w*)\\s*(?=\\()/g\n  const arrowFunc = /(&gt;|=>)/g\n\n  return code\n    .replace(comments, `<span style=\"color: ${CODE_COLORS.comment};\">$&</span>`)\n    .replace(templateStrings, `<span style=\"color: ${CODE_COLORS.string};\">$&</span>`)\n    .replace(strings, `<span style=\"color: ${CODE_COLORS.string};\">$&</span>`)\n    .replace(keywords, `<span style=\"color: ${CODE_COLORS.keyword};\">$&</span>`)\n    .replace(functions, `<span style=\"color: ${CODE_COLORS.function};\">$1</span>(`)\n    .replace(arrowFunc, `<span style=\"color: ${CODE_COLORS.keyword};\">$&</span>`)\n    .replace(numbers, `<span style=\"color: ${CODE_COLORS.number};\">$1</span>`)\n}\n\n/**\n * HTML syntax highlight\n * @param code - HTML code\n * @returns Highlighted HTML string\n */\nexport function highlightHTML(code: string): string {\n  // HTML tags\n  code = code.replace(/(&lt;\\/?)([\\w-]+)/g, `$1<span style=\"color: ${CODE_COLORS.tag};\">$2</span>`)\n  // Attribute names\n  code = code.replace(/([\\w-]+)(=)/g, `<span style=\"color: ${CODE_COLORS.attrName};\">$1</span>$2`)\n  // Attribute values\n  code = code.replace(\n    /(=)(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g,\n    `$1<span style=\"color: ${CODE_COLORS.attrValue};\">$2</span>`\n  )\n  return code\n}\n\n/**\n * CSS syntax highlight\n * @param code - CSS code\n * @returns Highlighted HTML string\n */\nexport function highlightCSS(code: string): string {\n  // Comments\n  code = code.replace(\n    /(\\/\\*[\\s\\S]*?\\*\\/)/g,\n    `<span style=\"color: ${CODE_COLORS.comment};\">$1</span>`\n  )\n  // Strings\n  code = code.replace(\n    /(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g,\n    `<span style=\"color: ${CODE_COLORS.string};\">$1</span>`\n  )\n  // Properties\n  code = code.replace(\n    /([\\w-]+)(\\s*:)/g,\n    `<span style=\"color: ${CODE_COLORS.attrName};\">$1</span>$2`\n  )\n  // Values with units\n  code = code.replace(\n    /(:\\s*)([\\d.#\\w-]+)/g,\n    `$1<span style=\"color: ${CODE_COLORS.attrValue};\">$2</span>`\n  )\n  // Selectors (at start of line or after })\n  code = code.replace(\n    /([.#]?[\\w-]+)(\\s*\\{)/g,\n    `<span style=\"color: ${CODE_COLORS.tag};\">$1</span>$2`\n  )\n  return code\n}\n\n/**\n * YAML syntax highlight\n * @param code - YAML code\n * @returns Highlighted HTML string\n */\nexport function highlightYAML(code: string): string {\n  // Comments\n  code = code.replace(/(#.*$)/gm, `<span style=\"color: ${CODE_COLORS.comment};\">$1</span>`)\n  // Keys (before colon)\n  code = code.replace(/^([\\w-]+):/gm, `<span style=\"color: ${CODE_COLORS.attrName};\">$1</span>:`)\n  // Values (after colon)\n  code = code.replace(\n    /(:\\s*)([\\w./-]+)/g,\n    `$1<span style=\"color: ${CODE_COLORS.string};\">$2</span>`\n  )\n  // Booleans and null\n  code = code.replace(\n    /\\b(true|false|null)\\b/g,\n    `<span style=\"color: ${CODE_COLORS.boolean};\">$1</span>`\n  )\n  // Numbers\n  code = code.replace(/\\b(\\d+\\.?\\d*)\\b/g, `<span style=\"color: ${CODE_COLORS.number};\">$1</span>`)\n  return code\n}\n\n/**\n * XML syntax highlight\n * @param code - XML code\n * @returns Highlighted HTML string\n */\nexport function highlightXML(code: string): string {\n  // Tags\n  code = code.replace(/(&lt;\\/?)([\\w:]+)/g, `$1<span style=\"color: ${CODE_COLORS.tag};\">$2</span>`)\n  // Attribute names\n  code = code.replace(/([\\w:]+)(=)/g, `<span style=\"color: ${CODE_COLORS.attrName};\">$1</span>$2`)\n  // Attribute values\n  code = code.replace(\n    /(=)(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g,\n    `$1<span style=\"color: ${CODE_COLORS.attrValue};\">$2</span>`\n  )\n  return code\n}\n\n/**\n * Generic syntax highlight (fallback)\n * @param code - Code\n * @returns Highlighted HTML string\n */\nexport function highlightGeneric(code: string): string {\n  // Strings\n  code = code.replace(\n    /(\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*')/g,\n    `<span style=\"color: ${CODE_COLORS.string};\">$1</span>`\n  )\n  // Comments (// and /* */)\n  code = code.replace(/(\\/\\/.*$)/gm, `<span style=\"color: ${CODE_COLORS.comment};\">$1</span>`)\n  code = code.replace(\n    /(\\/\\*[\\s\\S]*?\\*\\/)/g,\n    `<span style=\"color: ${CODE_COLORS.comment};\">$1</span>`\n  )\n  // Keywords\n  const keywords =\n    /\\b(function|return|if|else|for|while|var|let|const|true|false|null|undefined)\\b/g\n  code = code.replace(keywords, `<span style=\"color: ${CODE_COLORS.keyword};\">$1</span>`)\n  // Numbers\n  code = code.replace(/\\b(\\d+\\.?\\d*)\\b/g, `<span style=\"color: ${CODE_COLORS.number};\">$1</span>`)\n  return code\n}\n","/**\n * ComfyUI Data Manager - Script Loading Utilities\n */\n\n/**\n * Dynamically load external script\n * @param src - Script URL\n * @returns Promise that resolves when script is loaded\n */\nexport function loadScript(src: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    // If already loaded, resolve immediately\n    if (document.querySelector(`script[src=\"${src}\"]`)) {\n      resolve()\n      return\n    }\n    const script = document.createElement('script')\n    script.src = src\n    script.onload = () => resolve()\n    script.onerror = reject\n    document.head.appendChild(script)\n  })\n}\n","/**\n * ComfyUI Data Manager - CSV Parsing Utilities\n */\n\n/**\n * Parse CSV text into 2D array\n * @param text - CSV text\n * @returns Two-dimensional array\n */\nexport function parseCSV(text: string): string[][] {\n  const rows: string[][] = []\n  let currentRow: string[] = []\n  let currentCell = ''\n  let inQuotes = false\n\n  for (let i = 0; i < text.length; i++) {\n    const char = text[i]\n    const nextChar = text[i + 1]\n\n    if (inQuotes) {\n      if (char === '\"') {\n        if (nextChar === '\"') {\n          currentCell += '\"'\n          i++\n        } else {\n          inQuotes = false\n        }\n      } else {\n        currentCell += char\n      }\n    } else {\n      if (char === '\"') {\n        inQuotes = true\n      } else if (char === ',') {\n        currentRow.push(currentCell)\n        currentCell = ''\n      } else if (char === '\\r' && nextChar === '\\n') {\n        currentRow.push(currentCell)\n        rows.push(currentRow)\n        currentRow = []\n        currentCell = ''\n        i++\n      } else if (char === '\\n') {\n        currentRow.push(currentCell)\n        rows.push(currentRow)\n        currentRow = []\n        currentCell = ''\n      } else if (char !== '\\r') {\n        currentCell += char\n      }\n    }\n  }\n\n  // Add last cell and row\n  currentRow.push(currentCell)\n  if (currentRow.length > 0 || rows.length > 0) {\n    rows.push(currentRow)\n  }\n\n  return rows\n}\n","/**\n * ComfyUI Data Manager - Table Preview Utilities\n *\n * Provides CSV/Excel table preview functionality\n */\n\nimport { escapeHtml } from './format.js'\nimport { loadScript } from './script.js'\nimport { parseCSV } from './csv.js'\nimport { LIMITS } from '../core/constants.js'\n\n/**\n * Table mode type\n */\nexport type TableModeType = 'floating' | 'panel'\n\n/**\n * Table options\n */\nexport interface TableOptions {\n  type?: TableModeType\n  maxRows?: number\n  height?: number | null\n  hasFullscreen?: boolean\n  path?: string // File path for fullscreen open floating preview\n}\n\n/**\n * Default configuration\n */\nconst DEFAULT_OPTIONS: TableOptions = {\n  type: 'floating',\n  maxRows: LIMITS.MAX_PREVIEW_ROWS,\n  height: null,\n}\n\n/**\n * Table mode configuration\n */\ntype TableModeConfig = {\n  containerClass: string\n  controlsClass: string\n  height: string | null\n  hasFullscreen: boolean\n  prefix: string\n}\n\nconst MODE_CONFIG: Record<'floating' | 'panel', TableModeConfig> = {\n  floating: {\n    containerClass: 'dm-table-container',\n    controlsClass: 'dm-table-controls',\n    height: null,\n    hasFullscreen: false,\n    prefix: 'dm-floating-table',\n  },\n  panel: {\n    containerClass: 'dm-panel-table-container',\n    controlsClass: 'dm-table-controls-panel',\n    height: null, // \n    hasFullscreen: true,\n    prefix: 'dm-table',\n  },\n}\n\n/**\n * Create table HTML\n * @param rows - Two-dimensional array data\n * @param options - Configuration options\n * @returns HTML string\n */\nexport function createTableHTML(rows: string[][], options: TableOptions = {}): string {\n  const mergedOptions = { ...DEFAULT_OPTIONS, ...options }\n  const mode = MODE_CONFIG[mergedOptions.type || 'floating']\n  // Override hasFullscreen if specified in options\n  const hasFullscreen =\n    mergedOptions.hasFullscreen !== undefined ? mergedOptions.hasFullscreen : mode.hasFullscreen\n  const displayRows = rows.slice(0, mergedOptions.maxRows || LIMITS.MAX_PREVIEW_ROWS)\n  const isTruncated = rows.length > (mergedOptions.maxRows || LIMITS.MAX_PREVIEW_ROWS)\n  const tableId = `${mode.prefix}-${Date.now()}`\n  const tablePath = mergedOptions.path || ''\n\n  const heightStyle = mode.height !== null ? `height: ${mode.height};` : 'height: 100%;'\n  const containerStyle = `position: relative; flex: 1; overflow: hidden; ${heightStyle}`\n\n  let tableHTML = `\n    <div style=\"display: flex; flex-direction: column; gap: 0; ${mergedOptions.type === 'floating' ? 'height: 100%;' : ''}\">\n      <div class=\"${mode.containerClass}\" style=\"${containerStyle}\">\n        <div id=\"${tableId}-wrapper\" class=\"dm-table-wrapper\"\n             style=\"width: 100%; overflow: auto; padding: 15px; ${heightStyle}\">\n          <table id=\"${tableId}\" class=\"dm-data-table\" ${tablePath ? `data-table-path=\"${escapeHtml(tablePath)}\"` : ''}\n                 style=\"width: 100%; border-collapse: collapse; font-size: 12px; transform-origin: top left;\">\n  `\n\n  displayRows.forEach((row, rowIndex) => {\n    const isHeader = rowIndex === 0\n    tableHTML += '<tr>'\n\n    row.forEach((cell) => {\n      const cellContent = escapeHtml(String(cell ?? ''))\n      if (isHeader) {\n        tableHTML += `<th class=\"dm-table-header\">${cellContent}</th>`\n      } else {\n        tableHTML += `<td class=\"dm-table-cell\">${cellContent}</td>`\n      }\n    })\n\n    tableHTML += '</tr>'\n  })\n\n  tableHTML += `\n          </table>\n        </div>\n      </div>\n      ${createTableControls(tableId, mode)}\n    </div>\n  `\n\n  if (isTruncated) {\n    const maxRows = mergedOptions.maxRows || LIMITS.MAX_PREVIEW_ROWS\n    tableHTML = tableHTML.replace(\n      '</div>',\n      `<div class=\"dm-table-truncated\" style=\"text-align: center; padding: 10px; font-size: 11px;\">... ( ${maxRows}  ${rows.length} )</div></div>`\n    )\n  }\n\n  // Delay setting up controls\n  setTimeout(\n    () =>\n      setupTableControls(\n        tableId,\n        (mergedOptions.type || 'floating') as 'floating' | 'panel',\n        hasFullscreen,\n        tablePath\n      ),\n    0\n  )\n\n  return tableHTML\n}\n\n/**\n * Create table controls HTML\n * @param tableId - Table ID\n * @param mode - Mode configuration\n * @returns Controls HTML string\n */\nfunction createTableControls(tableId: string, mode: typeof MODE_CONFIG.floating): string {\n  let controlsHTML = `\n    <div id=\"${tableId}-controls\" class=\"${mode.controlsClass}\" style=\"display: flex; align-items: center; justify-content: center; gap: 8px; padding: 10px; flex-shrink: 0;\">\n      <button class=\"comfy-btn dm-table-zoom-out-btn\" data-table-id=\"${tableId}\" title=\"\">\n        <i class=\"pi pi-search-minus\"></i>\n      </button>\n      <span id=\"${tableId}-zoom\" class=\"dm-table-zoom-display\">100%</span>\n      <button class=\"comfy-btn dm-table-zoom-in-btn\" data-table-id=\"${tableId}\" title=\"\">\n        <i class=\"pi pi-search-plus\"></i>\n      </button>\n      <button class=\"comfy-btn dm-table-fit-btn\" data-table-id=\"${tableId}\" title=\"\">\n        <i class=\"pi pi-arrows-alt\"></i>\n      </button>\n  `\n\n  if (mode.hasFullscreen) {\n    controlsHTML += `\n      <button class=\"comfy-btn dm-table-fullscreen-btn\" data-table-id=\"${tableId}\" title=\"\">\n        <i class=\"pi pi-window-maximize\"></i>\n      </button>\n    `\n  }\n\n  controlsHTML += '</div>'\n  return controlsHTML\n}\n\n/**\n * Setup table control events\n * @param tableId - Table ID\n * @param modeType - Mode type ('floating' | 'panel')\n * @param hasFullscreen - Whether to show fullscreen button\n * @param tablePath - File path for fullscreen open floating preview\n */\nexport function setupTableControls(\n  tableId: string,\n  modeType: TableModeType = 'floating',\n  hasFullscreen?: boolean,\n  tablePath?: string\n): void {\n  const table = document.getElementById(tableId)\n  if (!table) return\n\n  const mode = MODE_CONFIG[modeType] || MODE_CONFIG.floating\n  const showFullscreen = hasFullscreen !== undefined ? hasFullscreen : mode.hasFullscreen\n  let zoom = 100\n  let isFullscreen = false\n  const tableEl = table as HTMLElement\n\n  const wrapper = document.getElementById(`${tableId}-wrapper`)\n  const zoomDisplay = document.getElementById(`${tableId}-zoom`)\n  const zoomInBtn = document.querySelector(\n    `.dm-table-zoom-in-btn[data-table-id=\"${tableId}\"]`\n  ) as HTMLButtonElement\n  const zoomOutBtn = document.querySelector(\n    `.dm-table-zoom-out-btn[data-table-id=\"${tableId}\"]`\n  ) as HTMLButtonElement\n  const fitBtn = document.querySelector(\n    `.dm-table-fit-btn[data-table-id=\"${tableId}\"]`\n  ) as HTMLButtonElement\n  const fullscreenBtn = showFullscreen\n    ? (document.querySelector(\n        `.dm-table-fullscreen-btn[data-table-id=\"${tableId}\"]`\n      ) as HTMLButtonElement | null)\n    : null\n\n  function updateZoom(): void {\n    tableEl.style.transform = `scale(${zoom / 100})`\n    if (zoomDisplay) zoomDisplay.textContent = `${zoom}%`\n    if (wrapper) {\n      wrapper.style.width = zoom > 100 ? `${zoom}%` : '100%'\n    }\n  }\n\n  if (zoomInBtn) {\n    zoomInBtn.addEventListener('click', () => {\n      zoom = Math.min(zoom + LIMITS.DEFAULT_ZOOM_STEP, LIMITS.MAX_ZOOM_DISPLAY)\n      updateZoom()\n    })\n  }\n\n  if (zoomOutBtn) {\n    zoomOutBtn.addEventListener('click', () => {\n      zoom = Math.max(zoom - LIMITS.DEFAULT_ZOOM_STEP, LIMITS.MIN_ZOOM_DISPLAY)\n      updateZoom()\n    })\n  }\n\n  if (fitBtn) {\n    fitBtn.addEventListener('click', () => {\n      const containerWidth = wrapper?.clientWidth || 400\n      const tableWidth = tableEl.scrollWidth\n      const newZoom = Math.min(Math.floor((containerWidth / tableWidth) * 100), 100)\n      zoom = Math.max(newZoom, LIMITS.MIN_ZOOM_DISPLAY)\n      updateZoom()\n    })\n  }\n\n  if (fullscreenBtn) {\n    fullscreenBtn.addEventListener('click', async () => {\n      // Open floating preview for table fullscreen\n      // Use passed path first, fallback to data attribute\n      const path = tablePath || tableEl.getAttribute('data-table-path')\n      if (path) {\n        const fileName = path.split(/[\\\\/]/).pop() || path\n        const { openFloatingPreview } = await import('../ui/floating/window.js')\n        openFloatingPreview(path, fileName)\n      }\n    })\n  }\n}\n\n/**\n * Create empty table HTML\n * @param message - Empty message\n * @returns HTML string\n */\nexport function createEmptyTableHTML(message = ''): string {\n  return `\n    <div style=\"text-align: center; padding: 40px; color: #666;\">\n      <i class=\"pi pi-table\" style=\"font-size: 48px; opacity: 0.5;\"></i>\n      <div style=\"margin-top: 15px; font-size: 13px;\">${escapeHtml(message)}</div>\n    </div>\n  `\n}\n\n/**\n * Create unsupported table HTML\n * @param format - Format name\n * @returns HTML string\n */\nexport function createUnsupportedTableHTML(format: string): string {\n  return `\n    <div style=\"text-align: center; padding: 40px; color: #666;\">\n      <i class=\"pi pi-file-excel\" style=\"font-size: 48px; opacity: 0.5;\"></i>\n      <div style=\"margin-top: 15px; font-size: 13px;\">${escapeHtml(format)} </div>\n    </div>\n  `\n}\n\n/**\n * Create table error HTML\n * @param error - Error message\n * @returns HTML string\n */\nexport function createTableErrorHTML(error: string): string {\n  return `\n    <div style=\"text-align: center; padding: 40px; color: #e74c3c;\">\n      <i class=\"pi pi-exclamation-triangle\" style=\"font-size: 48px;\"></i>\n      <div style=\"margin-top: 15px; font-size: 13px;\"></div>\n      <div style=\"margin-top: 5px; font-size: 11px;\">${escapeHtml(error)}</div>\n    </div>\n  `\n}\n\n/**\n * Parse spreadsheet file (CSV or Excel)\n * @param path - File path\n * @param ext - File extension\n * @returns Promise resolving to 2D array\n */\nexport async function parseSpreadsheet(path: string, ext: string): Promise<string[][]> {\n  const response = await fetch(`/dm/preview?path=${encodeURIComponent(path)}`)\n\n  if (!response.ok) {\n    throw new Error('Failed to load file')\n  }\n\n  if (ext === '.csv') {\n    const text = await response.text()\n    return parseCSV(text)\n  }\n\n  // Excel files (.xls, .xlsx) - use SheetJS library\n  if (ext === '.xls' || ext === '.xlsx') {\n    // Load SheetJS if not available\n    const win = window as unknown as { XLSX?: any }\n    if (typeof win.XLSX === 'undefined') {\n      await loadScript('https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js')\n    }\n\n    const arrayBuffer = await response.arrayBuffer()\n    const XLSX = win.XLSX\n    const workbook = XLSX.read(arrayBuffer, { type: 'array' })\n\n    const firstSheetName = workbook.SheetNames[0]\n    const worksheet = workbook.Sheets[firstSheetName]\n    const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 })\n\n    return rows as string[][]\n  }\n\n  throw new Error('Unsupported spreadsheet format')\n}\n","/**\n * ComfyUI Data Manager - Floating Window Preview Content Loading\n */\n\nimport { FILE_TYPES, LIMITS } from '../../core/constants.js'\nimport { getFileType } from '../../utils/file-type.js'\nimport { escapeHtml, formatSize } from '../../utils/format.js'\nimport { highlightCode } from '../../utils/syntax-highlight.js'\nimport {\n  createTableHTML,\n  setupTableControls,\n  createEmptyTableHTML,\n  createUnsupportedTableHTML,\n  createTableErrorHTML,\n  parseSpreadsheet,\n} from '../../utils/table.js'\nimport { loadScript } from '../../utils/script.js'\nimport { getFileInfo } from '../../api/endpoints/file.js'\nimport { getComfyTheme } from '../../utils/theme.js'\n\n/**\n * Clean mammoth.js output to remove internal function references\n * mammoth.js sometimes includes internal object references like `function(){return value.call(this._target())}`\n * in the HTML output, which need to be filtered out.\n */\nfunction cleanMammothOutput(html: unknown): string {\n  // Ensure input is a string\n  if (typeof html !== 'string') {\n    return String(html ?? '')\n  }\n\n  let cleaned = html\n\n  // Remove function() {...} patterns (including multi-line)\n  const functionPattern = /function\\s*\\(\\s*\\)\\s*\\{[\\s\\S]*?\\}/g\n  cleaned = cleaned.replace(functionPattern, '')\n\n  // Remove specific mammoth internal references\n  const targetPattern = /function\\s*\\(\\s*\\)\\s*\\{\\s*(return\\s+)?[\\w.]*\\.?(?:_?target|value)\\s*(?:\\.call\\([^)]*\\))?[\\s;]*\\}/g\n  cleaned = cleaned.replace(targetPattern, '')\n\n  // Remove any remaining object-like patterns (e.g., {value:..., _target:...})\n  const objectPattern = /\\{[^}]*_target[^}]*\\}/g\n  cleaned = cleaned.replace(objectPattern, '')\n\n  return cleaned\n}\n\n/**\n * Load preview content into container\n * @param content - Content container element\n * @param path - File path\n * @param ext - File extension\n * @param scale - Initial scale (for images only)\n * @param imageId - Pre-generated image ID (for images only)\n */\nexport async function loadPreviewContent(\n  content: HTMLElement,\n  path: string,\n  ext: string,\n  scale: number = 1,\n  imageId?: string\n): Promise<void> {\n  const theme = getComfyTheme()\n  content.innerHTML = `\n    <div class=\"dm-loading\" style=\"text-align: center; padding: 20px;\">\n      <i class=\"pi pi-spin pi-spinner\" style=\"font-size: 24px;\"></i>\n      <div style=\"margin-top: 10px;\">...</div>\n    </div>\n  `\n\n  try {\n    let previewHTML = ''\n\n    // Image preview\n    // Note: Image zoom controls are in the toolbar (right section), not embedded\n    if (FILE_TYPES.image.exts.includes(ext)) {\n      const imageUrl = `/dm/preview?path=${encodeURIComponent(path)}`\n      // Use provided imageId or generate a new one (fallback)\n      const imgId = imageId || `dm-floating-image-${Date.now()}`\n      previewHTML = `\n        <div style=\"display: flex; flex-direction: column; gap: 0; height: 100%;\">\n          <div class=\"dm-floating-image-container\" style=\"position: relative; overflow: hidden; flex: 1; display: flex; align-items: center; justify-content: center;\">\n            <img id=\"${imgId}\" src=\"${imageUrl}\"\n                 class=\"dm-zoomable-image dm-preview-image\"\n                 style=\"width: auto; height: auto; max-width: 100%; max-height: 100%;\n                        border-radius: 8px; border: 1px solid;\n                        transform-origin: center center;\n                        will-change: transform; cursor: grab;\"\n                 onerror=\"this.parentElement.innerHTML='<div class=\\\\'dm-error-message\\\\' style=\\\\'padding: 20px;\\\\'></div>'\"\n                 onload=\"this.style.opacity=1; this.style.display='block';\">\n          </div>\n        </div>\n      `\n    }\n    // Audio preview\n    // Note: Audio controls are in the window toolbar, created by window.ts\n    else if (FILE_TYPES.audio.exts.includes(ext)) {\n      const audioUrl = `/dm/preview?path=${encodeURIComponent(path)}`\n      // Use provided mediaId or generate a new one (fallback)\n      const audioId = imageId || `dm-preview-audio-${Date.now()}`\n      const displayName = escapeHtml(path.split(/[/\\\\]/).pop() || '')\n      const audioExt = ext.toLowerCase()\n      const audioMimeType =\n        audioExt === '.mp3'\n          ? 'audio/mpeg'\n          : audioExt === '.wav'\n            ? 'audio/wav'\n            : audioExt === '.flac'\n              ? 'audio/flac'\n              : audioExt === '.aac'\n                ? 'audio/aac'\n                : audioExt === '.ogg'\n                  ? 'audio/ogg'\n                  : audioExt === '.m4a'\n                    ? 'audio/mp4'\n                    : 'audio/mpeg'\n      previewHTML = `\n        <div class=\"dm-audio-preview\" style=\"width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px;\">\n          <i class=\"pi pi-volume-up dm-audio-icon\" style=\"font-size: 64px; margin-bottom: 15px;\"></i>\n          <div class=\"dm-preview-filename\" style=\"margin-bottom: 15px; font-size: 14px;\">${displayName}</div>\n          <audio id=\"${audioId}\" data-audio-id=\"${audioId}\" preload=\"metadata\" style=\"width: 100%; max-width: 400px; display: none;\">\n            <source src=\"${audioUrl}\" type=\"${audioMimeType}\">\n            \n          </audio>\n        </div>\n      `\n    }\n    // Video preview (browser supported)\n    // Note: Video controls are in the window toolbar, created by window.ts\n    else if (FILE_TYPES.video.exts.includes(ext)) {\n      const videoUrl = `/dm/preview?path=${encodeURIComponent(path)}`\n      // Use provided mediaId or generate a new one (fallback)\n      const videoId = imageId || `dm-preview-video-${Date.now()}`\n      previewHTML = `\n        <div class=\"dm-video-preview-container\" style=\"width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: ${theme.bgPrimary};\">\n          <video id=\"${videoId}\" data-video-id=\"${videoId}\" preload=\"metadata\" style=\"width: 100%; height: 100%; display: block; object-fit: contain;\">\n            <source src=\"${videoUrl}\" type=\"video/mp4\">\n          </video>\n        </div>\n      `\n    }\n    // External video format preview (requires external player)\n    else if (FILE_TYPES.videoExternal && FILE_TYPES.videoExternal.exts.includes(ext)) {\n      const extUpper = ext.toUpperCase().replace('.', '')\n      const displayName = escapeHtml(path.split(/[\\\\/]/).pop() || '')\n      previewHTML = `\n        <div class=\"dm-external-video\" style=\"text-align: center; padding: 40px;\">\n          <i class=\"pi pi-video dm-external-video-icon\" style=\"font-size: 64px; margin-bottom: 15px;\"></i>\n          <div class=\"dm-preview-filename\" style=\"font-size: 16px; margin-bottom: 8px;\">${displayName}</div>\n          <div class=\"dm-external-video-type\" style=\"font-size: 14px; font-weight: 600; margin-bottom: 15px;\">${extUpper} </div>\n          <div class=\"dm-external-video-desc\" style=\"margin-top: 10px; font-size: 12px; max-width: 300px; margin-left: auto; margin-right: auto;\">\n            <br>\n            <span class=\"dm-external-video-sub\">VLCWindows Media Player </span>\n          </div>\n          <div class=\"dm-external-video-tip\" style=\"margin-top: 15px; padding: 10px; border-radius: 6px; font-size: 11px;\">\n            \"\"\n          </div>\n        </div>\n      `\n    }\n    // Code preview\n    else if (FILE_TYPES.code.exts.includes(ext)) {\n      const response = await fetch(`/dm/preview?path=${encodeURIComponent(path)}`)\n      if (response.ok) {\n        const text = await response.text()\n        const highlighted = highlightCode(text, ext)\n        previewHTML = `\n          <div class=\"dm-code-preview\" style=\"width: 100%; padding: 15px;\n                      font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; line-height: 1.5;\n                      overflow-x: auto; max-height: 400px; overflow-y: auto; border-radius: 0;\">\n            <pre class=\"dm-code-content\" style=\"margin: 0; white-space: pre-wrap;\">${highlighted}</pre>\n          </div>\n        `\n      } else {\n        throw new Error('Failed to load file')\n      }\n    }\n    // Document preview\n    else if (FILE_TYPES.document.exts.includes(ext)) {\n      const docUrl = `/dm/preview?path=${encodeURIComponent(path)}`\n      const isPDF = ext === '.pdf'\n      const isMarkdown = ext === '.md'\n      const isDocx = ext === '.docx'\n      const isDoc = ext === '.doc'\n\n      if (isDoc) {\n        // Old Word documents cannot be previewed\n        const displayName = escapeHtml(path.split(/[/\\\\]/).pop() || '')\n        previewHTML = `\n          <div class=\"dm-doc-unsupported\" style=\"text-align: center; padding: 40px;\">\n            <i class=\"pi pi-file-word dm-doc-unsupported-icon\" style=\"font-size: 64px; margin-bottom: 15px;\"></i>\n            <div class=\"dm-preview-filename\" style=\"margin-top: 15px; font-size: 14px;\">${displayName}</div>\n            <div class=\"dm-unsupported-message\" style=\"margin-top: 10px; font-size: 12px;\">.doc </div>\n            <div class=\"dm-unsupported-sub\" style=\"margin-top: 5px; font-size: 11px;\"> .docx \"\"</div>\n          </div>\n        `\n      } else if (isDocx) {\n        // .docx files use mammoth.js to convert to HTML\n        try {\n          const response = await fetch(docUrl)\n          if (response.ok) {\n            const arrayBuffer = await response.arrayBuffer()\n\n            // Check if mammoth.js is loaded\n            if (typeof (window as unknown as { mammoth?: unknown }).mammoth === 'undefined') {\n              // Dynamically load mammoth.js\n              console.log('[DataManager] Loading mammoth.js...')\n              try {\n                await loadScript(\n                  'https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js'\n                )\n                console.log('[DataManager] mammoth.js loaded successfully')\n              } catch (scriptError) {\n                console.error('[DataManager] Failed to load mammoth.js:', scriptError)\n                throw new Error(' mammoth.js')\n              }\n            }\n\n            const mammoth = (\n              window as unknown as {\n                mammoth?: {\n                  convertToHtml: (options: { arrayBuffer: ArrayBuffer }) => Promise<{\n                    value: string\n                    messages: unknown[]\n                  }>\n                }\n              }\n            ).mammoth\n            if (mammoth) {\n              // mammoth.convertToHtml returns a Promise, so we need to await it\n              const result = await mammoth.convertToHtml({ arrayBuffer: arrayBuffer })\n              const rawHtml = result.value\n\n              // Clean mammoth output to remove internal function references\n              const cleanedHtml = cleanMammothOutput(rawHtml)\n              const contentId = `dm-doc-content-${Date.now()}`\n              previewHTML = `\n                <div id=\"${contentId}\" class=\"dm-document-content dm-docx-content\"\n                     style=\"width: 100%; height: 100%;\n                            font-family: 'Segoe UI', Arial, sans-serif;\n                            font-size: 13px;\n                            line-height: 1.6;\n                            overflow: auto;\n                            box-sizing: border-box;\n                            padding: 20px;\">\n                  <style>\n                    #${contentId} img { max-width: 100%; height: auto; display: inline-block; margin: 10px 0; }\n                    #${contentId} p { word-wrap: break-word; overflow-wrap: break-word; margin: 0.5em 0; }\n                    #${contentId} table { max-width: 100%; overflow: auto; display: block; margin: 10px 0; }\n                  </style>\n                  ${cleanedHtml}\n                </div>\n              `\n            } else {\n              throw new Error('mammoth.js ')\n            }\n          } else {\n            throw new Error('Failed to load file')\n          }\n        } catch (error) {\n          console.error('[DataManager] DOCX preview error:', error)\n          const displayName = escapeHtml(path.split(/[/\\\\]/).pop() || '')\n          previewHTML = `\n            <div class=\"dm-preview-error\" style=\"text-align: center; padding: 40px;\">\n              <i class=\"pi pi-exclamation-triangle dm-error-icon\" style=\"font-size: 48px;\"></i>\n              <div class=\"dm-preview-filename\" style=\"margin-top: 15px;\">${displayName}</div>\n              <div class=\"dm-error-title\" style=\"margin-top: 10px; font-size: 12px;\"></div>\n              <div class=\"dm-error-detail\" style=\"margin-top: 5px; font-size: 11px;\">${escapeHtml((error as Error).message)}</div>\n            </div>\n          `\n        }\n      } else if (isPDF) {\n        previewHTML = `\n          <div style=\"width: 100%; height: 100%; overflow: hidden;\">\n            <embed id=\"dm-floating-pdf-embed\" src=\"${docUrl}\" type=\"application/pdf\"\n                   style=\"width: 100%; height: 100%; border: none; display: block;\" />\n          </div>\n        `\n      } else if (isMarkdown) {\n        // Markdown preview - use iframe for backend rendering\n        previewHTML = `\n          <div style=\"width: 100%; height: 100%; border: 1px solid ${theme.borderColor}; overflow: hidden;\">\n            <iframe src=\"${docUrl}\" style=\"width: 100%; height: 100%; border: none;\"></iframe>\n          </div>\n        `\n      } else if (ext === '.txt' || ext === '.rtf') {\n        // TXT/RTF text preview - fetch and display content\n        try {\n          const response = await fetch(docUrl)\n          if (response.ok) {\n            const text = await response.text()\n            const contentId = `dm-doc-content-${Date.now()}`\n            previewHTML = `\n              <div id=\"${contentId}\" class=\"dm-document-content dm-text-content\"\n                   style=\"width: 100%; height: 100%;\n                          font-family: 'Consolas', 'Monaco', monospace;\n                          font-size: 13px;\n                          line-height: 1.6;\n                          overflow: auto;\n                          word-break: break-word;\n                          white-space: pre-wrap;\n                          padding: 15px;\">${escapeHtml(text)}</div>\n            `\n          } else {\n            throw new Error('Failed to load file')\n          }\n        } catch (error) {\n          console.error('[DataManager] Text preview error:', error)\n          const displayName = escapeHtml(path.split(/[/\\\\]/).pop() || '')\n          previewHTML = `\n            <div class=\"dm-preview-error\" style=\"text-align: center; padding: 40px;\">\n              <i class=\"pi pi-exclamation-triangle dm-error-icon\" style=\"font-size: 48px;\"></i>\n              <div class=\"dm-preview-filename\" style=\"margin-top: 15px;\">${displayName}</div>\n              <div class=\"dm-error-title\" style=\"margin-top: 10px; font-size: 12px;\"></div>\n              <div class=\"dm-error-detail\" style=\"margin-top: 5px; font-size: 11px;\">${escapeHtml((error as Error).message)}</div>\n            </div>\n          `\n        }\n      } else {\n        // Other documents\n        const displayName = escapeHtml(path.split(/[/\\\\]/).pop() || '')\n        previewHTML = `\n          <div style=\"text-align: center; padding: 40px;\">\n            <i class=\"pi pi-file\" style=\"font-size: 64px; color: ${theme.textSecondary};\"></i>\n            <div style=\"margin-top: 15px; font-size: 14px;\">${displayName}</div>\n            <div style=\"margin-top: 8px; font-size: 12px; color: ${theme.textSecondary};\">\"\"</div>\n          </div>\n        `\n      }\n    }\n    // Spreadsheet preview\n    else if (FILE_TYPES.spreadsheet.exts.includes(ext)) {\n      try {\n        const rows = await parseSpreadsheet(path, ext)\n        previewHTML = createTableHTML(rows, { type: 'floating', hasFullscreen: true, path })\n      } catch (error) {\n        previewHTML = createTableErrorHTML((error as Error).message)\n      }\n    }\n    // Other files\n    else {\n      const fileName = path.split(/[/\\\\]/).pop() || ''\n      const fileType = getFileType({ name: path })\n      const icon = FILE_TYPES[fileType]?.icon || FILE_TYPES.unknown.icon\n      const color = FILE_TYPES[fileType]?.color || FILE_TYPES.unknown.color\n      previewHTML = `\n        <div style=\"text-align: center; padding: 30px;\">\n          <i class=\"pi ${icon}\" style=\"font-size: 64px; color: ${color};\"></i>\n          <div style=\"margin-top: 15px; color: ${theme.textPrimary}; font-size: 14px;\">${escapeHtml(fileName)}</div>\n          <div style=\"margin-top: 8px; color: ${theme.textSecondary}; font-size: 12px;\"></div>\n        </div>\n      `\n    }\n\n    content.innerHTML = previewHTML\n\n    // Update file info\n    updateFileInfo(content, path)\n  } catch (error) {\n    content.innerHTML = `\n      <div class=\"dm-preview-error\" style=\"text-align: center; padding: 40px;\">\n        <i class=\"pi pi-exclamation-triangle dm-error-icon\" style=\"font-size: 48px;\"></i>\n        <div class=\"dm-error-title\" style=\"margin-top: 15px; font-size: 14px;\"></div>\n        <div class=\"dm-error-detail\" style=\"margin-top: 5px; font-size: 11px;\">${escapeHtml((error as Error).message)}</div>\n      </div>\n    `\n  }\n}\n\n/**\n * Update file info display\n */\nasync function updateFileInfo(content: HTMLElement, path: string): Promise<void> {\n  // Find file info element within the floating window\n  const fileInfo = content.parentElement?.querySelector('.dm-floating-file-info') as HTMLElement\n  if (!fileInfo) return\n\n  try {\n    const info = await getFileInfo(path)\n    fileInfo.innerHTML = `\n      <div style=\"display: flex; justify-content: space-between; gap: 15px;\">\n        <span>${escapeHtml(info.name)}</span>\n        <span>${formatSize(info.size)}</span>\n      </div>\n    `\n  } catch (error) {\n    fileInfo.innerHTML = '<span style=\"opacity: 0.5;\"></span>'\n  }\n}\n","/**\n * ComfyUI Data Manager - Floating Dock Management\n */\n\nimport { updateStatus } from '../../utils/helpers.js'\nimport { previewFloatingWindows } from '../../core/state.js'\nimport { getComfyTheme } from '../../utils/theme.js'\n\n/**\n * Floating window data interface\n */\nexport interface FloatingWindowData {\n  path: string\n  fileName: string\n  fileConfig: { icon: string; color: string }\n  window: HTMLElement\n  minimized: boolean\n}\n\n/**\n * Update Dock panel\n */\nexport function updateDock(): void {\n  const dock = document.getElementById('dm-preview-dock')\n  if (!dock) return\n\n  const theme = getComfyTheme()\n\n  // Clear Dock\n  dock.innerHTML = ''\n\n  // Get minimized windows\n  const minimizedWindows = (previewFloatingWindows as FloatingWindowData[]).filter(\n    (w) => w.minimized\n  )\n  if (minimizedWindows.length === 0) {\n    ;(dock as HTMLElement).style.minHeight = '0'\n    ;(dock as HTMLElement).style.maxHeight = '0'\n    ;(dock as HTMLElement).style.padding = '0 15px'\n    return\n  }\n\n  // Show Dock\n  ;(dock as HTMLElement).style.minHeight = '60px'\n  ;(dock as HTMLElement).style.maxHeight = '60px'\n  ;(dock as HTMLElement).style.padding = '10px 15px'\n\n  // Add thumbnail for each minimized window\n  minimizedWindows.forEach((w) => {\n    const thumbnail = document.createElement('div')\n    thumbnail.className = 'dm-dock-thumbnail'\n    thumbnail.style.cssText = `\n      width: 80px;\n      height: 50px;\n      background: ${theme.bgSecondary};\n      border: 1px solid ${theme.borderColor};\n      border-radius: 6px;\n      cursor: pointer;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      gap: 4px;\n      transition: all 0.2s;\n    `\n    thumbnail.title = `${w.fileName} - `\n    thumbnail.innerHTML = `\n      <i class=\"pi ${w.fileConfig.icon}\" style=\"color: ${w.fileConfig.color}; font-size: 16px;\"></i>\n      <span style=\"color: ${theme.textSecondary}; font-size: 9px; max-width: 70px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${w.fileName}</span>\n    `\n    thumbnail.onmouseover = () => {\n      ;(thumbnail as HTMLElement).style.background = theme.bgTertiary\n      ;(thumbnail as HTMLElement).style.borderColor = w.fileConfig.color\n    }\n    thumbnail.onmouseout = () => {\n      ;(thumbnail as HTMLElement).style.background = theme.bgSecondary\n      ;(thumbnail as HTMLElement).style.borderColor = theme.borderColor\n    }\n    thumbnail.onclick = () => restoreFloatingPreview(w.window)\n\n    dock.appendChild(thumbnail)\n  })\n}\n\n/**\n * Restore minimized floating preview window\n * @param window - Floating window element\n */\nexport function restoreFloatingPreview(window: HTMLElement): void {\n  ;(window as HTMLElement).style.display = 'flex'\n\n  //  minimized \n  const windowData = (previewFloatingWindows as FloatingWindowData[]).find(\n    (w) => w.window === window\n  )\n  if (windowData) {\n    windowData.minimized = false\n  }\n\n  updateDock()\n}\n","/**\n * ComfyUI Data Manager - Floating Preview Window\n */\n\nimport { FILE_TYPES, LIMITS } from '../../core/constants.js'\nimport { getFileType } from '../../utils/file-type.js'\nimport { setupWindowDrag } from '../../utils/drag.js'\nimport { updateStatus, getExt } from '../../utils/helpers.js'\nimport { loadPreviewContent } from './preview-content.js'\nimport { updateDock } from './dock.js'\nimport { previewFloatingWindows } from '../../core/state.js'\nimport {\n  applyComfyTheme,\n  getComfyTheme,\n  addThemeListener,\n  type ComfyTheme,\n} from '../../utils/theme.js'\nimport type { FloatingWindowData } from './dock.js'\n\n// ==================== Local Constants ====================\nconst DEFAULT_IMAGE_SCALE = 1\nconst DEFAULT_DOC_FONT_SIZE = 13\nconst DEFAULT_CODE_FONT_SIZE = 12\n\n// Font size control limits\nconst FONT_SIZE_MIN = 8\nconst FONT_SIZE_MAX = 32\nconst FONT_SIZE_DISPLAY_MIN_WIDTH = 30\n\n// Icon class names\nconst ICONS = {\n  MINUS: 'pi-minus',\n  PLUS: 'pi-plus',\n  UNDO: 'pi-undo',\n  SEARCH_MINUS: 'pi-search-minus',\n  SEARCH_PLUS: 'pi-search-plus',\n  EXTERNAL_LINK: 'pi-external-link',\n  ARROWS_ALT: 'pi-arrows-alt',\n  VOLUME_UP: 'pi-volume-up',\n  VOLUME_DOWN: 'pi-volume-down',\n  VOLUME_OFF: 'pi-volume-off',\n  PLAY: 'pi-play',\n  PAUSE: 'pi-pause',\n  TIMES: 'pi-times',\n  WINDOW_MAXIMIZE: 'pi-window-maximize',\n} as const\n\n// Button titles\nconst TITLES = {\n  DECREASE_FONT: '',\n  INCREASE_FONT: '',\n  RESET_FONT: '',\n  ZOOM_OUT: '',\n  ZOOM_IN: '',\n  RESET_ZOOM: '',\n  OPEN: '',\n  FULLSCREEN: '',\n  PDF_FULLSCREEN: 'PDF ',\n  DOC_FULLSCREEN: '',\n  VOLUME: '',\n  MUTE: '',\n  PLAY: '',\n  PAUSE: '',\n  CLOSE: '',\n  MINIMIZE: '',\n} as const\n\n// CSS selectors\nconst SELECTORS = {\n  DOCUMENT_CONTENT: '.dm-document-content, .dm-docx-content',\n  CODE_CONTENT: '.dm-code-content',\n} as const\n\n// Display sizes (reserved for future use)\nconst _DISPLAY_SIZES = {\n  TIME_MIN_WIDTH: 80,\n  ZOOM_MIN_WIDTH: 45,\n  SEPARATOR_HEIGHT: 16,\n  SEPARATOR_HEIGHT_LARGE: 20,\n  SEPARATOR_WIDTH: 1,\n} as const\n\n// Font sizes (reserved for future use)\nconst _FONT_SIZES = {\n  TIME_DISPLAY: 11,\n  TOOLBAR: 12,\n  ZOOM_DISPLAY: 13,\n  TRAFFIC_ICON: 10,\n} as const\n\n// Button settings (reserved for future use)\nconst _BUTTON_PADDING = '6px 10px'\nconst _TRAFFIC_BUTTON_SIZE = 14\n\n// Zoom settings (reserved for future use)\nconst _DEFAULT_ZOOM_LEVEL = 100\n\n/**\n * Create floating preview window toolbar button\n */\nfunction createToolbarButton(icon: string, title: string, onClick: () => void): HTMLButtonElement {\n  const theme = getComfyTheme()\n  const button = document.createElement('button')\n  button.className = 'comfy-btn'\n  button.innerHTML = `<i class=\"pi ${icon}\"></i>`\n  button.style.cssText = `padding: 6px 10px; background: transparent; border: none; color: ${theme.textSecondary}; cursor: pointer; border-radius: 4px;`\n  button.title = title\n  button.onmouseover = () => (button.style.background = theme.bgTertiary)\n  button.onmouseout = () => (button.style.background = 'transparent')\n  button.onclick = onClick\n  return button\n}\n\n/**\n * Open floating preview window\n * @param path - File path\n * @param fileName - File name\n */\nexport function openFloatingPreview(path: string, fileName: string): void {\n  // Check if preview window already opened for this file\n  const existingWindow = (previewFloatingWindows as FloatingWindowData[]).find(\n    (w) => w.path === path\n  )\n  if (existingWindow) {\n    existingWindow.window.focus()\n    return\n  }\n\n  const theme = getComfyTheme()\n\n  const ext = getExt(path)\n  const fileType = getFileType({ name: path })\n  const fileConfig = FILE_TYPES[fileType] || FILE_TYPES.unknown\n  const isImage = FILE_TYPES.image.exts.includes(ext)\n  const isVideo = FILE_TYPES.video.exts.includes(ext)\n  const isAudio = FILE_TYPES.audio.exts.includes(ext)\n  const isPDF = ext === '.pdf'\n  const isMarkdown = ext === '.md'\n  const isDocument = isPDF || isMarkdown || FILE_TYPES.document.exts.includes(ext)\n  const isCode = FILE_TYPES.code.exts.includes(ext)\n  const isSpreadsheet = FILE_TYPES.spreadsheet.exts.includes(ext)\n\n  // Create floating preview window\n  const previewWindow = document.createElement('div')\n  previewWindow.id = `dm-preview-${Date.now()}`\n  previewWindow.className = 'dm-floating-preview'\n  previewWindow.style.cssText = `\n    position: fixed;\n    top: 100px;\n    right: 50px;\n    width: 500px;\n    height: 600px;\n    background: ${theme.bgPrimary};\n    border: 1px solid ${theme.borderColor};\n    border-radius: 12px;\n    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n    z-index: ${LIMITS.FLOATING_Z_INDEX};\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n  `\n\n  // Create title bar\n  const header = createPreviewHeader(\n    fileName,\n    fileConfig,\n    isImage,\n    isVideo,\n    isAudio,\n    isDocument,\n    isCode,\n    isSpreadsheet,\n    previewWindow,\n    path\n  )\n  previewWindow.appendChild(header)\n\n  // Create content area\n  const content = document.createElement('div')\n  content.id = `dm-preview-content-${Date.now()}`\n  content.style.cssText = `\n    flex: 1;\n    overflow: auto;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: ${theme.bgPrimary};\n  `\n  previewWindow.appendChild(content)\n\n  // Create toolbar (returns mediaId for image/video/audio files)\n  const { toolbar, mediaId } = createPreviewToolbar(\n    path,\n    ext,\n    isImage,\n    isVideo,\n    isAudio,\n    isPDF,\n    isMarkdown,\n    isCode,\n    isSpreadsheet,\n    content,\n    previewWindow\n  )\n  previewWindow.appendChild(toolbar)\n\n  // Create file info area\n  const fileInfo = document.createElement('div')\n  fileInfo.id = `dm-fileinfo-${Date.now()}`\n  fileInfo.className = 'dm-floating-file-info'\n  fileInfo.style.cssText = `\n    padding: 10px 15px;\n    background: ${theme.bgSecondary};\n    border-top: 1px solid ${theme.borderColor};\n    font-size: 12px;\n    color: ${theme.textSecondary};\n    text-align: center;\n  `\n  fileInfo.innerHTML = '<span style=\"opacity: 0.5;\">...</span>'\n  previewWindow.appendChild(fileInfo)\n\n  document.body.appendChild(previewWindow)\n\n  // Apply ComfyUI theme\n  applyComfyTheme()\n\n  // Setup drag\n  setupWindowDrag(previewWindow, header)\n\n  // Store window reference\n  const windowData: FloatingWindowData = {\n    path: path,\n    fileName: fileName,\n    fileConfig: fileConfig,\n    window: previewWindow,\n    minimized: false,\n  }\n  ;(previewFloatingWindows as FloatingWindowData[]).push(windowData)\n\n  // Load content (pass mediaId for image/video/audio files)\n  void loadPreviewContent(content, path, ext, DEFAULT_IMAGE_SCALE, mediaId)\n\n  updateStatus(`: ${fileName}`)\n}\n\n/**\n * Create preview window title bar\n */\nfunction createPreviewHeader(\n  fileName: string,\n  fileConfig: { icon: string; color: string },\n  isImage: boolean,\n  isVideo: boolean,\n  isAudio: boolean,\n  isDocument: boolean,\n  isCode: boolean,\n  isSpreadsheet: boolean,\n  previewWindow: HTMLElement,\n  path: string\n): HTMLElement {\n  const theme = getComfyTheme()\n  const textColor = theme.isLight ? '#222' : '#fff'\n\n  const header = document.createElement('div')\n  header.className = 'dm-preview-header'\n  header.style.cssText = `\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px 15px;\n    background: linear-gradient(135deg, ${theme.bgSecondary} 0%, ${theme.bgPrimary} 100%);\n    border-bottom: 1px solid ${theme.borderColor};\n    cursor: move;\n    user-select: none;\n  `\n\n  // macOS traffic lights\n  const trafficLights = document.createElement('div')\n  trafficLights.className = 'dm-traffic-lights'\n  trafficLights.style.cssText = 'display: flex; gap: 8px;'\n\n  // Close button\n  const closeBtn = createTrafficLightButton('pi-times', textColor, '', () =>\n    closeFloatingPreview(previewWindow)\n  )\n  trafficLights.appendChild(closeBtn)\n\n  // Minimize button\n  const minimizeBtn = createTrafficLightButton('pi-minus', textColor, '', () =>\n    minimizeFloatingPreview(previewWindow, path, fileName, fileConfig)\n  )\n  trafficLights.appendChild(minimizeBtn)\n\n  // Fullscreen button - for image, video, audio, document, code, spreadsheet files\n  // Note: Video has two fullscreen buttons: one here (window fullscreen) and one in toolbar (video element fullscreen)\n  if (isImage || isVideo || isAudio || isDocument || isCode || isSpreadsheet) {\n    const fullscreenBtn = createTrafficLightButton('pi-window-maximize', textColor, '', () =>\n      toggleFullscreen(previewWindow)\n    )\n    trafficLights.appendChild(fullscreenBtn)\n  }\n\n  header.appendChild(trafficLights)\n\n  // Title area\n  const title = document.createElement('div')\n  title.className = 'dm-header-title-area'\n  title.style.cssText =\n    'display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; flex: 1; justify-content: center;'\n  title.innerHTML = `\n    <i class=\"pi ${fileConfig.icon}\" style=\"color: ${fileConfig.color};\"></i>\n    <span style=\"max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${fileName}</span>\n  `\n\n  header.appendChild(title)\n\n  // Register theme change listener\n  addThemeListener((newTheme: ComfyTheme) => {\n    const newTextColor = newTheme.isLight ? '#222' : '#fff'\n    header.style.background = `linear-gradient(135deg, ${newTheme.bgSecondary} 0%, ${newTheme.bgPrimary} 100%)`\n    header.style.borderColor = newTheme.borderColor\n    title.style.color = newTextColor\n\n    // Update button colors\n    const btns = header.querySelectorAll('.dm-traffic-btn')\n    btns.forEach((btn) => {\n      (btn as HTMLElement).style.color = newTextColor\n    })\n  })\n\n  return header\n}\n\n/**\n * Create traffic light button (macOS style)\n */\nfunction createTrafficLightButton(\n  icon: string,\n  textColor: string,\n  title: string,\n  onClick: () => void\n): HTMLElement {\n  const button = document.createElement('button')\n  button.className = 'comfy-btn dm-traffic-btn'\n  button.innerHTML = `<i class=\"pi ${icon}\" style=\"font-size: 10px; color: ${textColor};\"></i>`\n  button.style.cssText = `\n    width: 14px;\n    height: 14px;\n    padding: 0px;\n    background: transparent;\n    border: none;\n    cursor: pointer;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: 0.15s;\n  `\n  button.title = title\n\n  button.onclick = (e) => {\n    e.stopPropagation()\n    onClick()\n  }\n\n  return button\n}\n\n/**\n * Font size control configuration\n */\ninterface FontSizeConfig {\n  defaultSize: number\n  minSize: number\n  maxSize: number\n  selector: string\n}\n\n/**\n * Add font size controls to toolbar (unified for document and code)\n */\nfunction addFontSizeControls(\n  toolbarLeft: HTMLElement,\n  content: HTMLElement,\n  config: FontSizeConfig,\n  createToolbarButton: (icon: string, title: string, onClick: () => void) => HTMLElement,\n  createToolbarSeparator: () => HTMLElement\n): void {\n  const theme = getComfyTheme()\n  let fontSize = config.defaultSize\n\n  toolbarLeft.appendChild(createToolbarSeparator())\n\n  const fontDownBtn = createToolbarButton(ICONS.MINUS, TITLES.DECREASE_FONT, () => {\n    fontSize = Math.max(config.minSize, fontSize - 1)\n    updateFontSize()\n  })\n  toolbarLeft.appendChild(fontDownBtn)\n\n  const fontDisplay = document.createElement('span')\n  fontDisplay.style.cssText = `min-width: ${FONT_SIZE_DISPLAY_MIN_WIDTH}px; text-align: center; color: ${theme.textSecondary};`\n  fontDisplay.textContent = fontSize.toString()\n  toolbarLeft.appendChild(fontDisplay)\n\n  const fontUpBtn = createToolbarButton(ICONS.PLUS, TITLES.INCREASE_FONT, () => {\n    fontSize = Math.min(config.maxSize, fontSize + 1)\n    updateFontSize()\n  })\n  toolbarLeft.appendChild(fontUpBtn)\n\n  const resetBtn = createToolbarButton(ICONS.UNDO, TITLES.RESET_FONT, () => {\n    fontSize = config.defaultSize\n    updateFontSize()\n  })\n  toolbarLeft.appendChild(resetBtn)\n\n  function updateFontSize(): void {\n    fontDisplay.textContent = fontSize.toString()\n    const targetElement = content.querySelector(config.selector)\n    if (targetElement) {\n      (targetElement as HTMLElement).style.fontSize = `${fontSize}px`\n    }\n  }\n}\n\n/**\n * Add media controls to toolbar (video/audio)\n */\nfunction addMediaControls(\n  toolbarRight: HTMLElement,\n  content: HTMLElement,\n  path: string,\n  isVideo: boolean,\n  createToolbarButton: (icon: string, title: string, onClick: () => void) => HTMLElement,\n  createToolbarSeparator: () => HTMLElement,\n  previewWindow: HTMLElement,\n  mediaId: string\n): void {\n  const theme = getComfyTheme()\n  const mediaElement = content.querySelector(`#${mediaId}`) as HTMLVideoElement | HTMLAudioElement\n  if (!mediaElement) {\n    // Retry after a short delay if media element not found yet\n    setTimeout(\n      () =>\n        addMediaControls(\n          toolbarRight,\n          content,\n          path,\n          isVideo,\n          createToolbarButton,\n          createToolbarSeparator,\n          previewWindow,\n          mediaId\n        ),\n      50\n    )\n    return\n  }\n\n  // Time display\n  const timeDisplay = document.createElement('span')\n  timeDisplay.className = 'dm-media-time'\n  timeDisplay.style.cssText = `min-width: 80px; text-align: center; color: ${theme.textSecondary}; font-size: 11px; font-family: monospace;`\n  timeDisplay.textContent = '0:00 / 0:00'\n  timeDisplay.id = `${mediaId}-time`\n  toolbarRight.appendChild(timeDisplay)\n\n  toolbarRight.appendChild(createToolbarSeparator())\n\n  // Volume button\n  const volumeBtn = createToolbarButton('pi-volume-up', '', () => {\n    if (mediaElement.muted) {\n      mediaElement.muted = false\n      volumeBtn.innerHTML = '<i class=\"pi pi-volume-up\"></i>'\n      volumeBtn.title = ''\n    } else {\n      mediaElement.muted = true\n      volumeBtn.innerHTML = '<i class=\"pi pi-volume-off\"></i>'\n      volumeBtn.title = ''\n    }\n  })\n  toolbarRight.appendChild(volumeBtn)\n\n  mediaElement.addEventListener('volumechange', () => {\n    if (mediaElement.muted || mediaElement.volume === 0) {\n      volumeBtn.innerHTML = '<i class=\"pi pi-volume-off\"></i>'\n    } else if (mediaElement.volume < 0.5) {\n      volumeBtn.innerHTML = '<i class=\"pi pi-volume-down\"></i>'\n    } else {\n      volumeBtn.innerHTML = '<i class=\"pi pi-volume-up\"></i>'\n    }\n  })\n\n  toolbarRight.appendChild(createToolbarSeparator())\n\n  // Play/Pause button\n  const playPauseBtn = createToolbarButton('pi-play', '', () => {\n    if (mediaElement.paused) {\n      mediaElement\n        .play()\n        .then(() => {\n          playPauseBtn.innerHTML = '<i class=\"pi pi-pause\"></i>'\n          playPauseBtn.title = ''\n        })\n        .catch((err: Error) => console.error('[DataManager] :', err))\n    } else {\n      mediaElement.pause()\n      playPauseBtn.innerHTML = '<i class=\"pi pi-play\"></i>'\n      playPauseBtn.title = ''\n    }\n  })\n  toolbarRight.appendChild(playPauseBtn)\n\n  mediaElement.addEventListener('play', () => {\n    playPauseBtn.innerHTML = '<i class=\"pi pi-pause\"></i>'\n    playPauseBtn.title = ''\n  })\n\n  mediaElement.addEventListener('pause', () => {\n    playPauseBtn.innerHTML = '<i class=\"pi pi-play\"></i>'\n    playPauseBtn.title = ''\n  })\n\n  // Format time helper\n  function formatTime(seconds: number): string {\n    if (isNaN(seconds)) return '0:00'\n    const mins = Math.floor(seconds / 60)\n    const secs = Math.floor(seconds % 60)\n    return `${mins}:${secs.toString().padStart(2, '0')}`\n  }\n\n  // Update time display\n  mediaElement.addEventListener('loadedmetadata', () => {\n    timeDisplay.textContent = `0:00 / ${formatTime(mediaElement.duration)}`\n  })\n\n  mediaElement.addEventListener('timeupdate', () => {\n    timeDisplay.textContent = `${formatTime(mediaElement.currentTime)} / ${formatTime(mediaElement.duration || 0)}`\n  })\n\n  // Video fullscreen button (use window fullscreen, not video element fullscreen)\n  if (isVideo) {\n    toolbarRight.appendChild(createToolbarSeparator())\n    const videoFullscreenBtn = createToolbarButton('pi-arrows-alt', '', () => {\n      toggleFullscreen(previewWindow)\n    })\n    toolbarRight.appendChild(videoFullscreenBtn)\n  }\n\n  // Open button (for media files)\n  toolbarRight.appendChild(createToolbarSeparator())\n  const openBtn = createToolbarButton('pi-external-link', '', () => {\n    window.open(`/dm/preview?path=${encodeURIComponent(path)}`, '_blank')\n  })\n  toolbarRight.appendChild(openBtn)\n}\n\n/**\n * Create preview toolbar\n * Returns { toolbar, mediaId } - mediaId is set for image/video/audio files to be used by loadPreviewContent\n */\nfunction createPreviewToolbar(\n  path: string,\n  ext: string,\n  isImage: boolean,\n  isVideo: boolean,\n  isAudio: boolean,\n  isPDF: boolean,\n  isMarkdown: boolean,\n  isCode: boolean,\n  isSpreadsheet: boolean,\n  content: HTMLElement,\n  previewWindow: HTMLElement\n): { toolbar: HTMLElement; mediaId?: string } {\n  const theme = getComfyTheme()\n  const toolbar = document.createElement('div')\n  toolbar.className = 'dm-preview-toolbar'\n  toolbar.style.cssText = `\n    padding: 12px 16px;\n    background: linear-gradient(to bottom, ${theme.bgTertiary}, ${theme.bgSecondary});\n    border-top: 1px solid ${theme.borderColor};\n    display: flex;\n    align-items: center;\n    font-size: 12px;\n    color: ${theme.textSecondary};\n  `\n\n  // Three-section structure\n  const toolbarLeft = document.createElement('div')\n  toolbarLeft.style.cssText = 'display: flex; gap: 8px; align-items: center; flex-shrink: 0;'\n\n  const toolbarCenter = document.createElement('div')\n  toolbarCenter.style.cssText = 'flex: 1; text-align: center; overflow: hidden; padding: 0 20px;'\n\n  const toolbarRight = document.createElement('div')\n  toolbarRight.style.cssText = 'display: flex; gap: 8px; align-items: center; flex-shrink: 0;'\n\n  // Helper: Create toolbar separator\n  function createToolbarSeparator(): HTMLElement {\n    const separator = document.createElement('div')\n    separator.style.cssText = `width: 1px; height: 16px; background: ${theme.borderColor}; margin: 0 4px;`\n    return separator\n  }\n\n  // ===== Left Section: Control Buttons =====\n\n  // Image zoom controls (left side)\n  if (isImage) {\n    toolbarLeft.appendChild(createToolbarSeparator())\n    // Note: Image has built-in controls in content, so minimal toolbar needed\n  }\n\n  // Document font size controls (txt/rtf/md/docx)\n  if (ext === '.txt' || ext === '.rtf' || ext === '.md' || ext === '.docx') {\n    addFontSizeControls(toolbarLeft, content, {\n      defaultSize: DEFAULT_DOC_FONT_SIZE,\n      minSize: FONT_SIZE_MIN,\n      maxSize: FONT_SIZE_MAX,\n      selector: SELECTORS.DOCUMENT_CONTENT,\n    }, createToolbarButton, createToolbarSeparator)\n  }\n\n  // Code font size controls\n  if (isCode) {\n    addFontSizeControls(toolbarLeft, content, {\n      defaultSize: DEFAULT_CODE_FONT_SIZE,\n      minSize: FONT_SIZE_MIN,\n      maxSize: FONT_SIZE_MAX,\n      selector: SELECTORS.CODE_CONTENT,\n    }, createToolbarButton, createToolbarSeparator)\n  }\n\n  // ===== Center Section: File Path =====\n  const filePath = document.createElement('div')\n  filePath.className = 'dm-file-path'\n  filePath.style.cssText = `overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: ${theme.textSecondary};`\n  filePath.textContent = path\n  filePath.title = path\n  toolbarCenter.appendChild(filePath)\n\n  // ===== Right Section: Media Controls & Actions =====\n  toolbarRight.appendChild(createToolbarSeparator())\n\n  let mediaId: string | undefined\n\n  // Image zoom controls\n  if (isImage) {\n    // Generate mediaId here (before loadPreviewContent is called)\n    mediaId = `dm-floating-image-${Date.now()}`\n    setupImageToolbarControls(\n      toolbarRight,\n      mediaId,\n      content,\n      path,\n      createToolbarButton,\n      createToolbarSeparator\n    )\n  }\n  // Video/Audio playback controls\n  else if (isVideo || isAudio) {\n    // Generate mediaId here (before loadPreviewContent is called)\n    mediaId = isVideo ? `dm-preview-video-${Date.now()}` : `dm-preview-audio-${Date.now()}`\n    addMediaControls(\n      toolbarRight,\n      content,\n      path,\n      isVideo,\n      createToolbarButton,\n      createToolbarSeparator,\n      previewWindow,\n      mediaId\n    )\n  } else {\n    // Open button for non-media files\n    const openBtn = createToolbarButton('pi-external-link', '', () => {\n      window.open(`/dm/preview?path=${encodeURIComponent(path)}`, '_blank')\n    })\n    toolbarRight.appendChild(openBtn)\n  }\n\n  // PDF fullscreen button\n  if (isPDF) {\n    toolbarRight.appendChild(createToolbarSeparator())\n    const pdfFullscreenBtn = createToolbarButton('pi-arrows-alt', 'PDF ', () => {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call\n      const embed = document.getElementById('dm-floating-pdf-embed') as HTMLElement & {\n        requestFullscreen?: () => Promise<void>\n        webkitRequestFullscreen?: () => void\n      }\n      if (embed && embed.requestFullscreen) {\n        void embed\n          .requestFullscreen()\n          .catch((err: Error) => console.error('[DataManager] PDF :', err))\n      } else if (embed && embed.webkitRequestFullscreen) {\n        void embed.webkitRequestFullscreen()\n      }\n    })\n    toolbarRight.appendChild(pdfFullscreenBtn)\n  }\n\n  // Markdown/Txt/RTF fullscreen button\n  if (ext === '.md' || ext === '.txt' || ext === '.rtf') {\n    toolbarRight.appendChild(createToolbarSeparator())\n    const docFullscreenBtn = createToolbarButton('pi-arrows-alt', '', () =>\n      toggleFullscreen(previewWindow)\n    )\n    toolbarRight.appendChild(docFullscreenBtn)\n  }\n\n  // Code fullscreen button\n  if (isCode) {\n    toolbarRight.appendChild(createToolbarSeparator())\n    const codeFullscreenBtn = createToolbarButton('pi-arrows-alt', '', () =>\n      toggleFullscreen(previewWindow)\n    )\n    toolbarRight.appendChild(codeFullscreenBtn)\n  }\n\n  // Spreadsheet fullscreen button\n  if (isSpreadsheet) {\n    toolbarRight.appendChild(createToolbarSeparator())\n    const spreadsheetFullscreenBtn = createToolbarButton('pi-arrows-alt', '', () =>\n      toggleFullscreen(previewWindow)\n    )\n    toolbarRight.appendChild(spreadsheetFullscreenBtn)\n  }\n\n  // Assemble toolbar\n  toolbar.appendChild(toolbarLeft)\n  toolbar.appendChild(toolbarCenter)\n  toolbar.appendChild(toolbarRight)\n\n  return { toolbar, mediaId }\n}\n\n/**\n * Format time in MM:SS format\n */\nfunction formatTime(seconds: number): string {\n  const mins = Math.floor(seconds / 60)\n  const secs = Math.floor(seconds % 60)\n  return `${mins}:${secs.toString().padStart(2, '0')}`\n}\n\n/**\n * Setup video controls in toolbar\n */\nexport function setupVideoToolbarControls(\n  toolbar: HTMLElement,\n  videoId: string,\n  content: HTMLElement,\n  videoPath: string\n): void {\n  const theme = getComfyTheme()\n  // Find video element within content\n  const video = content.querySelector(`#${videoId}`) as HTMLVideoElement\n  if (!video) {\n    // Retry after a short delay if video not found yet\n    setTimeout(() => setupVideoToolbarControls(toolbar, videoId, content, videoPath), 50)\n    return\n  }\n\n  // Clear toolbar and add video controls\n  toolbar.innerHTML = ''\n\n  // Play/Pause button\n  const playBtn = createToolbarButton('pi-play', '', () => {\n    if (video.paused) {\n      void video.play().then(() => {\n        playBtn.innerHTML = '<i class=\"pi pi-pause\"></i>'\n        playBtn.title = ''\n      }).catch((err: Error) => console.error('[DataManager] :', err))\n    } else {\n      video.pause()\n      playBtn.innerHTML = '<i class=\"pi pi-play\"></i>'\n      playBtn.title = ''\n    }\n  })\n  toolbar.appendChild(playBtn)\n\n  // Time display\n  const timeDisplay = document.createElement('span')\n  timeDisplay.id = `${videoId}-time`\n  timeDisplay.className = 'dm-video-time-display'\n  timeDisplay.style.cssText = `min-width: 80px; text-align: center; font-size: 12px; color: ${theme.textSecondary};`\n  timeDisplay.textContent = '0:00 / 0:00'\n  toolbar.appendChild(timeDisplay)\n\n  // Volume button\n  const volumeBtn = createToolbarButton('pi-volume-up', '', () => {\n    video.muted = !video.muted\n    volumeBtn.innerHTML = video.muted\n      ? '<i class=\"pi pi-volume-off\"></i>'\n      : '<i class=\"pi pi-volume-up\"></i>'\n    volumeBtn.title = video.muted ? '' : ''\n  })\n  toolbar.appendChild(volumeBtn)\n\n  // Fullscreen button\n  const fullscreenBtn = createToolbarButton('pi-arrows-alt', '', () => {\n    if (video.requestFullscreen) {\n      void video.requestFullscreen().catch((err: Error) => console.error('[DataManager] :', err))\n    }\n  })\n  toolbar.appendChild(fullscreenBtn)\n\n  // Setup event listeners\n  video.addEventListener('play', () => {\n    playBtn.innerHTML = '<i class=\"pi pi-pause\"></i>'\n    playBtn.title = ''\n  })\n\n  video.addEventListener('pause', () => {\n    playBtn.innerHTML = '<i class=\"pi pi-play\"></i>'\n    playBtn.title = ''\n  })\n\n  video.addEventListener('timeupdate', () => {\n    const current = formatTime(video.currentTime)\n    const duration = formatTime(video.duration)\n    timeDisplay.textContent = `${current} / ${duration}`\n  })\n\n  // Open button (separated by spacer)\n  const spacer = document.createElement('div')\n  spacer.style.cssText = `width: 1px; height: 20px; background: ${theme.borderColor}; margin: 0 5px;`\n  toolbar.appendChild(spacer)\n\n  const openBtn = createToolbarButton('pi-external-link', '', () => {\n    window.open(`/dm/preview?path=${encodeURIComponent(videoPath)}`, '_blank')\n  })\n  toolbar.appendChild(openBtn)\n}\n\n/**\n * Setup image zoom controls in toolbar\n */\nexport function setupImageToolbarControls(\n  toolbarRight: HTMLElement,\n  imageId: string,\n  content: HTMLElement,\n  imagePath: string,\n  createToolbarButton: (icon: string, title: string, onClick: () => void) => HTMLButtonElement,\n  createToolbarSeparator: () => HTMLElement\n): void {\n  const theme = getComfyTheme()\n  // Find image element within content\n  const image = content.querySelector(`#${imageId}`) as HTMLImageElement\n  if (!image) {\n    // Retry after a short delay if image not found yet\n    setTimeout(\n      () =>\n        setupImageToolbarControls(\n          toolbarRight,\n          imageId,\n          content,\n          imagePath,\n          createToolbarButton,\n          createToolbarSeparator\n        ),\n      50\n    )\n    return\n  }\n\n  let zoom = 100\n  let imageTranslateX = 0\n  let imageTranslateY = 0\n\n  // Create zoom level display\n  const zoomDisplay = document.createElement('span')\n  zoomDisplay.id = `${imageId}-zoom`\n  zoomDisplay.className = 'dm-zoom-level'\n  zoomDisplay.style.cssText = `min-width: 45px; text-align: center; font-size: 13px; color: ${theme.textSecondary};`\n  zoomDisplay.textContent = '100%'\n  toolbarRight.appendChild(zoomDisplay)\n\n  function updateZoom(): void {\n    const scale = zoom / 100\n    image.style.transform = `translate(${imageTranslateX}px, ${imageTranslateY}px) scale(${scale})`\n    zoomDisplay.textContent = `${zoom}%`\n\n    // Remove max-width/max-height constraints when zoomed in\n    if (zoom > 100) {\n      image.style.maxWidth = 'none'\n      image.style.maxHeight = 'none'\n    } else {\n      image.style.maxWidth = '100%'\n      image.style.maxHeight = '100%'\n    }\n  }\n\n  // Zoom out button\n  const zoomOutBtn = createToolbarButton('pi-search-minus', '', () => {\n    zoom = Math.max(zoom - LIMITS.DEFAULT_ZOOM_STEP, LIMITS.MIN_ZOOM_DISPLAY)\n    updateZoom()\n  })\n  toolbarRight.appendChild(zoomOutBtn)\n\n  // Zoom in button\n  const zoomInBtn = createToolbarButton('pi-search-plus', '', () => {\n    zoom = Math.min(zoom + LIMITS.DEFAULT_ZOOM_STEP, LIMITS.MAX_ZOOM_DISPLAY)\n    updateZoom()\n  })\n  toolbarRight.appendChild(zoomInBtn)\n\n  // Reset button\n  const resetBtn = createToolbarButton('pi-undo', '', () => {\n    zoom = 100\n    imageTranslateX = 0\n    imageTranslateY = 0\n    updateZoom()\n  })\n  toolbarRight.appendChild(resetBtn)\n\n  // Separator\n  toolbarRight.appendChild(createToolbarSeparator())\n\n  // Open button\n  const openBtn = createToolbarButton('pi-external-link', '', () => {\n    window.open(`/dm/preview?path=${encodeURIComponent(imagePath)}`, '_blank')\n  })\n  toolbarRight.appendChild(openBtn)\n\n  // Mouse wheel zoom\n  const container = image.parentElement\n  if (container) {\n    container.addEventListener(\n      'wheel',\n      (e) => {\n        e.preventDefault()\n        const delta = e.deltaY > 0 ? -LIMITS.DEFAULT_ZOOM_STEP : LIMITS.DEFAULT_ZOOM_STEP\n        zoom = Math.max(LIMITS.MIN_ZOOM_DISPLAY, Math.min(LIMITS.MAX_ZOOM_DISPLAY, zoom + delta))\n        updateZoom()\n      },\n      { passive: false }\n    )\n  }\n\n  // Image drag (pan)\n  let isDraggingImage = false\n  let dragStart = { x: 0, y: 0 }\n\n  image.addEventListener('mousedown', (e) => {\n    if (zoom <= 100) return\n    isDraggingImage = true\n    dragStart = { x: e.clientX - imageTranslateX, y: e.clientY - imageTranslateY }\n    image.style.cursor = 'grabbing'\n  })\n\n  document.addEventListener('mousemove', (e) => {\n    if (!isDraggingImage) return\n    imageTranslateX = e.clientX - dragStart.x\n    imageTranslateY = e.clientY - dragStart.y\n    updateZoom()\n  })\n\n  document.addEventListener('mouseup', () => {\n    if (isDraggingImage) {\n      isDraggingImage = false\n      image.style.cursor = 'grab'\n    }\n  })\n}\n\n/**\n * Close floating preview window\n */\nfunction closeFloatingPreview(window: HTMLElement): void {\n  // Remove from floating windows array\n  const idx = (previewFloatingWindows as FloatingWindowData[]).findIndex((w) => w.window === window)\n  if (idx > -1) {\n    (previewFloatingWindows as FloatingWindowData[]).splice(idx, 1)\n  }\n\n  // Remove window element\n  window.remove()\n\n  // Update dock\n  updateDock()\n}\n\n/**\n * Minimize floating preview window\n */\nfunction minimizeFloatingPreview(\n  window: HTMLElement,\n  _path: string,\n  _fileName: string,\n  _fileConfig: { icon: string; color: string }\n): void {\n  const windowData = (previewFloatingWindows as FloatingWindowData[]).find(\n    (w) => w.window === window\n  )\n  if (windowData) {\n    windowData.minimized = true\n  }\n  window.style.display = 'none'\n\n  // Update dock\n  updateDock()\n}\n\n/**\n * Toggle fullscreen for floating window\n */\nfunction toggleFullscreen(window: HTMLElement): void {\n  if (window.dataset.fullscreen === 'true') {\n    window.dataset.fullscreen = 'false'\n    window.style.top = '100px'\n    window.style.right = '50px'\n    window.style.width = '500px'\n    window.style.height = '600px'\n  } else {\n    window.dataset.fullscreen = 'true'\n    window.style.top = '0'\n    window.style.right = '0'\n    window.style.width = '100vw'\n    window.style.height = '100vh'\n    window.style.borderRadius = '0'\n  }\n}\n","/**\n * ComfyUI Data Manager - Extension Entry Point\n *\n * Features:\n * - File manager UI interface\n * - File preview (document/image/audio/video)\n * - File operations (create/delete/rename/copy path)\n * - Sort and view toggle\n */\n\n// @ts-ignore - ComfyUI provides this module at runtime\nimport { app } from '../../scripts/app.js'\n\n// Import core modules\nimport {\n  FileManagerState,\n  saveLastPath,\n  getLastPath,\n  saveViewMode,\n  getViewMode,\n} from './core/state.js'\n\n// Import UI modules\nimport {\n  createFileManagerWindow,\n  destroyFileManagerWindow,\n  type WindowManagerCallbacks,\n} from './ui/main-window.js'\nimport { loadDirectory, toggleSort, navigateUp, navigateHome } from './ui/components/actions.js'\nimport { checkNodeConnectionAndUpdateFormat } from './ui/components/preview.js'\n\n// Import API modules\nimport {\n  createFile as apiCreateFile,\n  createDirectory as apiCreateDirectory,\n  deleteFile as apiDeleteFile,\n} from './api/endpoints/file.js'\n\n// Import floating window modules\nimport { openFloatingPreview } from './ui/floating/window.js'\n\n// Import utility functions\nimport { updateStatus, showToast, getParentPath, getExt, getFileName } from './utils/helpers.js'\nimport {\n  applyComfyTheme,\n  initThemeSystem,\n  getComfyTheme,\n  addThemeListener,\n  type ComfyTheme,\n} from './utils/theme.js'\n\n// ==================== Constants ====================\nconst MIN_NODE_VERSION = 2\n\n// Detect Node version (safe detection)\nconst IS_NODE_V3 =\n  typeof (app as { ui?: { version?: { major?: number } } }).ui !== 'undefined' &&\n  (app as { ui?: { version?: { major?: number } } }).ui !== null &&\n  (app as { ui: { version?: { major?: number } } }).ui?.version &&\n  typeof (app as { ui: { version: { major?: number } } }).ui.version === 'object' &&\n  (app as { ui: { version: { major?: number } } }).ui.version.major &&\n  (app as { ui: { version: { major: number } } }).ui.version.major >= MIN_NODE_VERSION\n\nconsole.log(`[DataManager] Extension loading, Node V${IS_NODE_V3 ? '3' : '1'} detected`)\n\n// Global variable reference\nlet fileManagerWindow: HTMLElement | null = null\n\n// ============================================\n// Extension Configuration\n// ============================================\nconst extensionConfig = {\n  name: 'ComfyUI.DataManager',\n\n  commands: [\n    {\n      id: 'data-manager.open',\n      label: 'Open Data Manager',\n      icon: 'pi pi-folder-open',\n      function: () => openFileManager(),\n    },\n  ],\n\n  keybindings: [{ combo: { key: 'd', ctrl: true, shift: true }, commandId: 'data-manager.open' }],\n\n  // Action bar button\n  actionBarButtons: [\n    {\n      icon: 'pi pi-folder',\n      tooltip: ' (Ctrl+Shift+D)',\n      class: 'dm-actionbar-btn',\n      onClick: () => openFileManager(),\n    },\n  ],\n\n  async setup() {\n    // Export FileManagerState to global window object\n    ;(window as unknown as { FileManagerState: typeof FileManagerState }).FileManagerState =\n      FileManagerState\n\n    // CRITICAL: Apply theme BEFORE injecting CSS to avoid flicker\n    applyComfyTheme()\n\n    // Inject official-style button styles\n    const style = document.createElement('style')\n    style.textContent = `\n      .dm-actionbar-btn {\n        width: 32px !important;\n        height: 32px !important;\n        border: none !important;\n        border-radius: 6px !important;\n        background: var(--dm-bg-tertiary, #f0f0f0) !important;\n        color: var(--dm-text-primary, #222222) !important;\n        margin-right: 0.5rem !important;\n        transition: all 0.2s ease !important;\n      }\n      .dm-actionbar-btn:hover {\n        background: var(--dm-bg-hover, #e0e0e0) !important;\n      }\n      .dm-actionbar-btn i {\n        color: var(--dm-text-primary, #222222) !important;\n      }\n    `\n    document.head.appendChild(style)\n\n    // Apply theme immediately and repeatedly until successful\n    const ensureThemeApplied = () => {\n      try {\n        applyComfyTheme()\n        // Verify CSS variables are set\n        const root = document.documentElement\n        const bgTertiary = root.style.getPropertyValue('--dm-bg-tertiary')\n        if (bgTertiary) {\n          // console.log('[DataManager] Theme CSS variables applied:', bgTertiary);\n        }\n      } catch (e) {\n        console.warn('[DataManager] Theme apply error:', e)\n      }\n    }\n\n    // Apply immediately\n    ensureThemeApplied()\n\n    // Also apply on next tick (in case DOM wasn't ready)\n    setTimeout(ensureThemeApplied, 0)\n    setTimeout(ensureThemeApplied, 100)\n    setTimeout(ensureThemeApplied, 500)\n\n    // Simplified position fix function\n    const fixPosition = () => {\n      const dmBtn = document.querySelector('.dm-actionbar-btn')\n      const queueBtn = Array.from(document.querySelectorAll('button')).find(\n        (b) => b.getAttribute('aria-label') === 'Expand job queue'\n      )\n\n      if (!dmBtn || !queueBtn) return false\n\n      // CRITICAL: Re-apply theme when button is found (handles refresh/reload)\n      applyComfyTheme()\n\n      const queueParent = queueBtn.parentElement\n      const prevSibling = queueBtn.previousElementSibling\n\n      // Only move when button is not in correct position\n      if (prevSibling !== dmBtn || dmBtn.parentElement !== queueParent) {\n        queueParent!.insertBefore(dmBtn, queueBtn)\n        // console.log('[DataManager] Button position fixed');\n        return true\n      }\n      return false\n    }\n\n    // Use more comprehensive listener strategy\n    let lastCall = 0\n    const observer = new MutationObserver((mutations) => {\n      const now = Date.now()\n      if (now - lastCall < 100) return\n      lastCall = now\n\n      // Check for relevant DOM changes\n      const hasRelevantChange = mutations.some((m) => {\n        if (m.type === 'childList') {\n          for (const node of m.addedNodes) {\n            if (node.nodeType === 1) {\n              const el = node as Element\n              if (\n                el.classList?.contains('actionbar-container') ||\n                el.classList?.contains('dm-actionbar-btn') ||\n                el.querySelector?.('.dm-actionbar-btn') ||\n                el.querySelector?.('[aria-label=\"Expand job queue\"]')\n              ) {\n                return true\n              }\n            }\n          }\n        }\n        if ((m.target as Element).closest?.('.actionbar-container')) {\n          return true\n        }\n        return false\n      })\n\n      if (hasRelevantChange) {\n        requestAnimationFrame(fixPosition)\n      }\n    })\n\n    // Observe entire body\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true,\n    })\n\n    // Periodic position check (as fallback)\n    setInterval(() => {\n      fixPosition()\n    }, 2000)\n\n    console.log('[DataManager] Extension setup completed')\n\n    // Initialize theme system\n    initThemeSystem()\n\n    // Add theme listener to update node buttons when theme changes\n    addThemeListener((theme: ComfyTheme) => {\n      // Update all node buttons\n      document.querySelectorAll('.dm-node-open-btn').forEach((btn) => {\n        const button = btn as HTMLButtonElement\n        button.style.background = theme.bgTertiary\n        button.style.borderColor = theme.borderColor\n        button.style.color = theme.textPrimary\n        // console.log('[DataManager] Node button theme updated');\n      })\n    })\n  },\n\n  async nodeCreated(node: unknown) {\n    const nodeObj = node as {\n      comfyClass?: string\n      addDOMWidget?: (\n        name: string,\n        type: string,\n        elem: HTMLElement,\n        options?: { minWidth?: number; minHeight?: number }\n      ) => void\n    }\n    if (nodeObj.comfyClass === 'DataManagerCore') {\n      // console.log(\"[DataManager] DataManagerCore node created, IS_NODE_V3:\", IS_NODE_V3);\n\n      // V1/V3 API both use addDOMWidget to add button\n      if (nodeObj.addDOMWidget) {\n        // Ensure theme is applied before creating button\n        applyComfyTheme()\n        const theme = getComfyTheme()\n        const container = document.createElement('div')\n        container.style.cssText = `\n          display: flex;\n          justify-content: center;\n          padding: 10px;\n        `\n\n        const button = document.createElement('button')\n        button.className = 'comfy-btn dm-node-open-btn'\n        button.innerHTML = '<i class=\"pi pi-folder-open\"></i> '\n        button.style.cssText = `\n          padding: 12px 24px;\n          font-size: 14px;\n          background: ${theme.bgTertiary};\n          border: 1px solid ${theme.borderColor};\n          border-radius: 8px;\n          color: ${theme.textPrimary};\n          cursor: pointer;\n          transition: all 0.2s;\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n        `\n        button.onmouseover = () => {\n          button.style.background = theme.bgSecondary\n          button.style.transform = 'translateY(-1px)'\n          button.style.borderColor = theme.accentColor\n          button.style.boxShadow = `0 4px 8px rgba(0, 0, 0, 0.3)`\n        }\n        button.onmouseout = () => {\n          button.style.background = theme.bgTertiary\n          button.style.transform = 'translateY(0)'\n          button.style.borderColor = theme.borderColor\n          button.style.boxShadow = `0 2px 4px rgba(0, 0, 0, 0.2)`\n        }\n        button.onclick = (e) => {\n          e.stopPropagation()\n          openFileManager()\n        }\n\n        container.appendChild(button)\n        nodeObj.addDOMWidget('dm_open_btn', 'dm_open_btn', container, {\n          minWidth: 200,\n          minHeight: 50,\n        })\n      }\n    } else if (nodeObj.comfyClass === 'InputPathConfig') {\n      // console.log(\"[DataManager] InputPathConfig node created\");\n      // Initialize format selector state\n      ;(nodeObj as { _dmFormatSelectorEnabled?: boolean })._dmFormatSelectorEnabled = false\n    } else if (nodeObj.comfyClass === 'OutputPathConfig') {\n      // console.log(\"[DataManager] OutputPathConfig node created\");\n      // Initialize OutputPathConfig node state\n      const outputNode = nodeObj as { _dmOutputType?: string; _dmFilePath?: string }\n      outputNode._dmOutputType = 'STRING'\n      outputNode._dmFilePath = ''\n    }\n  },\n\n  getNodeMenuItems(node: unknown) {\n    const nodeObj = node as { comfyClass?: string }\n    if (nodeObj.comfyClass === 'DataManagerCore') {\n      return [\n        {\n          content: '',\n          callback: () => openFileManager(),\n        },\n      ]\n    }\n    return []\n  },\n\n  getCanvasMenuItems() {\n    return [\n      null,\n      {\n        content: 'Data Manager',\n        callback: () => openFileManager(),\n      },\n    ]\n  },\n}\n\n// ============================================\n// Main Functions\n// ============================================\n\n/**\n * Open file manager\n */\nfunction openFileManager(): void {\n  // If window exists, destroy it first (cleanup event listeners)\n  if (fileManagerWindow) {\n    destroyFileManagerWindow()\n  }\n\n  // Restore last visited path, or use default\n  const lastPath = getLastPath()\n  if (lastPath && lastPath !== '.') {\n    FileManagerState.currentPath = lastPath\n    // console.log('[DataManager] Restored last path:', lastPath);\n  } else {\n    FileManagerState.currentPath = '.'\n  }\n\n  // Create window callbacks\n  const callbacks: WindowManagerCallbacks = {\n    onRefresh: () => loadDirectory(FileManagerState.currentPath),\n    onClose: () => {\n      destroyFileManagerWindow()\n      fileManagerWindow = null\n    },\n    onOpenFloating: () => {\n      const selected = FileManagerState.selectedFiles[0]\n      if (selected) {\n        openFloatingPreview(selected, getFileName(selected))\n      }\n    },\n    onCopyPath: () => copySelectedPaths(),\n    onDelete: () => deleteSelectedFiles(),\n    // Toolbar callbacks\n    onSortChange: (sortBy: string) => {\n      toggleSort(sortBy as 'name' | 'size' | 'modified')\n    },\n    onNewFile: () => showNewFileDialog(),\n    // SSH callbacks\n    onSshConnect: async (conn) => {\n      const result = conn as { root_path?: string; username?: string; host?: string }\n      // Set active connection\n      const state = (window as unknown as { _remoteConnectionsState: { active: unknown } })\n        ._remoteConnectionsState\n      state.active = conn\n      // Save to localStorage\n      try {\n        localStorage.setItem('comfyui_datamanager_last_connection', JSON.stringify(conn))\n      } catch (e) {}\n      // Load remote root directory\n      await loadDirectory(result.root_path || '/')\n      showToast('success', '', `SSH: ${result.username}@${result.host}`)\n    },\n    onSshDisconnect: async () => {\n      const state = (\n        window as unknown as {\n          _remoteConnectionsState: { active: { connection_id?: string } | null }\n        }\n      )._remoteConnectionsState\n      const conn = state.active\n      if (conn && conn.connection_id) {\n        try {\n          const { sshDisconnect } = await import('./api/ssh.js')\n          await sshDisconnect(conn.connection_id)\n        } catch (e) {\n          console.log('[DataManager] SSH disconnect error:', e)\n        }\n      }\n      // Clear active connection\n      state.active = null\n      try {\n        localStorage.removeItem('comfyui_datamanager_last_connection')\n      } catch (e) {}\n      // Load local directory\n      await loadDirectory('.')\n      showToast('info', '', 'SSH ')\n    },\n  }\n\n  fileManagerWindow = createFileManagerWindow(callbacks)\n\n  // Apply ComfyUI theme\n  applyComfyTheme()\n\n  loadDirectory(FileManagerState.currentPath)\n\n  // Delay check node connection status, ensure window is fully created\n  setTimeout(() => {\n    checkAndUpdateFormatSelector()\n  }, 500)\n}\n\n/**\n * Check InputPathConfig node connection status and update format selector\n */\nfunction checkAndUpdateFormatSelector(): void {\n  try {\n    checkNodeConnectionAndUpdateFormat()\n  } catch (e) {\n    console.log('[DataManager] Error in checkAndUpdateFormatSelector:', e)\n  }\n}\n\n// ============================================\n// File Operations\n// ============================================\n\n/**\n * Copy selected file paths to clipboard\n */\nfunction copySelectedPaths(): void {\n  const selected = FileManagerState.selectedFiles\n  if (selected.length === 0) {\n    showToast('warn', '', '')\n    return\n  }\n\n  const paths = selected.join('\\n')\n\n  // Try modern Clipboard API first\n  if (navigator.clipboard && navigator.clipboard.writeText) {\n    navigator.clipboard\n      .writeText(paths)\n      .then(() => {\n        showToast('success', '', ` ${selected.length} `)\n      })\n      .catch(() => {\n        // Fallback to document.execCommand\n        fallbackCopy(paths)\n      })\n  } else {\n    // Use fallback directly\n    fallbackCopy(paths)\n  }\n}\n\n/**\n * Fallback copy method using document.execCommand\n */\nfunction fallbackCopy(text: string): void {\n  const textArea = document.createElement('textarea')\n  textArea.value = text\n  textArea.style.position = 'fixed'\n  textArea.style.left = '-999999px'\n  textArea.style.top = '-999999px'\n  document.body.appendChild(textArea)\n  textArea.focus()\n  textArea.select()\n\n  try {\n    const successful = document.execCommand('copy')\n    if (successful) {\n      showToast('success', '', ` ${FileManagerState.selectedFiles.length} `)\n    } else {\n      showToast('error', '', '')\n    }\n  } catch (err) {\n    console.error('[DataManager] Fallback copy failed:', err)\n    showToast('error', '', '')\n  }\n\n  document.body.removeChild(textArea)\n}\n\n/**\n * Delete selected files\n */\nasync function deleteSelectedFiles(): Promise<void> {\n  const selected = FileManagerState.selectedFiles\n  if (selected.length === 0) {\n    showToast('warn', '', '')\n    return\n  }\n\n  const message =\n    selected.length === 1\n      ? ` \"${getFileName(selected[0])}\"?`\n      : ` ${selected.length} ?`\n\n  if (!confirm(message)) {\n    return\n  }\n\n  try {\n    for (const path of selected) {\n      await apiDeleteFile(path, true)\n    }\n    showToast('success', '', ` ${selected.length} `)\n    loadDirectory(FileManagerState.currentPath)\n  } catch (error) {\n    showToast('error', '', (error as Error).message)\n  }\n}\n\n/**\n * Show new file dialog\n */\nfunction showNewFileDialog(): void {\n  const { getComfyTheme } = require('../utils/theme.js') as {\n    getComfyTheme: () => {\n      bgSecondary: string\n      bgTertiary: string\n      borderColor: string\n      textPrimary: string\n      textSecondary: string\n    }\n  }\n\n  const theme = getComfyTheme()\n\n  const modal = document.createElement('div')\n  modal.style.cssText = `\n    position: fixed; top: 0; left: 0; right: 0; bottom: 0;\n    background: rgba(0, 0, 0, 0.7); z-index: 10001;\n    display: flex; align-items: center; justify-content: center;\n  `\n\n  const dialog = document.createElement('div')\n  dialog.style.cssText = `\n    background: ${theme.bgSecondary}; border-radius: 12px; padding: 24px;\n    width: 400px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n  `\n\n  dialog.innerHTML = `\n    <h3 style=\"margin: 0 0 20px 0; color: ${theme.textPrimary};\"></h3>\n    <div style=\"display: flex; gap: 10px; margin-bottom: 20px;\">\n      <button id=\"dm-new-file-btn\" class=\"comfy-btn\"\n              style=\"flex: 1; padding: 15px; background: ${theme.bgTertiary}; border: 1px solid ${theme.borderColor};\n                     border-radius: 8px; color: ${theme.textPrimary}; cursor: pointer;\">\n        <i class=\"pi pi-file\" style=\"display: block; font-size: 24px; margin-bottom: 8px;\"></i>\n        \n      </button>\n      <button id=\"dm-new-folder-btn\" class=\"comfy-btn\"\n              style=\"flex: 1; padding: 15px; background: ${theme.bgTertiary}; border: 1px solid ${theme.borderColor};\n                     border-radius: 8px; color: ${theme.textPrimary}; cursor: pointer;\">\n        <i class=\"pi pi-folder\" style=\"display: block; font-size: 24px; margin-bottom: 8px;\"></i>\n        \n      </button>\n    </div>\n    <button class=\"comfy-btn\" id=\"dm-cancel-new-btn\"\n            style=\"width: 100%; padding: 10px; background: transparent;\n                   border: 1px solid ${theme.borderColor}; border-radius: 6px; color: ${theme.textSecondary}; cursor: pointer;\">\n      \n    </button>\n  `\n\n  modal.appendChild(dialog)\n  document.body.appendChild(modal)\n\n  const fileBtn = dialog.querySelector('#dm-new-file-btn') as HTMLButtonElement\n  const folderBtn = dialog.querySelector('#dm-new-folder-btn') as HTMLButtonElement\n  const cancelBtn = dialog.querySelector('#dm-cancel-new-btn') as HTMLButtonElement\n\n  fileBtn.onclick = () => {\n    modal.remove()\n    createNewFile()\n  }\n  folderBtn.onclick = () => {\n    modal.remove()\n    createNewFolder()\n  }\n  cancelBtn.onclick = () => modal.remove()\n  modal.onclick = (e) => {\n    if (e.target === modal) modal.remove()\n  }\n}\n\n/**\n * Create new file\n */\nasync function createNewFile(): Promise<void> {\n  const name = prompt(':', 'new_file.txt')\n  if (name) {\n    try {\n      await apiCreateFile(FileManagerState.currentPath, name, '')\n      await loadDirectory(FileManagerState.currentPath)\n      showToast('success', '', `: ${name}`)\n    } catch (error) {\n      console.error(':', error)\n      showToast('error', '', `: ${(error as Error).message}`)\n    }\n  }\n}\n\n/**\n * Create new folder\n */\nasync function createNewFolder(): Promise<void> {\n  const name = prompt(':', '')\n  if (name) {\n    try {\n      await apiCreateDirectory(FileManagerState.currentPath, name)\n      await loadDirectory(FileManagerState.currentPath)\n      showToast('success', '', `: ${name}`)\n    } catch (error) {\n      console.error(':', error)\n      showToast('error', '', `: ${(error as Error).message}`)\n    }\n  }\n}\n\n// ============================================\n// Register Extension\n// ============================================\napp.registerExtension(extensionConfig)\n\nexport { extensionConfig }\n"],"file":"extension.js"}