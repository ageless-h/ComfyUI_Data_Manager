# -*- coding: utf-8 -*-
"""pytest.ini - Pytest 配置文件

配置测试发现、覆盖率报告和测试行为
"""

[pytest]
# 测试发现路径
testpaths = unit integration

# 测试文件模式
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# 最小 Python 版本
minversion = 7.0

# 使用导入模式避免包初始化
import-mode = importlib

# 禁用包发现
norecursedirs = .. .pytest_cache __pycache__

# 命令行选项
addopts =
    # 详细输出
    -v
    # 显示本地变量
    -l
    # 显示测试耗时
    --durations=10
    # Coverage 配置
    --cov=backend
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    # Coverage 包含路径
    --cov-context=test
    # 忽略以下路径
    --ignore=tools
    --ignore=e2e
    --ignore=test_screenshots
    --ignore=fixtures
    --ignore=object_info.json

# 标记定义
markers =
    unit: 单元测试（不依赖外部服务）
    integration: 集成测试（依赖本地服务）
    e2e: 端到端测试（完整工作流）
    slow: 慢速测试（运行时间 > 1秒）
    ssh: SSH 相关测试（需要网络）
    api: API 路由测试

# 日志配置
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# 警告过滤
filterwarnings =
    # 忽略弃用警告
    ignore::DeprecationWarning
    # 忽略 PendingDeprecationWarning
    ignore::PendingDeprecationWarning
